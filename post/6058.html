<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="S_5aoPFd3QQihrUOLiKdVR0Mj4fj6n6qJojwyjj9cAY">
  <meta name="msvalidate.01" content="9032A67FCF787F07CB04374E59E518A9">
  <meta name="baidu-site-verification" content="code-Onlniop0d6">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha256-/4UQcSmErDzPCMAiuOiWPVVsNN2s3ZY/NsmXNcj0IFc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.xiaoyeshiyu.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.15.0","exturl":true,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":false,"nav":null,"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="ä½¿ç”¨protocolä¹‹åï¼Œæ›´åŠ ç¬¦åˆå¾®æœåŠ¡å¼€å‘è§„èŒƒï¼Œå¹¶ä¸”å®šä¹‰å³æ–‡æ¡£ï¼Œå¼€å‘æ•ˆç‡å¤§å¤§æé«˜ã€‚ä½†æ˜¯protobufæ— æ³•å®ç°è‡ªå®šä¹‰æŠ¥é”™å†…å®¹ï¼Œæ‰€å¹¸è¿™ä¸ªåŠŸèƒ½Googleå·²ç»åœ¨è€ƒè™‘ï¼Œå¹¶ä¸”åœ¨validateçš„betaç‰ˆæœ¬å·²ç»å®ç°ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="ä½¿ç”¨protobuf validateè‡ªå®šä¹‰æŠ¥é”™å†…å®¹">
<meta property="og:url" content="https://www.xiaoyeshiyu.com/post/6058.html">
<meta property="og:site_name" content="å°å¤œæ—¶é›¨">
<meta property="og:description" content="ä½¿ç”¨protocolä¹‹åï¼Œæ›´åŠ ç¬¦åˆå¾®æœåŠ¡å¼€å‘è§„èŒƒï¼Œå¹¶ä¸”å®šä¹‰å³æ–‡æ¡£ï¼Œå¼€å‘æ•ˆç‡å¤§å¤§æé«˜ã€‚ä½†æ˜¯protobufæ— æ³•å®ç°è‡ªå®šä¹‰æŠ¥é”™å†…å®¹ï¼Œæ‰€å¹¸è¿™ä¸ªåŠŸèƒ½Googleå·²ç»åœ¨è€ƒè™‘ï¼Œå¹¶ä¸”åœ¨validateçš„betaç‰ˆæœ¬å·²ç»å®ç°ã€‚">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-08-20T16:00:00.000Z">
<meta property="article:modified_time" content="2023-09-07T09:39:03.015Z">
<meta property="article:author" content="Mitaka xu">
<meta property="article:tag" content="å¼€å‘æŠ€å·§">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.xiaoyeshiyu.com/post/6058.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://www.xiaoyeshiyu.com/post/6058.html","path":"post/6058.html","title":"ä½¿ç”¨protobuf validateè‡ªå®šä¹‰æŠ¥é”™å†…å®¹"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>ä½¿ç”¨protobuf validateè‡ªå®šä¹‰æŠ¥é”™å†…å®¹ | å°å¤œæ—¶é›¨</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-MBVJ11TVHH"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-MBVJ11TVHH","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?573725610fbc6ff9b42032bd13615370"></script>







  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="å°å¤œæ—¶é›¨" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">å°å¤œæ—¶é›¨</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">å›å­æ•¬å…¶åœ¨å·±è€…ï¼Œè€Œä¸æ…•å…¶åœ¨å¤©è€…ï¼Œæ˜¯ä»¥æ—¥è¿›ä¹Ÿã€‚</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Commonweal 404</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8validate%E9%99%90%E5%88%B6%E8%BE%93%E5%85%A5"><span class="nav-number">1.</span> <span class="nav-text">ä½¿ç”¨validateé™åˆ¶è¾“å…¥</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#gin"><span class="nav-number">1.1.</span> <span class="nav-text">gin</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#protoc-gen-validate-PGV"><span class="nav-number">1.2.</span> <span class="nav-text">protoc-gen-validate (PGV)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="nav-number">1.2.1.</span> <span class="nav-text">ä½¿ç”¨æ–¹æ³•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">1.2.2.</span> <span class="nav-text">å®‰è£…</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%8EGitHub%E5%8F%91%E5%B8%83%E4%B8%8B%E8%BD%BD"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">ä»GitHubå‘å¸ƒä¸‹è½½</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%8E%E6%BA%90%E4%BB%A3%E7%A0%81%E6%9E%84%E5%BB%BA"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">ä»æºä»£ç æ„å»º</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E6%95%B0"><span class="nav-number">1.2.3.</span> <span class="nav-text">å‚æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B"><span class="nav-number">1.2.4.</span> <span class="nav-text">ç¤ºä¾‹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Go"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">Go</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="nav-number">1.2.4.2.</span> <span class="nav-text">æ‹¦æˆªå™¨</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Next-Generation"><span class="nav-number">2.</span> <span class="nav-text">Next Generation</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#protovalidate"><span class="nav-number">2.1.</span> <span class="nav-text">protovalidate</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8%E6%B3%95"><span class="nav-number">2.1.1.</span> <span class="nav-text">ç”¨æ³•</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5-protovalidate"><span class="nav-number">2.1.1.1.</span> <span class="nav-text">å¯¼å…¥ protovalidate</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E8%BF%87-buf-%E6%9E%84%E5%BB%BA"><span class="nav-number">2.1.1.2.</span> <span class="nav-text">é€šè¿‡ buf æ„å»º</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E8%BF%87protoc%E6%9E%84%E5%BB%BA"><span class="nav-number">2.1.1.3.</span> <span class="nav-text">é€šè¿‡protocæ„å»º</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E6%96%BD%E9%AA%8C%E8%AF%81%E7%BA%A6%E6%9D%9F"><span class="nav-number">2.1.2.</span> <span class="nav-text">å®æ–½éªŒè¯çº¦æŸ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E4%BF%A1%E6%81%AF"><span class="nav-number">2.1.3.</span> <span class="nav-text">éªŒè¯ä¿¡æ¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E6%A1%A3"><span class="nav-number">2.1.4.</span> <span class="nav-text">æ–‡æ¡£</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#protoc-gen-validate"><span class="nav-number">2.1.5.</span> <span class="nav-text">protoc-gen-validate</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%81%E7%A7%BB%E5%90%91%E5%AF%BC"><span class="nav-number">2.1.5.1.</span> <span class="nav-text">è¿ç§»å‘å¯¼</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8A%A5%E9%94%99"><span class="nav-number">2.2.</span> <span class="nav-text">è‡ªå®šä¹‰æŠ¥é”™</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E5%8A%BF"><span class="nav-number">2.2.1.</span> <span class="nav-text">ä¼˜åŠ¿</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CEL-%E9%80%9A%E7%94%A8%E8%A1%A8%E7%A4%BA%E8%AF%AD%E8%A8%80"><span class="nav-number">2.2.2.</span> <span class="nav-text">CEL é€šç”¨è¡¨ç¤ºè¯­è¨€</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E5%AE%9E%E8%B7%B5"><span class="nav-number">2.3.</span> <span class="nav-text">ä¸€äº›å®è·µ</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8E%A8%E8%8D%90%E9%98%85%E8%AF%BB"><span class="nav-number">3.</span> <span class="nav-text">æ¨èé˜…è¯»</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Mitaka xu"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Mitaka xu</p>
  <div class="site-description" itemprop="description">Golangå¼€å‘åšå®¢</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">127</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hpYW95ZXNoaXl1" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;xiaoyeshiyu"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.xiaoyeshiyu.com/post/6058.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mitaka xu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°å¤œæ—¶é›¨">
      <meta itemprop="description" content="Golangå¼€å‘åšå®¢">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="ä½¿ç”¨protobuf validateè‡ªå®šä¹‰æŠ¥é”™å†…å®¹ | å°å¤œæ—¶é›¨">
      <meta itemprop="description" content="ä½¿ç”¨protocolä¹‹åï¼Œæ›´åŠ ç¬¦åˆå¾®æœåŠ¡å¼€å‘è§„èŒƒï¼Œå¹¶ä¸”å®šä¹‰å³æ–‡æ¡£ï¼Œå¼€å‘æ•ˆç‡å¤§å¤§æé«˜ã€‚ä½†æ˜¯protobufæ— æ³•å®ç°è‡ªå®šä¹‰æŠ¥é”™å†…å®¹ï¼Œæ‰€å¹¸è¿™ä¸ªåŠŸèƒ½Googleå·²ç»åœ¨è€ƒè™‘ï¼Œå¹¶ä¸”åœ¨validateçš„betaç‰ˆæœ¬å·²ç»å®ç°ã€‚">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ä½¿ç”¨protobuf validateè‡ªå®šä¹‰æŠ¥é”™å†…å®¹
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-21 00:00:00" itemprop="dateCreated datePublished" datetime="2023-08-21T00:00:00+08:00">2023-08-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-09-07 17:39:03" itemprop="dateModified" datetime="2023-09-07T17:39:03+08:00">2023-09-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/microservice/" itemprop="url" rel="index"><span itemprop="name">å¾®æœåŠ¡</span></a>
        </span>
    </span>

  
    <span id="/post/6058.html" class="post-meta-item leancloud_visitors" data-flag-title="ä½¿ç”¨protobuf validateè‡ªå®šä¹‰æŠ¥é”™å†…å®¹" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

            <div class="post-description">ä½¿ç”¨protocolä¹‹åï¼Œæ›´åŠ ç¬¦åˆå¾®æœåŠ¡å¼€å‘è§„èŒƒï¼Œå¹¶ä¸”å®šä¹‰å³æ–‡æ¡£ï¼Œå¼€å‘æ•ˆç‡å¤§å¤§æé«˜ã€‚ä½†æ˜¯protobufæ— æ³•å®ç°è‡ªå®šä¹‰æŠ¥é”™å†…å®¹ï¼Œæ‰€å¹¸è¿™ä¸ªåŠŸèƒ½Googleå·²ç»åœ¨è€ƒè™‘ï¼Œå¹¶ä¸”åœ¨validateçš„betaç‰ˆæœ¬å·²ç»å®ç°ã€‚</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="ä½¿ç”¨validateé™åˆ¶è¾“å…¥"><a href="#ä½¿ç”¨validateé™åˆ¶è¾“å…¥" class="headerlink" title="ä½¿ç”¨validateé™åˆ¶è¾“å…¥"></a>ä½¿ç”¨<code>validate</code>é™åˆ¶è¾“å…¥</h1><p>åœ¨ä¸€äº›<code>http</code>æ¡†æ¶ä¸­ï¼Œéƒ½å¯ä»¥ç›´æ¥å¼•å…¥<code>validate</code>ï¼Œå¯¹å…¥å‚è¿›è¡Œé™åˆ¶å’Œæ ¡éªŒï¼Œä¾‹å¦‚<code>gin</code>æ¡†æ¶</p>
<h2 id="gin"><a href="#gin" class="headerlink" title="gin"></a><code>gin</code></h2><p>è¦å°†è¯·æ±‚æ­£æ–‡ç»‘å®šåˆ°ç±»å‹ä¸­ï¼Œè¯·ä½¿ç”¨æ¨¡å‹ç»‘å®šã€‚æˆ‘ä»¬ç›®å‰æ”¯æŒ JSONã€XMLã€YAML å’Œæ ‡å‡†è¡¨æ ¼å€¼ï¼ˆfoo&#x3D;bar&amp;boo&#x3D;bazï¼‰çš„ç»‘å®šã€‚</p>
<p>Gin ä½¿ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dvLXBsYXlncm91bmQvdmFsaWRhdG9y">go-playground&#x2F;validator&#x2F;v10<i class="fa fa-external-link-alt"></i></span> è¿›è¡ŒéªŒè¯ã€‚ç‚¹å‡»æ­¤å¤„æŸ¥çœ‹æœ‰å…³æ ‡ç­¾ç”¨æ³•çš„å®Œæ•´æ–‡æ¡£ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œæ‚¨éœ€è¦åœ¨æ‰€æœ‰è¦ç»‘å®šçš„å­—æ®µä¸Šè®¾ç½®ç›¸åº”çš„ç»‘å®šæ ‡ç­¾ã€‚ä¾‹å¦‚ï¼Œä» JSON ç»‘å®šæ—¶ï¼Œè®¾ç½® <code>json: &quot;fieldname&quot;</code>ã€‚</p>
<p>æ­¤å¤–ï¼ŒGin è¿˜æä¾›äº†ä¸¤å¥—ç»‘å®šæ–¹æ³•ï¼š</p>
<ul>
<li>Type - Must bind<ul>
<li><strong>æ–¹æ³•</strong> - <code>Bind</code>, <code>BindJSON</code>, <code>BindXML</code>, <code>BindQuery</code>, <code>BindYAML</code></li>
<li><strong>è¡¨ç°</strong> - è¿™äº›æ–¹æ³•åœ¨<code>gin.context</code>ä¸‹ä½¿ç”¨ <code>MustBindWith</code>ã€‚å¦‚æœå‡ºç°ç»‘å®šé”™è¯¯ï¼Œè¯·æ±‚å°†é€šè¿‡ <code>c.AbortWithError(400, err).SetType(ErrorTypeBind)</code> ä¸­æ­¢ã€‚è¿™ä¼šå°†å“åº”çŠ¶æ€ä»£ç è®¾ç½®ä¸º <code>400</code>ï¼Œå¹¶å°† <code>Content-Type</code> æ ‡å¤´è®¾ç½®ä¸º <code>text/plainï¼›charset=utf-8</code>ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœåœ¨æ­¤ä¹‹åå°è¯•è®¾ç½®å“åº”ä»£ç ï¼Œå°†ä¼šå‡ºç°è­¦å‘Š<code> [GIN-debug] [WARNING] Headers were already written.</code>æƒ³ç”¨ <code>422</code> è¦†ç›–çŠ¶æ€ä»£ç  <code>400</code>ã€‚å¦‚æœæ‚¨å¸Œæœ›å¯¹è¡Œä¸ºæœ‰æ›´å¤§çš„æ§åˆ¶æƒï¼Œè¯·è€ƒè™‘ä½¿ç”¨ <code>ShouldBind</code> åŒç­‰æ–¹æ³•ã€‚</li>
</ul>
</li>
<li>Type - Should bind<ul>
<li><strong>æ–¹æ³•</strong> - <code>ShouldBind</code>, <code>ShouldBindJSON</code>, <code>ShouldBindXML</code>, <code>ShouldBindQuery</code>, <code>ShouldBindYAML</code></li>
<li><strong>è¡¨ç°</strong> - è¿™äº›æ–¹æ³•åœ¨<code>gin.context</code>ä¸‹ä½¿ç”¨ <code>ShouldBindWith</code>ã€‚å¦‚æœå‡ºç°ç»‘å®šé”™è¯¯ï¼Œåˆ™ä¼šè¿”å›é”™è¯¯ä¿¡æ¯ï¼Œå¼€å‘äººå‘˜æœ‰è´£ä»»å¦¥å–„å¤„ç†è¯·æ±‚å’Œé”™è¯¯ã€‚</li>
</ul>
</li>
</ul>
<p>ä½¿ç”¨ç»‘å®šæ–¹æ³•æ—¶ï¼Œ<code>Gin</code> ä¼šæ ¹æ® <code>Content-Type</code> æ ‡å¤´æ¥æ¨æ–­ç»‘å®šå†…å®¹ã€‚å¦‚æœç¡®å®šè¦ç»‘å®šçš„å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨ <code>MustBindWith</code> æˆ– <code>ShouldBindWith</code>ã€‚</p>
<p>æ‚¨è¿˜å¯ä»¥æŒ‡å®šç‰¹å®šå­—æ®µä¸ºå¿…å¡«å­—æ®µã€‚å¦‚æœæŸä¸ªå­—æ®µä½¿ç”¨ <code>binding: &quot;required&quot;</code> ä¿®é¥°ï¼Œä½†åœ¨ç»‘å®šæ—¶å€¼ä¸ºç©ºï¼Œåˆ™ä¼šè¿”å›é”™è¯¯ä¿¡æ¯ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Binding from JSON</span></span><br><span class="line"><span class="keyword">type</span> Login <span class="keyword">struct</span> &#123;</span><br><span class="line">	User     <span class="type">string</span> <span class="string">`form:&quot;user&quot; json:&quot;user&quot; xml:&quot;user&quot;  binding:&quot;required&quot;`</span></span><br><span class="line">	Password <span class="type">string</span> <span class="string">`form:&quot;password&quot; json:&quot;password&quot; xml:&quot;password&quot; binding:&quot;required&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	router := gin.Default()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Example for binding JSON (&#123;&quot;user&quot;: &quot;manu&quot;, &quot;password&quot;: &quot;123&quot;&#125;)</span></span><br><span class="line">	router.POST(<span class="string">&quot;/loginJSON&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		<span class="keyword">var</span> json Login</span><br><span class="line">		<span class="keyword">if</span> err := c.ShouldBindJSON(&amp;json); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> json.User != <span class="string">&quot;manu&quot;</span> || json.Password != <span class="string">&quot;123&quot;</span> &#123;</span><br><span class="line">			c.JSON(http.StatusUnauthorized, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;unauthorized&quot;</span>&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125; </span><br><span class="line">		</span><br><span class="line">		c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;you are logged in&quot;</span>&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Example for binding XML (</span></span><br><span class="line">	<span class="comment">//	&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line">	<span class="comment">//	&lt;root&gt;</span></span><br><span class="line">	<span class="comment">//		&lt;user&gt;manu&lt;/user&gt;</span></span><br><span class="line">	<span class="comment">//		&lt;password&gt;123&lt;/password&gt;</span></span><br><span class="line">	<span class="comment">//	&lt;/root&gt;)</span></span><br><span class="line">	router.POST(<span class="string">&quot;/loginXML&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		<span class="keyword">var</span> xml Login</span><br><span class="line">		<span class="keyword">if</span> err := c.ShouldBindXML(&amp;xml); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> xml.User != <span class="string">&quot;manu&quot;</span> || xml.Password != <span class="string">&quot;123&quot;</span> &#123;</span><br><span class="line">			c.JSON(http.StatusUnauthorized, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;unauthorized&quot;</span>&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125; </span><br><span class="line">		</span><br><span class="line">		c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;you are logged in&quot;</span>&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Example for binding a HTML form (user=manu&amp;password=123)</span></span><br><span class="line">	router.POST(<span class="string">&quot;/loginForm&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		<span class="keyword">var</span> form Login</span><br><span class="line">		<span class="comment">// This will infer what binder to use depending on the content-type header.</span></span><br><span class="line">		<span class="keyword">if</span> err := c.ShouldBind(&amp;form); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> form.User != <span class="string">&quot;manu&quot;</span> || form.Password != <span class="string">&quot;123&quot;</span> &#123;</span><br><span class="line">			c.JSON(http.StatusUnauthorized, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;unauthorized&quot;</span>&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125; </span><br><span class="line">		</span><br><span class="line">		c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;you are logged in&quot;</span>&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Listen and serve on 0.0.0.0:8080</span></span><br><span class="line">	router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯·æ±‚ç¤ºä¾‹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl -v -X POST \</span></span><br><span class="line"><span class="language-bash">  http://localhost:8080/loginJSON \</span></span><br><span class="line"><span class="language-bash">  -H <span class="string">&#x27;content-type: application/json&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">  -d <span class="string">&#x27;&#123; &quot;user&quot;: &quot;manu&quot; &#125;&#x27;</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">POST /loginJSON HTTP/1.1</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Host: localhost:8080</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">User-Agent: curl/7.51.0</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Accept: */*</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">content-type: application/json</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Content-Length: 18</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">* upload completely sent off: 18 out of 18 bytes</span></span><br><span class="line">&lt; HTTP/1.1 400 Bad Request</span><br><span class="line">&lt; Content-Type: application/json; charset=utf-8</span><br><span class="line">&lt; Date: Fri, 04 Aug 2017 03:51:31 GMT</span><br><span class="line">&lt; Content-Length: 100</span><br><span class="line">&lt;</span><br><span class="line">&#123;&quot;error&quot;:&quot;Key: &#x27;Login.Password&#x27; Error:Field validation for &#x27;Password&#x27; failed on the &#x27;required&#x27; tag&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>è·³è¿‡éªŒè¯</p>
<p>ä½¿ç”¨ä¸Šè¿° <code>curl</code> å‘½ä»¤è¿è¡Œä¸Šè¿°ç¤ºä¾‹æ—¶ï¼Œè¿”å›é”™è¯¯ã€‚å› ä¸ºç¤ºä¾‹ä¸­çš„å¯†ç ä½¿ç”¨äº† <code>binding: &quot;required&quot;</code>ã€‚å¦‚æœå¯¹å¯†ç ä½¿ç”¨ <code>binding:&quot;-&quot;</code>ï¼Œå†æ¬¡è¿è¡Œä¸Šè¿°ç¤ºä¾‹æ—¶å°±ä¸ä¼šè¿”å›é”™è¯¯ã€‚</p>
<p>ä½†æ˜¯ç°åœ¨æ™®éä½¿ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œé€šè¿‡<code>protocol buffer</code>ï¼Œä½¿ç”¨<code>RPC</code>æˆ–è€…<code>gRPC</code>æ¡†æ¶å®ç°æœåŠ¡ä¹‹é—´äº¤äº’ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå‚æ•°ä¼ é€’ä¹Ÿéœ€è¦å®ç°å‚æ•°æ ¡éªŒã€‚</p>
<h2 id="protoc-gen-validate-PGV"><a href="#protoc-gen-validate-PGV" class="headerlink" title="protoc-gen-validate (PGV)"></a><code>protoc-gen-validate</code> (PGV)</h2><p><code>PGV</code> æ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆå¤šè¯­è¨€æ¶ˆæ¯éªŒè¯å™¨çš„ <code>protoc</code> æ’ä»¶ã€‚è™½ç„¶<code>protocol buffers</code>èƒ½æœ‰æ•ˆä¿è¯ç»“æ„åŒ–æ•°æ®çš„ç±»å‹ï¼Œä½†å®ƒä»¬æ— æ³•æ‰§è¡Œå€¼çš„è¯­ä¹‰è§„åˆ™ã€‚è¯¥æ’ä»¶ä¸º <code>protoc-generated</code> ä»£ç æ·»åŠ äº†éªŒè¯æ­¤ç±»çº¦æŸçš„æ”¯æŒã€‚</p>
<p>å¼€å‘äººå‘˜å¯¼å…¥ <code>PGV</code> æ‰©å±•ï¼Œå¹¶åœ¨ä»–ä»¬çš„ <code>proto</code> æ–‡ä»¶ä¸­ç”¨çº¦æŸè§„åˆ™æ³¨é‡Šæ¶ˆæ¯å’Œå­—æ®µï¼š</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> examplepb;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;validate/validate.proto&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="type">uint64</span> id = <span class="number">1</span> [(validate.rules).<span class="type">uint64</span>.gt = <span class="number">999</span>];</span><br><span class="line"></span><br><span class="line">  <span class="type">string</span> email = <span class="number">2</span> [(validate.rules).<span class="type">string</span>.email = <span class="literal">true</span>];</span><br><span class="line"></span><br><span class="line">  <span class="type">string</span> name = <span class="number">3</span> [(validate.rules).<span class="type">string</span> = &#123;</span><br><span class="line">    pattern:   <span class="string">&quot;^[^[0-9]A-Za-z]+( [^[0-9]A-Za-z]+)*$&quot;</span>,</span><br><span class="line">    max_bytes: <span class="number">256</span>,</span><br><span class="line">  &#125;];</span><br><span class="line"></span><br><span class="line">  Location home = <span class="number">4</span> [(validate.rules).message.<span class="keyword">required</span> = <span class="literal">true</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">message </span><span class="title class_">Location</span> &#123;</span><br><span class="line">    <span class="type">double</span> lat = <span class="number">1</span> [(validate.rules).<span class="type">double</span> = &#123;gte: -<span class="number">90</span>,  lte: <span class="number">90</span>&#125;];</span><br><span class="line">    <span class="type">double</span> lng = <span class="number">2</span> [(validate.rules).<span class="type">double</span> = &#123;gte: -<span class="number">180</span>, lte: <span class="number">180</span>&#125;];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ PGV å’Œç›®æ ‡è¯­è¨€çš„é»˜è®¤æ’ä»¶æ‰§è¡Œ protoc ä¼šåœ¨ç”Ÿæˆçš„ç±»å‹ä¸Šåˆ›å»ºéªŒè¯æ–¹æ³•ï¼š</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">p := new(Person)</span><br><span class="line"></span><br><span class="line">err := p.Validate() <span class="comment">// err: Id must be greater than 999</span></span><br><span class="line">p.Id = <span class="number">1000</span></span><br><span class="line"></span><br><span class="line">err = p.Validate() <span class="comment">// err: Email must be a valid email address</span></span><br><span class="line">p.Email = <span class="string">&quot;example@bufbuild.com&quot;</span></span><br><span class="line"></span><br><span class="line">err = p.Validate() <span class="comment">// err: Name must match pattern &#x27;^[^\d\s]+( [^\d\s]+)*$&#x27;</span></span><br><span class="line">p.Name = <span class="string">&quot;Protocol Buffer&quot;</span></span><br><span class="line"></span><br><span class="line">err = p.Validate() <span class="comment">// err: Home is required</span></span><br><span class="line">p.Home = &amp;Location&#123;<span class="number">37.7</span>, <span class="number">999</span>&#125;</span><br><span class="line"></span><br><span class="line">err = p.Validate() <span class="comment">// err: Home.Lng must be within [-180, 180]</span></span><br><span class="line">p.Home.Lng = -<span class="number">122.4</span></span><br><span class="line"></span><br><span class="line">err = p.Validate() <span class="comment">// err: nil</span></span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h3><p>å‰æï¼š</p>
<ul>
<li>go å·¥å…·é“¾ï¼ˆâ‰¥ v1.7ï¼‰</li>
<li>åœ¨ <code>$PATH</code> ä¸­çš„ <code>protoc</code> ç¼–è¯‘å™¨</li>
<li>åœ¨ <code>$PATH</code> ä¸­çš„ <code>protoc-gen-validate</code></li>
<li>ç›®æ ‡è¯­è¨€çš„å®˜æ–¹ç‰¹å®šè¯­è¨€æ’ä»¶</li>
<li>ç›®å‰ä»…æ”¯æŒ <code>proto3</code> è¯­æ³•ï¼Œè®¡åˆ’æ”¯æŒ <code>proto2</code> è¯­æ³•ã€‚</li>
</ul>
<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><h4 id="ä»GitHubå‘å¸ƒä¸‹è½½"><a href="#ä»GitHubå‘å¸ƒä¸‹è½½" class="headerlink" title="ä»GitHubå‘å¸ƒä¸‹è½½"></a>ä»GitHubå‘å¸ƒä¸‹è½½</h4><p>ä» <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2J1ZmJ1aWxkL3Byb3RvYy1nZW4tdmFsaWRhdGUvcmVsZWFzZXM=">GitHub Releases<i class="fa fa-external-link-alt"></i></span>ï¼Œç„¶åå°†æ’ä»¶æ·»åŠ åˆ° <code>$PATH</code>ã€‚</p>
<h4 id="ä»æºä»£ç æ„å»º"><a href="#ä»æºä»£ç æ„å»º" class="headerlink" title="ä»æºä»£ç æ„å»º"></a>ä»æºä»£ç æ„å»º</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">fetches this repo into <span class="variable">$GOPATH</span></span></span><br><span class="line">go get -d github.com/envoyproxy/protoc-gen-validate</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ’¡ Yes, our go module path is <code>github.com/envoyproxy/protoc-gen-validate</code> <strong>not</strong> <code>bufbuild</code> this is intentional.</p>
<p>Changing the module path is effectively creating a new, independent module. We would prefer not to break our users. The Go team are working on better <code>cmd/go</code> support for modules that change paths, but progress is slow. Until then, we will continue to use the <code>envoyproxy</code> module path.</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone github.com/bufbuild/protoc-gen-validate</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">installs PGV into <span class="variable">$GOPATH</span>/bin</span></span><br><span class="line">cd protoc-gen-validate &amp;&amp; make build</span><br></pre></td></tr></table></figure>

<h3 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h3><ul>
<li><code>lang</code>ï¼šæŒ‡å®šè¦ç”Ÿæˆçš„ç›®æ ‡è¯­è¨€ã€‚ç›®å‰ï¼Œä»…æ”¯æŒä»¥ä¸‹é€‰é¡¹<ul>
<li><code>go</code></li>
<li>c++ çš„ <code>cc</code>ï¼ˆå·²éƒ¨åˆ†å®ç°ï¼‰</li>
<li><code>java</code></li>
</ul>
</li>
<li>æ³¨æ„ï¼š<code>Python</code> é€šè¿‡è¿è¡Œæ—¶ä»£ç ç”Ÿæˆå·¥ä½œã€‚æ²¡æœ‰ç¼–è¯‘æ—¶ç”Ÿæˆã€‚è¯¦è§ Python éƒ¨åˆ†ã€‚</li>
</ul>
<h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><h4 id="Go"><a href="#Go" class="headerlink" title="Go"></a>Go</h4><p>Go ç”Ÿæˆåº”ä¸å®˜æ–¹æ’ä»¶çš„è¾“å‡ºè·¯å¾„ç›¸åŒã€‚å¯¹äºåŸè¯­æ–‡ä»¶ <code>example.proto</code>ï¼Œç›¸åº”çš„éªŒè¯ä»£ç ä¼šç”Ÿæˆåˆ° <code>../generated/example.pb.validate.go</code>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">protoc \</span><br><span class="line">  -I . \</span><br><span class="line">  -I path/to/validate/ \</span><br><span class="line">  --go_out=&quot;:../generated&quot; \</span><br><span class="line">  --validate_out=&quot;lang=go:../generated&quot; \</span><br><span class="line">  example.proto</span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆçš„æ‰€æœ‰ä¿¡æ¯éƒ½åŒ…æ‹¬ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<ul>
<li><code>Validate()</code> é”™è¯¯ä¼šè¿”å›éªŒè¯è¿‡ç¨‹ä¸­é‡åˆ°çš„ç¬¬ä¸€ä¸ªé”™è¯¯ã€‚</li>
<li><code>ValidateAll()</code> é”™è¯¯ï¼Œè¿”å›éªŒè¯è¿‡ç¨‹ä¸­é‡åˆ°çš„æ‰€æœ‰é”™è¯¯ã€‚</li>
</ul>
<p><code>PGV</code> ä¸éœ€è¦ç°æœ‰ç”Ÿæˆä»£ç çš„é¢å¤–è¿è¡Œæ—¶ä¾èµ–æ€§ã€‚</p>
<p>æ³¨æ„ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>example.pb.validate.go</code> åµŒå¥—åœ¨ä¸æ‚¨çš„ <code>go_package</code> é€‰é¡¹åç§°ç›¸åŒ¹é…çš„ç›®å½•ç»“æ„ä¸­ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ <code>protoc</code> å‚æ•° <code>paths=source_relative:.../generated</code> æ¥æ›´æ”¹ï¼Œå¦‚ <code>--validate_out=&quot;lang=go,paths=source_relative:.../generated&quot;</code> ã€‚ç„¶åï¼Œ<code>--validate_out </code>å°†åœ¨é¢„æœŸçš„ä½ç½®è¾“å‡ºæ–‡ä»¶ã€‚æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… <code>Google</code> çš„ <code>protobuf</code> æ–‡æ¡£æˆ–<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dvbGFuZy9wcm90b2J1ZiNwYWNrYWdlcy1hbmQtaW5wdXQtcGF0aHM=">è½¯ä»¶åŒ…å’Œè¾“å…¥è·¯å¾„<i class="fa fa-external-link-alt"></i></span>æˆ–<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dvbGFuZy9wcm90b2J1ZiNwYXJhbWV0ZXJz">å‚æ•°<i class="fa fa-external-link-alt"></i></span>ã€‚</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vcHJvdG9jb2wtYnVmZmVycy9kb2NzL3JlZmVyZW5jZS9nby1nZW5lcmF0ZWQjaW52b2NhdGlvbg==">æè¿°<i class="fa fa-external-link-alt"></i></span>å¯¹ <code>module=example.com/foo</code> æ ‡è®°çš„æ”¯æŒã€‚</p>
<p>åœ¨è¾ƒæ–°çš„ <code>Buf CLI</code> ç‰ˆæœ¬ï¼ˆ<code>&gt;v1.9.0</code>ï¼‰ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ–°çš„æ’ä»¶å¯†é’¥æ¥ä»£æ›¿ç›´æ¥ä½¿ç”¨ <code>protoc</code> å‘½ä»¤ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># buf.gen.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">plugins:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">plugin:</span> <span class="string">buf.build/bufbuild/validate-go</span></span><br><span class="line">    <span class="attr">out:</span> <span class="string">gen</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># proto/buf.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">deps:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">buf.build/envoyproxy/protoc-gen-validate</span></span><br></pre></td></tr></table></figure>

<p>æ›´å¤šè¯­è¨€ï¼š</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2J1ZmJ1aWxkL3Byb3RvYy1nZW4tdmFsaWRhdGUvYmxvYi9tYWluL2RvY3MubWQjamF2YQ==">Java<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2J1ZmJ1aWxkL3Byb3RvYy1nZW4tdmFsaWRhdGUvYmxvYi9tYWluL2RvY3MubWQjcHl0aG9u">Python<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<p>æ›´å¤šçº¦æŸï¼š<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2J1ZmJ1aWxkL3Byb3RvYy1nZW4tdmFsaWRhdGUvYmxvYi9tYWluL2RvY3MubWQjY29uc3RyYWludC1ydWxlcw==">Constraint Rules<i class="fa fa-external-link-alt"></i></span></p>
<h4 id="æ‹¦æˆªå™¨"><a href="#æ‹¦æˆªå™¨" class="headerlink" title="æ‹¦æˆªå™¨"></a>æ‹¦æˆªå™¨</h4><p>å¯¹äºè¿™ç±»ç›¸åŒçš„æŠ¥é”™ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ä¸­é—´ä»¶ï¼Œä¸éœ€è¦åœ¨ä»£ç å±‚é¢å¯¹æ¯ä¸€æ¬¡è°ƒç”¨è¿›è¡Œé”™è¯¯åˆ¤æ–­å¤„ç†</p>
<p>ä¸­é—´ä»¶åŒ…ï¼š<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dycGMtZWNvc3lzdGVtL2dvLWdycGMtbWlkZGxld2FyZQ==">https://github.com/grpc-ecosystem/go-grpc-middleware<i class="fa fa-external-link-alt"></i></span></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">grpcSrv := grpc.NewServer(</span><br><span class="line">	grpc.ChainUnaryInterceptor(</span><br><span class="line">		<span class="comment">// Order matters e.g. tracing interceptor have to create span first for the later exemplars to work.</span></span><br><span class="line">		otelgrpc.UnaryServerInterceptor(),</span><br><span class="line">		srvMetrics.UnaryServerInterceptor(grpcprom.WithExemplarFromContext(exemplarFromContext)),</span><br><span class="line">		logging.UnaryServerInterceptor(interceptorLogger(rpcLogger), logging.WithFieldsFromContext(logTraceID)),</span><br><span class="line">		selector.UnaryServerInterceptor(auth.UnaryServerInterceptor(authFn), selector.MatchFunc(allButHealthZ)),</span><br><span class="line">		recovery.UnaryServerInterceptor(recovery.WithRecoveryHandler(grpcPanicRecoveryHandler)),</span><br><span class="line">	),</span><br><span class="line">	grpc.ChainStreamInterceptor(</span><br><span class="line">		otelgrpc.StreamServerInterceptor(),</span><br><span class="line">		srvMetrics.StreamServerInterceptor(grpcprom.WithExemplarFromContext(exemplarFromContext)),</span><br><span class="line">		logging.StreamServerInterceptor(interceptorLogger(rpcLogger), logging.WithFieldsFromContext(logTraceID)),</span><br><span class="line">		selector.StreamServerInterceptor(auth.StreamServerInterceptor(authFn), selector.MatchFunc(allButHealthZ)),</span><br><span class="line">		recovery.StreamServerInterceptor(recovery.WithRecoveryHandler(grpcPanicRecoveryHandler)),</span><br><span class="line">	),</span><br></pre></td></tr></table></figure>

<p>validateä¸­é—´ä»¶åŒ…ï¼š<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dycGMtZWNvc3lzdGVtL2dvLWdycGMtbWlkZGxld2FyZS90cmVlL21haW4vaW50ZXJjZXB0b3JzL3ZhbGlkYXRvcg==">https://github.com/grpc-ecosystem/go-grpc-middleware/tree/main/interceptors/validator<i class="fa fa-external-link-alt"></i></span></p>
<p>ç¤ºä¾‹æœåŠ¡ç«¯ä»£ç ï¼Œä¸­é—´ä»¶å¼•å…¥</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">grpcServer := grpc.NewServer(</span><br><span class="line">    grpc.UnaryInterceptor(</span><br><span class="line">        grpc_validator.UnaryServerInterceptor(),</span><br><span class="line">    ),</span><br><span class="line">    grpc.Creds(serverCert))</span><br></pre></td></tr></table></figure>

<p>ä¸€å…ƒæ‹¦æˆªå™¨</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UnaryServerInterceptor</span><span class="params">(opts ...Option)</span></span> grpc.UnaryServerInterceptor &#123;</span><br><span class="line">	o := evaluateOpts(opts)</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(ctx context.Context, req <span class="keyword">interface</span>&#123;&#125;, info *grpc.UnaryServerInfo, handler grpc.UnaryHandler)</span></span> (<span class="keyword">interface</span>&#123;&#125;, <span class="type">error</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> err := validate(ctx, req, o.shouldFailFast, o.onValidationErrCallback); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> handler(ctx, req)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥è‡ªå·±å†™ä¸“å±è‡ªå·±çš„æ‹¦æˆªå™¨ã€‚</p>
<h1 id="Next-Generation"><a href="#Next-Generation" class="headerlink" title="Next Generation"></a>Next Generation</h1><blockquote>
<p>ğŸ“£<strong>æ›´æ–°</strong>ï¼šæ–°ä¸€ä»£ <code>protoc-gen-validate</code>ï¼ˆç°ç§°ä¸º <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2J1ZmJ1aWxkL3Byb3RvdmFsaWRhdGU=">protovalidate<i class="fa fa-external-link-alt"></i></span>ï¼‰å·²å‘å¸ƒæµ‹è¯•ç‰ˆï¼Œé€‚ç”¨äº <code>Golang</code>ã€<code>Python</code>ã€<code>Java</code> å’Œ <code>C++</code>ï¼æˆ‘ä»¬è¿˜åœ¨åŠªåŠ›å¼€å‘ <code>TypeScript</code> å®ç°ã€‚è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹<span class="exturl" data-url="aHR0cHM6Ly9idWYuYnVpbGQvYmxvZy9wcm90b2MtZ2VuLXZhbGlkYXRlLXYxLWFuZC12Mi8=">æˆ‘ä»¬çš„åšæ–‡<i class="fa fa-external-link-alt"></i></span>ã€‚æˆ‘ä»¬éå¸¸é‡è§†æ‚¨åœ¨å®Œå–„æˆ‘ä»¬äº§å“æ–¹é¢çš„æ„è§å’Œå»ºè®®ï¼Œå› æ­¤è¯·éšæ—¶åœ¨ <code>protovalidate.** </code>ä¸Šåˆ†äº«æ‚¨çš„åé¦ˆæ„è§ã€‚</p>
</blockquote>
<h2 id="protovalidate"><a href="#protovalidate" class="headerlink" title="protovalidate"></a><code>protovalidate</code></h2><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2J1ZmJ1aWxkL3Byb3RvdmFsaWRhdGU=">https://github.com/bufbuild/protovalidate<i class="fa fa-external-link-alt"></i></span></p>
<p><code>protovalidate</code> æ˜¯ä¸€ç³»åˆ—åº“ï¼Œæ—¨åœ¨æ ¹æ®ç”¨æˆ·å®šä¹‰çš„éªŒè¯è§„åˆ™åœ¨è¿è¡Œæ—¶éªŒè¯ <code>Protobuf</code> æ¶ˆæ¯ã€‚å®ƒç”±è°·æ­Œé€šç”¨è¡¨è¾¾å¼è¯­è¨€ï¼ˆ<code>CEL</code>ï¼‰æä¾›æ”¯æŒï¼Œä¸ºå®šä¹‰å’Œè¯„ä¼°è‡ªå®šä¹‰éªŒè¯è§„åˆ™æä¾›äº†çµæ´»é«˜æ•ˆçš„åŸºç¡€ã€‚<code>protovalidate</code> çš„ä¸»è¦ç›®æ ‡æ˜¯å¸®åŠ©å¼€å‘äººå‘˜ç¡®ä¿æ•´ä¸ªç½‘ç»œçš„æ•°æ®ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ï¼Œè€Œä¸éœ€è¦ç”Ÿæˆä»£ç ã€‚</p>
<blockquote>
<p>protovalidate æ˜¯ protoc-gen-validate çš„ç²¾ç¥ç»§æ‰¿è€…ã€‚</p>
</blockquote>
<h3 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h3><h4 id="å¯¼å…¥-protovalidate"><a href="#å¯¼å…¥-protovalidate" class="headerlink" title="å¯¼å…¥ protovalidate"></a>å¯¼å…¥ <code>protovalidate</code></h4><p>è¦åœ¨ Protobuf æ¶ˆæ¯ä¸­å®šä¹‰çº¦æŸæ¡ä»¶ï¼Œè¯·åœ¨ <code>.proto</code> æ–‡ä»¶ä¸­å¯¼å…¥ <code>buf/validate/validate.proto</code>ï¼š</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> my.<span class="keyword">package</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;buf/validate/validate.proto&quot;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="é€šè¿‡-buf-æ„å»º"><a href="#é€šè¿‡-buf-æ„å»º" class="headerlink" title="é€šè¿‡ buf æ„å»º"></a>é€šè¿‡ <a target="_blank" rel="noopener" href="https://buf.build/"><code>buf</code></a> æ„å»º</h4><p>åœ¨æ¨¡å—çš„ <code>buf.yaml</code> ä¸­æ·»åŠ å¯¹ <code>buf.build/bufbuild/protovalidate</code> çš„ä¾èµ–ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line"><span class="comment"># &lt;snip&gt;</span></span><br><span class="line"><span class="attr">deps:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">buf.build/bufbuild/protovalidate</span></span><br><span class="line"><span class="comment"># &lt;snip&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹å®Œ <code>buf.yaml</code> åï¼Œåˆ«å¿˜äº†è¿è¡Œ <code>buf mod update</code>ï¼Œä»¥ç¡®ä¿æ‚¨çš„ä¾èµ–é¡¹æ˜¯æœ€æ–°çš„ã€‚</p>
<h4 id="é€šè¿‡protocæ„å»º"><a href="#é€šè¿‡protocæ„å»º" class="headerlink" title="é€šè¿‡protocæ„å»º"></a>é€šè¿‡<code>protoc</code>æ„å»º</h4><p>åœ¨è°ƒç”¨ <code>protoc</code> æ—¶ï¼Œæ·»åŠ æŒ‡å‘ <code>proto/protovalidate</code> ç›®å½•å†…å®¹çš„å¯¼å…¥è·¯å¾„ï¼ˆ-I æ ‡å¿—ï¼‰ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">protoc \</span><br><span class="line">  -I ./vendor/protovalidate/proto/protovalidate \</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">&lt;snip&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>å¯ä»¥çœ‹åˆ°ï¼Œä¸<code>PGV</code>ä¸åŒçš„æ˜¯ï¼Œ<code>PGV</code>é€šè¿‡<code>protoc</code>ä¼šç”Ÿæˆå•ç‹¬çš„<code>go</code>ä»£ç æ–‡ä»¶ï¼Œè€Œ<code>protovalidate</code>ä¸ä¼šã€‚</strong></p>
<h3 id="å®æ–½éªŒè¯çº¦æŸ"><a href="#å®æ–½éªŒè¯çº¦æŸ" class="headerlink" title="å®æ–½éªŒè¯çº¦æŸ"></a>å®æ–½éªŒè¯çº¦æŸ</h3><p>å¯ä»¥ä½¿ç”¨<code> buf.validate</code> Protobuf è½¯ä»¶åŒ…å¼ºåˆ¶æ‰§è¡ŒéªŒè¯çº¦æŸã€‚è§„åˆ™ç›´æ¥åœ¨ <code>.proto</code> æ–‡ä»¶ä¸­æŒ‡å®šã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<ol>
<li><p><code>String</code> å­—æ®µéªŒè¯ï¼šå¯¹äºåŸºæœ¬çš„<code>User</code>ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å¼ºåˆ¶æ‰§è¡Œä¸€äº›é™åˆ¶æ¡ä»¶ï¼Œå¦‚ç”¨æˆ·å§“åçš„æœ€å°é•¿åº¦ã€‚</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;buf/validate/validate.proto&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="comment">// User&#x27;s name, must be at least 1 character long.</span></span><br><span class="line">  <span class="type">string</span> name = <span class="number">1</span> [(buf.validate.field).<span class="type">string</span>.min_len = <span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>Map</code> å­—æ®µéªŒè¯ï¼šå¯¹äºå¸¦æœ‰<code>Product</code>æ•°é‡æ˜ å°„çš„äº§å“ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿æ‰€æœ‰æ•°é‡éƒ½æ˜¯æ­£æ•°ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">syntax = &quot;proto3&quot;;</span><br><span class="line"></span><br><span class="line">import &quot;google/protobuf/timestamp.proto&quot;;</span><br><span class="line">import &quot;buf/validate/validate.proto&quot;;</span><br><span class="line"></span><br><span class="line">message User &#123;</span><br><span class="line">  // User&#x27;s creation date must be in the past.</span><br><span class="line">  google.protobuf.Timestamp created_at = 1 [(buf.validate.field).timestamp.lt_now = true];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¸¸ç”¨ç±»å‹ (WKT) éªŒè¯ï¼šå¯¹äº<code>User</code>ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªçº¦æŸæ¡ä»¶ï¼Œä»¥ç¡®ä¿ <code>created_at</code> æ—¶é—´æˆ³åœ¨è¿‡å»ã€‚</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;google/protobuf/timestamp.proto&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;buf/validate/validate.proto&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="comment">// User&#x27;s creation date must be in the past.</span></span><br><span class="line">  google.protobuf.Timestamp created_at = <span class="number">1</span> [(buf.validate.field).timestamp.lt_now = <span class="literal">true</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>å¯¹äºæ›´é«˜çº§æˆ–è‡ªå®šä¹‰çš„é™åˆ¶ï¼Œ<code>protovalidate</code> å…è®¸ä½¿ç”¨ <code>CEL</code> è¡¨è¾¾å¼ï¼Œå°†ä¿¡æ¯æ•´åˆåˆ°å„ä¸ªå­—æ®µä¸­ã€‚</p>
<ol>
<li><p>å­—æ®µçº§è¡¨è¾¾å¼ï¼šæˆ‘ä»¬å¯ä»¥å¼ºåˆ¶è¦æ±‚ä»¥å­—ç¬¦ä¸²å½¢å¼å‘é€çš„äº§å“<code>price</code>åŒ…å«<code>&quot;$&quot;</code>æˆ–<code>&quot;Â£&quot;</code>ç­‰è´§å¸ç¬¦å·ã€‚æˆ‘ä»¬è¦ç¡®ä¿ä»·æ ¼ä¸ºæ­£æ•°ï¼Œè´§å¸ç¬¦å·æœ‰æ•ˆã€‚</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;buf/validate/validate.proto&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">Product</span> &#123;</span><br><span class="line">  <span class="type">string</span> price = <span class="number">1</span> [(buf.validate.field).cel = &#123;</span><br><span class="line">    id: <span class="string">&quot;product.price&quot;</span>,</span><br><span class="line">    message: <span class="string">&quot;Price must be positive and include a valid currency symbol ($ or Â£)&quot;</span>,</span><br><span class="line">    expression: <span class="string">&quot;(this.startsWith(&#x27;$&#x27;) || this.startsWith(&#x27;Â£&#x27;)) &amp;&amp; double(this.substring(1)) &gt; 0&quot;</span></span><br><span class="line">  &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŠ¥æ–‡çº§è¡¨è¾¾å¼ï¼šå¯¹äº<code>Transaction</code>æ¶ˆæ¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¶ˆæ¯çº§ <code>CEL</code> è¡¨è¾¾å¼æ¥ç¡®ä¿<code>delivery_date</code>æ€»æ˜¯åœ¨<code>purchase_date</code>ä¹‹åã€‚</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;google/protobuf/timestamp.proto&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;buf/validate/validate.proto&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">Transaction</span> &#123;</span><br><span class="line">  google.protobuf.Timestamp purchase_date = <span class="number">1</span>;</span><br><span class="line">  google.protobuf.Timestamp delivery_date = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">option</span> (buf.validate.message).cel = &#123;</span><br><span class="line">    id: <span class="string">&quot;transaction.delivery_date&quot;</span>,</span><br><span class="line">    message: <span class="string">&quot;Delivery date must be after purchase date&quot;</span>,</span><br><span class="line">    expression: <span class="string">&quot;this.delivery_date &gt; this.purchase_date&quot;</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨è¡¨è¾¾å¼ä¸­ç”Ÿæˆé”™è¯¯ä¿¡æ¯ï¼šæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ <code>CEL</code> è¡¨è¾¾å¼ä¸­ç”Ÿæˆè‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå¦‚æœ<code>age</code>å°äº 18 å²ï¼Œ<code>CEL</code> è¡¨è¾¾å¼å°†è¯„ä¼°ä¸ºé”™è¯¯ä¿¡æ¯å­—ç¬¦ä¸²ã€‚</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;buf/validate/validate.proto&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="type">int32</span> age = <span class="number">1</span> [(buf.validate.field).cel = &#123;</span><br><span class="line">    id: <span class="string">&quot;user.age&quot;</span>,</span><br><span class="line">    expression: <span class="string">&quot;this.age &lt; 18 ? &#x27;User must be at least 18 years old&#x27;: &#x27;&#x27;&quot;</span></span><br><span class="line">  &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="éªŒè¯ä¿¡æ¯"><a href="#éªŒè¯ä¿¡æ¯" class="headerlink" title="éªŒè¯ä¿¡æ¯"></a>éªŒè¯ä¿¡æ¯</h3><p>ä¸€æ—¦ä¿¡æ¯æ³¨é‡Šäº†é™åˆ¶æ¡ä»¶ï¼Œå°±å¯ä»¥ä½¿ç”¨æ”¯æŒçš„è¯­è¨€åº“ä¹‹ä¸€è¿›è¡ŒéªŒè¯ï¼›<strong>æ— éœ€é¢å¤–ç”Ÿæˆä»£ç </strong>ã€‚ä½¿ç”¨<code>PGV</code>ç›¸åŒçš„ä¸­é—´ä»¶ä»£ç å³å¯ã€‚</p>
<h3 id="æ–‡æ¡£"><a href="#æ–‡æ¡£" class="headerlink" title="æ–‡æ¡£"></a>æ–‡æ¡£</h3><p><code>protovalidate</code> ä¸ºéªŒè¯ <code>Protobuf</code> æ¶ˆæ¯æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„æ¡†æ¶ï¼Œå®ƒå¯ä»¥å¯¹å„ç§æ•°æ®ç±»å‹æ‰§è¡Œæ ‡å‡†å’Œè‡ªå®šä¹‰çº¦æŸï¼Œå¹¶åœ¨å‡ºç°éªŒè¯è¿è§„æ—¶æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ã€‚è¦è¯¦ç»†äº†è§£å…¶æ‰€æœ‰ç»„ä»¶ã€æ”¯æŒçš„çº¦æŸæ¡ä»¶ä»¥åŠå¦‚ä½•æœ‰æ•ˆä½¿ç”¨å®ƒä»¬ï¼Œè¯·å‚é˜…çš„<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2J1ZmJ1aWxkL3Byb3RvdmFsaWRhdGUvYmxvYi9tYWluL2RvY3MvUkVBRE1FLm1k">ç»¼åˆæ–‡æ¡£<i class="fa fa-external-link-alt"></i></span>ã€‚ä¸»è¦ç»„ä»¶åŒ…æ‹¬</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2J1ZmJ1aWxkL3Byb3RvdmFsaWRhdGUvYmxvYi9tYWluL2RvY3Mvc3RhbmRhcmQtY29uc3RyYWludHMubWQ=">æ ‡å‡†çº¦æŸ<i class="fa fa-external-link-alt"></i></span>ï¼š<code>protovalidate</code> æ”¯æŒæ‰€æœ‰å­—æ®µç±»å‹çš„å„ç§æ ‡å‡†çº¦æŸï¼Œä»¥åŠ <code>Protobuf Wellnown-Type</code> çš„ç‰¹æ®ŠåŠŸèƒ½ã€‚ä½ å¯ä»¥å°†è¿™äº›çº¦æŸåº”ç”¨åˆ°ä½ çš„ <code>Protobuf</code> æ¶ˆæ¯ä¸­ï¼Œä»¥ç¡®ä¿å®ƒä»¬æ»¡è¶³æŸäº›å¸¸è§æ¡ä»¶ã€‚</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2J1ZmJ1aWxkL3Byb3RvdmFsaWRhdGUvYmxvYi9tYWluL2RvY3MvY3VzdG9tLWNvbnN0cmFpbnRzLm1k">è‡ªå®šä¹‰çº¦æŸ<i class="fa fa-external-link-alt"></i></span>ï¼šåˆ©ç”¨ <code>Google</code> çš„é€šç”¨è¡¨è¾¾å¼è¯­è¨€ (<code>CEL</code>)ï¼Œ<code>protovalidate</code> å…è®¸æ‚¨åˆ›å»ºå¤æ‚çš„è‡ªå®šä¹‰çº¦æŸï¼Œä»¥å¤„ç†å­—æ®µå’Œæ¶ˆæ¯çº§åˆ«çš„æ ‡å‡†çº¦æŸæœªæ¶µç›–çš„ç‹¬ç‰¹éªŒè¯åœºæ™¯ã€‚</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2J1ZmJ1aWxkL3Byb3RvdmFsaWRhdGUvYmxvYi9tYWluL2RvY3MvUkVBRE1FLm1kI2Vycm9ycw==">é”™è¯¯å¤„ç†<i class="fa fa-external-link-alt"></i></span>ï¼šå½“å‘ç”Ÿè¿è§„æ—¶ï¼Œ<code>protovalidate</code> ä¼šæä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿç¡®å®šé—®é¢˜æ¥æºå¹¶è¿›è¡Œä¿®å¤ã€‚</li>
</ul>
<h3 id="protoc-gen-validate"><a href="#protoc-gen-validate" class="headerlink" title="protoc-gen-validate"></a><code>protoc-gen-validate</code></h3><p><code>protovalidate</code> æ˜¯ <code>protoc-gen-validate</code> çš„ç²¾ç¥ç»§æ‰¿è€…ï¼Œå®ƒæä¾›äº†ä¸åŸå§‹æ’ä»¶ç›¸åŒçš„æ‰€æœ‰åŠŸèƒ½ï¼Œ<strong>æ— éœ€è‡ªå®šä¹‰ä»£ç ç”Ÿæˆï¼Œå¹¶å…·æœ‰åœ¨ CEL ä¸­æè¿°å¤æ‚çº¦æŸçš„æ–°èƒ½åŠ›</strong>ã€‚</p>
<p><code>protovalidate</code> çš„çº¦æŸæ¡ä»¶ä¸ <code>protoc-gen-validate</code> ä¸­çš„çº¦æŸæ¡ä»¶éå¸¸æ¥è¿‘ï¼Œä»¥ç¡®ä¿å¼€å‘äººå‘˜èƒ½è½»æ¾è¿‡æ¸¡ã€‚è¦ä» <code>protoc-gen-validate</code> è¿ç§»åˆ° <code>protovalidate</code>ï¼Œè¯·ä½¿ç”¨æä¾›çš„<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2J1ZmJ1aWxkL3Byb3RvdmFsaWRhdGUvYmxvYi9tYWluL3Rvb2xzL3Byb3RvdmFsaWRhdGUtbWlncmF0ZQ==">è¿ç§»å·¥å…·<i class="fa fa-external-link-alt"></i></span>é€æ­¥å‡çº§æ‚¨çš„<code>.proto</code>æ–‡ä»¶ã€‚</p>
<h4 id="è¿ç§»å‘å¯¼"><a href="#è¿ç§»å‘å¯¼" class="headerlink" title="è¿ç§»å‘å¯¼"></a>è¿ç§»å‘å¯¼</h4><p>ä» <code>protoc-gen-validate</code> è¿ç§»åˆ° <code>protovalidate</code> åº”è¯¥æ˜¯å®‰å…¨ã€æ¸è¿›å’Œç›¸å¯¹æ— ç—›çš„ï¼Œä½†ä»ç„¶éœ€è¦è¿›è¡Œä¸€äº›æ“ä½œæ‰èƒ½å®ç°ã€‚ä¸ºäº†å‡è½»è¿™ä¸€è´Ÿæ‹…ï¼Œæˆ‘ä»¬æä¾›äº†æœ¬æ–‡æ¡£å’Œè¿ç§»å·¥å…·ï¼Œä»¥ç®€åŒ–è¿ç§»è¿‡ç¨‹ã€‚</p>
<p>è¿ç§»å·¥å…·ï¼Œå¯ä»¥å°†å°†æ‰€æœ‰çƒ­<code>PGV</code>çº¦æŸæ”¹ä¸ºä½¿ç”¨<code>protovalidate</code>çº¦æŸï¼Œé¿å…ä¸€æ¡ä¸€æ¡æ›´æ”¹</p>
<p>å‘½ä»¤æ±‡æ€»ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// å…ˆä¿è¯å·²ç»æ ¼å¼åŒ–ï¼Œé¿å…å‡ºç°ä¸€äº›å¥‡æ€ªçš„ä»£ç </span><br><span class="line"></span><br><span class="line">// æ·»åŠ æ³¨é‡Š</span><br><span class="line">go run ./tools/protovalidate-migrate -w /path/to/protos</span><br><span class="line"></span><br><span class="line">// æ›´æ–°ç”Ÿæˆçš„PGVä»£ç ï¼Œä¸€èˆ¬å¯ä»¥ç›´æ¥åˆ é™¤</span><br><span class="line"></span><br><span class="line">// ï¼ˆå¯é€‰ï¼‰æ›¿ä»£æ³¨é‡Š</span><br><span class="line">go run ./tools/protovalidate-migrate -w --replace-protovalidate /path/to/protos</span><br><span class="line"></span><br><span class="line">// åˆ é™¤PGVçš„ä»£ç </span><br><span class="line">go run ./tools/protovalidate-migrate -w --remove-legacy /path/to/protos</span><br></pre></td></tr></table></figure>

<p>æ›´å¤šæ›´è¯¦ç»†çš„ç”¨æ³•ï¼Œå¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2J1ZmJ1aWxkL3Byb3RvdmFsaWRhdGUvdHJlZS9tYWluL3Rvb2xzL3Byb3RvdmFsaWRhdGUtbWlncmF0ZQ==">https://github.com/bufbuild/protovalidate/tree/main/tools/protovalidate-migrate<i class="fa fa-external-link-alt"></i></span></p>
<h2 id="è‡ªå®šä¹‰æŠ¥é”™"><a href="#è‡ªå®šä¹‰æŠ¥é”™" class="headerlink" title="è‡ªå®šä¹‰æŠ¥é”™"></a>è‡ªå®šä¹‰æŠ¥é”™</h2><p>ä½¿ç”¨<code>protovalidate</code>æœ€å¤§çš„åŸå› æ˜¯<code>protovalidate</code>æ”¯æŒè‡ªå®šä¹‰æŠ¥é”™ï¼Œå¯ä»¥æ›¿ä»£æ‰PGVçš„é»˜è®¤æŠ¥é”™ï¼Œå…·ä½“ç”¨æ³•ï¼š</p>
<p>ä¾‹å¦‚ä¸€ä¸ªæ³¨å†ŒæœåŠ¡ï¼Œéœ€è¦éªŒè¯ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åå’Œæ˜µç§°ï¼Œå¹¶ä¸”æŠ¥é”™ç”±è‡ªå·±è‡ªå®šä¹‰ï¼Œè¿”å›ç»™ç”¨æˆ·æ›´æ˜ç¡®çš„æŠ¥é”™</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">message </span><span class="title class_">SignupReq</span> &#123;</span><br><span class="line">    <span class="type">string</span> user_name      = <span class="number">1</span> [(buf.validate.field).cel = &#123;</span><br><span class="line">        id: <span class="string">&quot;user_name&quot;</span>,</span><br><span class="line">        message: <span class="string">&quot;ç”¨æˆ·ååªèƒ½ç”±ä¸­æ–‡ã€è‹±æ–‡å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ç»„æˆï¼Œå¹¶ä¸”é•¿åº¦åœ¨20ä»¥å†…&quot;</span>,</span><br><span class="line">        expression: <span class="string">&quot;this.matches(\&quot;^[\u4e00-\u9fa5a-zA-Z0-9_]&#123;1,20&#125;$\&quot;)&quot;</span>,</span><br><span class="line">    &#125;];                    <span class="comment">// ç”¨æˆ·åï¼Œåˆ¤æ–­æ˜¯å¦ç”±æ±‰å­—, å¤§å°å†™å­—æ¯,0-9æ•°ç»„ï¼Œä¸‹åˆ’çº¿ç»„æˆ</span></span><br><span class="line">    <span class="type">string</span> password       = <span class="number">2</span>;  <span class="comment">// å¯†ç </span></span><br><span class="line">    <span class="type">string</span> nick_name      = <span class="number">3</span> [(buf.validate.field).cel = &#123;</span><br><span class="line">        id: <span class="string">&quot;nick_name&quot;</span>,</span><br><span class="line">        message: <span class="string">&quot;æ˜µç§°åªèƒ½ç”±ä¸­æ–‡ã€è‹±æ–‡å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ä»¥åŠè‹±æ–‡æ‹¬å·å’Œä¸­æ–‡æ‹¬å·ç»„æˆï¼Œå¹¶ä¸”é•¿åº¦åœ¨20ä»¥å†…&quot;</span>,</span><br><span class="line">        expression: <span class="string">&quot;this.matches(\&quot;^[\u4e00-\u9fa5a-zA-Z0-9_().ï¼ˆï¼‰]&#123;1,20&#125;$\&quot;)&quot;</span>,</span><br><span class="line">    &#125;];</span><br><span class="line">    <span class="type">string</span> phone          = <span class="number">4</span> [(buf.validate.field).<span class="type">string</span> = &#123; pattern: <span class="string">&quot;^1[3|4|5|7|8][0-9]&#123;9&#125;$&quot;</span>, len: <span class="number">11</span> &#125;, (buf.validate.field).ignore_empty = <span class="literal">true</span>];  <span class="comment">// è”ç³»æ–¹å¼</span></span><br><span class="line">    <span class="type">string</span> address        = <span class="number">5</span>;                                                                                                                           <span class="comment">// è”ç³»åœ°å€</span></span><br><span class="line">    <span class="type">string</span> email          = <span class="number">6</span> [(buf.validate.field).<span class="type">string</span>.email = <span class="literal">true</span>];                                                                                <span class="comment">// é‚®ç®±åœ°å€</span></span><br><span class="line">    <span class="type">string</span> verify_code_id = <span class="number">7</span>;                                                                                                                           <span class="comment">// éªŒè¯ç åºå·</span></span><br><span class="line">    <span class="type">string</span> verify_code    = <span class="number">8</span>;                                                                                                                           <span class="comment">// éªŒè¯ç </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è‡ªå®šä¹‰çš„ä¸­é—´ä»¶ç»Ÿä¸€è¿”å›ä¸­æ–‡æŠ¥é”™</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> server</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;errors&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/bufbuild/protovalidate-go&quot;</span></span><br><span class="line">	<span class="string">&quot;google.golang.org/grpc&quot;</span></span><br><span class="line">	<span class="string">&quot;google.golang.org/grpc/codes&quot;</span></span><br><span class="line">	<span class="string">&quot;google.golang.org/grpc/status&quot;</span></span><br><span class="line">	<span class="string">&quot;google.golang.org/protobuf/proto&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Validate <span class="keyword">struct</span> &#123;</span><br><span class="line">	v *protovalidate.Validator</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewValidate</span><span class="params">()</span></span> (*Validate, <span class="type">error</span>) &#123;</span><br><span class="line">	v, err := protovalidate.New()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> &amp;Validate&#123;v: v&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *Validate)</span></span> validateUnaryServerInterceptor() grpc.UnaryServerInterceptor &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(ctx context.Context, req <span class="keyword">interface</span>&#123;&#125;, info *grpc.UnaryServerInfo, handler grpc.UnaryHandler)</span></span> (<span class="keyword">interface</span>&#123;&#125;, <span class="type">error</span>) &#123;</span><br><span class="line">		<span class="keyword">switch</span> req.(<span class="keyword">type</span>) &#123;</span><br><span class="line">		<span class="keyword">case</span> proto.Message:</span><br><span class="line">			<span class="keyword">if</span> err := v.v.Validate(req.(proto.Message)); err != <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="keyword">var</span> valErr *protovalidate.ValidationError</span><br><span class="line">				<span class="keyword">if</span> ok := errors.As(err, &amp;valErr); ok &amp;&amp; <span class="built_in">len</span>(valErr.ToProto().GetViolations()) &gt; <span class="number">0</span> &#123;</span><br><span class="line">					<span class="keyword">return</span> <span class="literal">nil</span>, status.Error(codes.InvalidArgument, valErr.ToProto().GetViolations()[<span class="number">0</span>].Message)</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">nil</span>, status.Error(codes.InvalidArgument, err.Error())</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> handler(ctx, req)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h3><p>æ€»ç»“ä¸‹æ¥ï¼Œ<code>protovalidate</code>ç›¸æ¯”<code>PGV</code>è€Œè¨€ï¼Œæœ‰å¾ˆå¤šä¼˜åŠ¿ï¼š</p>
<ul>
<li>ä¸éœ€è¦ç”Ÿæˆé¢å¤–ä»£ç </li>
<li>CELé€šç”¨è¡¨ç¤ºè¯­è¨€æœ‰å¾ˆå¼ºå¤§çš„æ‰©å±•æ€§ï¼Œè€Œä¸”å¸¦æœ‰å¾ˆå¤šå‡½æ•°ï¼Œå®ç°é€»è¾‘åˆ¤æ–­</li>
</ul>
<h3 id="CEL-é€šç”¨è¡¨ç¤ºè¯­è¨€"><a href="#CEL-é€šç”¨è¡¨ç¤ºè¯­è¨€" class="headerlink" title="CEL é€šç”¨è¡¨ç¤ºè¯­è¨€"></a>CEL é€šç”¨è¡¨ç¤ºè¯­è¨€</h3><p>é€šç”¨è¡¨è¾¾å¼è¯­è¨€ï¼ˆ<code>CEL</code>ï¼‰æ˜¯ä¸€ç§éå›¾çµå®Œå¤‡è¯­è¨€ï¼Œæ—¨åœ¨å®ç°ç®€å•ã€å¿«é€Ÿã€å®‰å…¨å’Œå¯ç§»æ¤æ€§ã€‚CEL ç±»ä¼¼ C è¯­è¨€çš„è¯­æ³•ä¸ C++ã€Goã€Java å’Œ TypeScript ä¸­çš„ç­‰æ•ˆè¡¨è¾¾å¼å‡ ä¹å®Œå…¨ç›¸åŒã€‚</p>
<p>è¿™é‡Œä¸ºäº†æ›´å¥½çš„ä½¿ç”¨<code>protovalidate</code>ï¼Œåˆ—ä¸¾ä¸€äº›å¸¸ç”¨çš„<code>CEL</code>è¡¨è¾¾å¼</p>
<p>å­—ç¬¦ä¸²é•¿åº¦</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//`len` dictates that the field value must have the specified</span></span><br><span class="line"><span class="comment">//number of characters (Unicode code points), which may differ from the number</span></span><br><span class="line"><span class="comment">//of bytes in the string. If the field value does not meet the specified</span></span><br><span class="line"><span class="comment">//length, an error message will be generated.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//```proto</span></span><br><span class="line"><span class="comment">//message MyString &#123;</span></span><br><span class="line"><span class="comment">//  // value length must be 5 characters</span></span><br><span class="line"><span class="comment">//   string value = 1 [(buf.validate.field).string.len = 5];</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//```</span></span><br><span class="line"><span class="keyword">optional</span> <span class="type">uint64</span> len = <span class="number">19</span> [(priv.field).cel = &#123;</span><br><span class="line">  id: <span class="string">&quot;string.len&quot;</span>,</span><br><span class="line">  expression: <span class="string">&quot;uint(this.size()) != rules.len ? &#x27;value length must be %s characters&#x27;.format([rules.len]) : &#x27;&#x27;&quot;</span></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<p>ç‰¹å®šå­—ç¬¦</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//`in` specifies that the field value must be equal to one of the specified</span></span><br><span class="line"><span class="comment">//values. If the field value isn&#x27;t one of the specified values, an error</span></span><br><span class="line"><span class="comment">//message will be generated.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//```proto</span></span><br><span class="line"><span class="comment">//message MyString &#123;</span></span><br><span class="line"><span class="comment">//  // value must be in list [&quot;apple&quot;, &quot;banana&quot;]</span></span><br><span class="line"><span class="comment">//  repeated string value = 1 [(buf.validate.field).string.in = &quot;apple&quot;, (buf.validate.field).string.in = &quot;banana&quot;];</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//```</span></span><br><span class="line"><span class="keyword">repeated</span> <span class="type">string</span> in = <span class="number">10</span> [(priv.field).cel = &#123;</span><br><span class="line">  id: <span class="string">&quot;string.in&quot;</span>,</span><br><span class="line">  expression: <span class="string">&quot;!(this in dyn(rules)[&#x27;in&#x27;]) ? &#x27;value must be in list %s&#x27;.format([dyn(rules)[&#x27;in&#x27;]]) : &#x27;&#x27;&quot;</span></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è¯´æ˜å¯ä»¥çœ‹åˆ°ï¼Œç»§æ‰¿è‡ª<code>PGV</code>çš„çº¦æŸï¼Œåœ¨<code>protovalidate</code>ä¸­ï¼Œå…¶å®æ˜¯é€šè¿‡<code>CEL</code>å®ç°ï¼Œä¸å¾—ä¸å†æ¬¡æ„Ÿå¹<code>Google</code>åœ¨æ‰©å±•æ€§å’Œå…¼å®¹æ€§ä¸Šå±•ç°å‡ºçš„å¼ºå¤§å®åŠ›ã€‚</p>
<p>æ›´å¤š<code>CEL</code>ç¤ºä¾‹ï¼Œå¯ä»¥æŸ¥çœ‹<code>protoc</code>æ–‡ä»¶</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2J1ZmJ1aWxkL3Byb3RvdmFsaWRhdGUvYmxvYi9tYWluL3Byb3RvL3Byb3RvdmFsaWRhdGUvYnVmL3ZhbGlkYXRlL3ZhbGlkYXRlLnByb3Rv">https://github.com/bufbuild/protovalidate/blob/main/proto/protovalidate/buf/validate/validate.proto<i class="fa fa-external-link-alt"></i></span></p>
<h2 id="ä¸€äº›å®è·µ"><a href="#ä¸€äº›å®è·µ" class="headerlink" title="ä¸€äº›å®è·µ"></a>ä¸€äº›å®è·µ</h2><p>ç”±äºæ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨ <code>RE2</code> è¯­æ³•ï¼Œå¹¶ä¸”æ˜¯ä»¥ <code>CEL</code> è¯­è¨€å†™åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œå› æ­¤ï¼Œä¸­é—´ä¼šä¼šå¾ˆå¤šçš„è½¬ä¹‰ã€‚</p>
<p>ä¾‹å¦‚</p>
<ol>
<li><p>è´¦å· ç”±æ•°å­—&#x2F;å­—æ¯&#x2F;ç‰¹æ®Šå­—ç¬¦ï¼ˆ~!@#$%^&amp;*()_+&#96;-&#x3D;{}|[];â€™:â€,.&#x2F;&lt;&gt;?Â·ï¼‰ç»„æˆï¼Œæœ€å¤§æ”¯æŒ100ä¸ªå­—ç¬¦,ä¸æ”¯æŒç©ºæ ¼</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">string</span> user_name = <span class="number">1</span> [</span><br><span class="line">    (buf.validate.field).cel = &#123;</span><br><span class="line">        id: <span class="string">&quot;user_name&quot;</span>,</span><br><span class="line">        message: <span class="string">&quot;è´¦å·æ ¼å¼ä¸ç¬¦åˆè§„èŒƒ&quot;</span>,</span><br><span class="line">        expression: <span class="string">&quot;this.matches(\&quot;^[\\\\w~!@#\\\\$%\\\\^&amp;\\\\*\\\\(\\\\)_+`\\\\-=&#123;&#125;|\\\\[\\\\];&#x27;:\\\&quot;,./&lt;&gt;?Â·]&#123;1,100&#125;$\&quot;)&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">];                     <span class="comment">// è´¦å· ç”±æ•°å­—/å­—æ¯/ç‰¹æ®Šå­—ç¬¦ï¼ˆ~!@#$%^&amp;*()_+`-=&#123;&#125;|[];&#x27;:&quot;,./&lt;&gt;?Â·ï¼‰ç»„æˆï¼Œæœ€å¤§æ”¯æŒ100ä¸ªå­—ç¬¦,ä¸æ”¯æŒç©ºæ ¼</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ç”¨æˆ·åã€æ˜µç§°ç”±æ±‰å­—&#x2F;æ•°å­—&#x2F;å­—æ¯&#x2F;ç‰¹æ®Šå­—ç¬¦ï¼ˆ~!@#$%^&amp;*()_+&#96;-&#x3D;{}|[];â€™:â€,.&#x2F;&lt;&gt;?Â·ï¼‰ç»„æˆï¼Œæœ€å¤§æ”¯æŒ100ä¸ªå­—ç¬¦ï¼Œä¸¤è¾¹ä¸å…è®¸æœ‰ç©ºæ ¼ï¼Œä¸­é—´æ”¯æŒç©ºæ ¼</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">string</span> nick_name = <span class="number">3</span> [</span><br><span class="line">    (buf.validate.field).cel = &#123;</span><br><span class="line">        id: <span class="string">&quot;nick_name&quot;</span>,</span><br><span class="line">        message: <span class="string">&quot;ç”¨æˆ·å/æ˜µç§°æ ¼å¼ä¸ç¬¦åˆè§„èŒƒ&quot;</span>,</span><br><span class="line">        expression: <span class="string">&quot;this.matches(\&quot;^[^\\\\s][\\u4e00-\\u9fa5\\\\w~!@#\\\\$%\\\\^&amp;\\\\*\\\\(\\\\)_+`\\\\-=&#123;&#125;|\\\\[\\\\];&#x27;:\\\&quot;,./&lt;&gt;?Â·\\\\s]&#123;1,100&#125;[^\\\\s]$\&quot;)&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">];  <span class="comment">// ç”¨æˆ·åã€æ˜µç§°ç”±æ±‰å­—/æ•°å­—/å­—æ¯/ç‰¹æ®Šå­—ç¬¦ï¼ˆ~!@#$%^&amp;*()_+`-=&#123;&#125;|[];&#x27;:&quot;,./&lt;&gt;?Â·ï¼‰ç»„æˆï¼Œæœ€å¤§æ”¯æŒ100ä¸ªå­—ç¬¦ï¼Œä¸¤è¾¹ä¸å…è®¸æœ‰ç©ºæ ¼ï¼Œä¸­é—´æ”¯æŒç©ºæ ¼</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>ä¸Šé¢è¿™ä¸¤ä¸ªä¹Ÿæ˜¯è¸©äº†å¾ˆå¤šå‘ï¼Œå–å·§çš„æ–¹æ³•æ˜¯ç›´æ¥è¯¢é—® <code>ChatGPT</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ä»¥ä¸‹æ˜¯ä¸€ä¸ªCELè¯­æ³•çš„å£°æ˜ </span><br><span class="line">```</span><br><span class="line">expression: &quot;this.matches(\&quot;reg\&quot;)&quot;,</span><br><span class="line">```</span><br><span class="line">å…¶ä¸­`reg`æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œä½¿ç”¨RE2è¯­æ³•ï¼Œä¸€ä¸ªç”±æ±‰å­—/æ•°å­—/å­—æ¯/ç‰¹æ®Šå­—ç¬¦ï¼ˆ~!@#$%^&amp;*()_+`-=&#123;&#125;|[];&#x27;:&quot;,./&lt;&gt;?Â·ï¼‰ç»„æˆï¼Œæœ€å¤§æ”¯æŒ100ä¸ªå­—ç¬¦ï¼Œä¸¤è¾¹ä¸å…è®¸æœ‰ç©ºæ ¼ï¼Œä¸­é—´æ”¯æŒç©ºæ ¼çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¯·å®Œå–„è¿™ä¸ªå£°æ˜ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ä»¥ä¸‹æ˜¯å®Œå–„åçš„å£°æ˜ï¼š</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">expression: &quot;this.matches(\&quot;[\\u4e00-\\u9fa5\\w~!@#$%^&amp;*()_+`\\-=&#123;&#125;|\\[\\];&#x27;:\&quot;,./&lt;&gt;?Â·]&#123;1,100&#125;\&quot;)&quot;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">è¿™ä¸ªå£°æ˜ä½¿ç”¨äº†Unicodeç¼–ç èŒƒå›´æ¥åŒ¹é…æ±‰å­—ã€æ•°å­—ã€å­—æ¯ã€ç‰¹æ®Šå­—ç¬¦ï¼ˆ~!@#$%^&amp;*()_+`-=&#123;&#125;|[];&#x27;:&quot;,./&lt;&gt;?Â·ï¼‰ï¼Œå¹¶ä¸”é™åˆ¶äº†æœ€å¤§å­—ç¬¦æ•°ä¸º100ä¸ªã€‚ä¸¤è¾¹ä¸å…è®¸æœ‰ç©ºæ ¼ï¼Œä¸­é—´å¯ä»¥æœ‰ç©ºæ ¼ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å‡ºç°æŠ¥é”™</span><br><span class="line">```</span><br><span class="line">compilation error: failed to compile expression nick_name: ERROR: &lt;input&gt;:1:14: Syntax error: token recognition error at: &#x27;\&quot;[\ä¸€-\é¾¥\\w&#x27;\n | this.matches(\&quot;[\ä¸€-\é¾¥\\w~!@#$%^&amp;*()_+`\\-=&#123;&#125;|\\[\\];&#x27;:\&quot;,./&lt;&gt;?Â·]&#123;1,100&#125;\&quot;)\n | .............^\nERROR: &lt;input&gt;:1:31: Syntax error: token recognition error at: &#x27;~&#x27;\n | this.matches(\&quot;[\ä¸€-\é¾¥\\w~!@#$%^&amp;*()_+`\\-=&#123;&#125;|\\[\\];&#x27;:\&quot;,./&lt;&gt;?Â·]&#123;1,100&#125;\&quot;)\n | ..............................^\nERROR: &lt;input&gt;:1:33: Syntax error: token recognition error at: &#x27;@&#x27;\n | this.matches(\&quot;[\ä¸€-\é¾¥\\w~!@#$%^&amp;*()_+`\\-=&#123;&#125;|\\[\\];&#x27;:\&quot;,./&lt;&gt;?Â·]&#123;1,100&#125;</span><br><span class="line">```</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">éå¸¸æŠ±æ­‰ï¼Œæˆ‘ä¹‹å‰çš„å›ç­”æœ‰ä¸€äº›é”™è¯¯ã€‚åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œéœ€è¦å¯¹ä¸€äº›ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ã€‚ä»¥ä¸‹æ˜¯ä¿®æ­£åçš„å£°æ˜ï¼š</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">expression: &quot;this.matches(\&quot;[\\u4e00-\\u9fa5\\w~!@#$%^&amp;*()_+`\\-=&#123;&#125;|\\[\\];&#x27;:\\\&quot;,./&lt;&gt;?Â·]&#123;1,100&#125;\&quot;)&quot;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">è¿™ä¸ªä¿®æ­£åçš„å£°æ˜ä½¿ç”¨äº†æ­£ç¡®çš„è½¬ä¹‰å­—ç¬¦ï¼Œå¹¶ä¸”é™åˆ¶äº†æœ€å¤§å­—ç¬¦æ•°ä¸º100ä¸ªã€‚ä¸¤è¾¹ä¸å…è®¸æœ‰ç©ºæ ¼ï¼Œä¸­é—´å¯ä»¥æœ‰ç©ºæ ¼ã€‚è¯·å°è¯•ä½¿ç”¨ä¿®æ­£åçš„å£°æ˜ã€‚</span><br></pre></td></tr></table></figure>

<p>ã€‚ã€‚ã€‚</p>
<p>å…¶å® <code>ChatGPT</code> çš„å›ç­”ä¹Ÿä¸æ˜¯å®Œå…¨æ­£ç¡®ï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥è°ƒè¯•ã€‚ä½†æ˜¯ä½¿ç”¨ <code>ChatGPT</code> ç¡®å®æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ€è·¯ã€‚</p>
<h1 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h1><p><span class="exturl" data-url="aHR0cHM6Ly9naW4tZ29uaWMuY29tL2RvY3MvZXhhbXBsZXMvYmluZGluZy1hbmQtdmFsaWRhdGlvbi8=">Model binding and validation<i class="fa fa-external-link-alt"></i></span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dycGMtZWNvc3lzdGVtL2dvLWdycGMtbWlkZGxld2FyZQ==">Go gRPC Middleware<i class="fa fa-external-link-alt"></i></span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2J1ZmJ1aWxkL3Byb3RvdmFsaWRhdGU=">protovalidate<i class="fa fa-external-link-alt"></i></span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2J1ZmJ1aWxkL3Byb3RvYy1nZW4tdmFsaWRhdGU=">protoc-gen-validate<i class="fa fa-external-link-alt"></i></span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2J1ZmJ1aWxkL3Byb3RvdmFsaWRhdGUtZ28=">protovalidate-go<i class="fa fa-external-link-alt"></i></span></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/developer/" rel="tag"># å¼€å‘æŠ€å·§</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/4a89.html" rel="prev" title="s3å®ç°è§†é¢‘åˆ†ç‰‡é¢„è§ˆ">
                  <i class="fa fa-chevron-left"></i> s3å®ç°è§†é¢‘åˆ†ç‰‡é¢„è§ˆ
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/931.html" rel="next" title="å†…ç½‘ç©¿é€ç¬”è®°">
                  å†…ç½‘ç©¿é€ç¬”è®° <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mitaka xu</span>
</div>
  <div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZw==">NexT.Gemini</span>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hpYW95ZXNoaXl1" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  


  <script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"TVx6Wkfs8VJGOwYPurtjWY2e-9Nh9j0Va","app_key":"c7VvaRnyF8r3DUIPq1x2KJ7Q","server_url":"https://tvx6wkfs.lc-cn-e1-shared.com","security":true}</script>
  <script src="/js/third-party/statistics/lean-analytics.js"></script>


<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"xiaoyeshiyu","count":false,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
