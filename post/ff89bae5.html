<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.1.1">
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="S_5aoPFd3QQihrUOLiKdVR0Mj4fj6n6qJojwyjj9cAY">
  <meta name="msvalidate.01" content="9032A67FCF787F07CB04374E59E518A9">
  <meta name="baidu-site-verification" content="code-Onlniop0d6">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha256-yIDrPSXHZdOZhAqiBP7CKzIwMQmRCJ8UeB8Jo17YC4o=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.css" integrity="sha256-6cQIC71/iBIYXFK+0RHAvwmjwWzkWd+r7v/BX3/vZDc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.xiaoyeshiyu.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.19.1","exturl":true,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":false,"nav":null,"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Elasticsearch 是一个开源的分布式搜索与分析引擎，提供了近实时搜索和聚合两大功能。">
<meta property="og:type" content="article">
<meta property="og:title" content="Elasticsearch 介绍">
<meta property="og:url" content="https://www.xiaoyeshiyu.com/post/ff89bae5.html">
<meta property="og:site_name" content="小夜时雨">
<meta property="og:description" content="Elasticsearch 是一个开源的分布式搜索与分析引擎，提供了近实时搜索和聚合两大功能。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F15-07-22-image-20240326150722041.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F15-21-20-image-20240326152120161.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F15-24-28-image-20240326152428393.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F15-31-54-image-20240326153154737.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F15-32-09-image-20240326153209382.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F15-32-23-image-20240326153223317.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F15-54-53-image-20240326155453238.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F16-15-26-screenshot-kibana-1-scale-motor-violations-dashboard.jpg">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F16-06-31-screenshot-kibana-9-explore-your-way-dashboard.jpg">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F16-02-42-image-20240326160242480.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F16-15-51-screenshot-kibana-11-guide-share-speed-dashboard.jpg">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F16-16-31-image-20240326161631846.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F16-18-13-image-20240326161813074.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F16-21-08-arcsight-diagram-adp.svg">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F16-21-14-arcsight-network-overview.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F16-24-01-image-20240326162401050.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F17-07-43-image-20240326170743464.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F10-59-40-image-20240327105940721.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F11-02-59-image-20240327110259396.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F11-57-06-image-20240327115706168.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F13-59-47-image-20240327135946927.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F15-17-13-image-20240327151713184.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F15-29-16-image-20240327152916246.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F15-41-11-image-20240327154111592.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F15-41-24-image-20240327154124045.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F15-42-10-image-20240327154210309.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F15-50-07-image-20240327155007753.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F15-50-45-image-20240327155045820.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F16-22-19-image-20240327162219438.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F16-24-15-image-20240327162415373.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F16-29-13-image-20240327162913735.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F16-29-38-image-20240327162938498.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F16-55-43-image-20240327165543068.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F17-02-26-image-20240327170226626.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F17-09-57-image-20240327170957075.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F17-12-43-image-20240327171243768.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F17-14-05-image-20240327171405088.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F17-22-49-image-20240327172249548.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F17-24-19-image-20240327172419369.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F17-25-06-image-20240327172506148.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F17-27-05-image-20240327172705122.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F17-27-42-image-20240327172742354.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F17-28-35-image-20240327172835596.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F17-29-19-image-20240327172919406.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/homework%2FPicGo%2F2024%2F03%2F27%2F21-43-27-image-20240327214326965.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/homework%2FPicGo%2F2024%2F03%2F27%2F21-44-21-image-20240327214421462.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/homework%2FPicGo%2F2024%2F03%2F27%2F21-44-41-image-20240327214441668.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/homework%2FPicGo%2F2024%2F03%2F27%2F21-45-08-image-20240327214508475.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/homework%2FPicGo%2F2024%2F03%2F27%2F21-45-39-image-20240327214539752.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/homework%2FPicGo%2F2024%2F03%2F27%2F21-47-29-image-20240327214729668.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/homework%2FPicGo%2F2024%2F03%2F27%2F21-49-37-image-20240327214937637.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F09-41-00-image-20240328094100585.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F11-59-51-image-20240328115951063.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F13-59-30-image-20240328135930518.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F14-10-09-image-20240328141009279.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F14-12-53-image-20240328141253484.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F14-30-30-image-20240328143030160.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F14-31-39-image-20240328143139845.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F14-33-55-image-20240328143355367.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F14-40-46-image-20240328144046638.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F14-43-54-image-20240328144354699.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F14-46-07-image-20240328144607235.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F14-51-54-image-20240328145154789.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F15-00-33-image-20240328150033272.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F15-06-24-image-20240328150624105.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F15-08-42-image-20240328150842500.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F15-11-25-image-20240328151124981.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F15-15-37-image-20240328151537025.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F15-17-48-image-20240328151748156.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F15-19-13-image-20240328151912945.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F15-22-07-image-20240328152207300.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F15-23-10-image-20240328152309952.png">
<meta property="og:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F15-24-32-image-20240328152431956.png">
<meta property="article:published_time" content="2024-03-25T16:00:00.000Z">
<meta property="article:modified_time" content="2024-03-29T03:16:32.206Z">
<meta property="article:author" content="Mitaka xu">
<meta property="article:tag" content="学习笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F15-07-22-image-20240326150722041.png">


<link rel="canonical" href="https://www.xiaoyeshiyu.com/post/ff89bae5.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://www.xiaoyeshiyu.com/post/ff89bae5.html","path":"post/ff89bae5.html","title":"Elasticsearch 介绍"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Elasticsearch 介绍 | 小夜时雨</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-MBVJ11TVHH"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-MBVJ11TVHH","only_pageview":false,"measure_protocol_api_secret":null}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?573725610fbc6ff9b42032bd13615370"></script>







  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start --><script src="https://cdn.jsdelivr.net/gh/BP-Devteam/sitescansense/s3module.min.js"></script><!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="小夜时雨" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">小夜时雨</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">君子敬其在己者，而不慕其在天者，是以日进也。</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Commonweal 404</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">概述</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B5%B7%E6%BA%90"><span class="nav-number">1.1.</span> <span class="nav-text">起源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84"><span class="nav-number">1.2.</span> <span class="nav-text">分布式架构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%94%AF%E6%8C%81%E5%A4%9A%E7%A7%8D%E6%96%B9%E5%BC%8F%E9%9B%86%E6%88%90%E6%8E%A5%E5%85%A5"><span class="nav-number">1.3.</span> <span class="nav-text">支持多种方式集成接入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD"><span class="nav-number">1.4.</span> <span class="nav-text">主要功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8D%E5%90%8C%E7%89%88%E6%9C%AC%E7%9A%84%E7%89%B9%E6%80%A7"><span class="nav-number">1.5.</span> <span class="nav-text">不同版本的特性</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ELK-%E5%AE%B6%E6%97%8F%E6%88%90%E5%91%98%E5%8F%8A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">2.</span> <span class="nav-text">ELK 家族成员及应用场景</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Logstash%EF%BC%9A%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E7%AE%A1%E9%81%93"><span class="nav-number">2.1.</span> <span class="nav-text">Logstash：数据处理管道</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kibana%EF%BC%9A%E5%8F%AF%E8%A7%86%E5%8C%96%E5%88%86%E6%9E%90%E5%88%A9%E5%99%A8"><span class="nav-number">2.2.</span> <span class="nav-text">Kibana：可视化分析利器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BEATS%EF%BC%9A%E8%BD%BB%E9%87%8F%E7%9A%84%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86%E5%99%A8"><span class="nav-number">2.3.</span> <span class="nav-text">BEATS：轻量的数据采集器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#X-Pack%EF%BC%9A%E5%95%86%E4%B8%9A%E5%8C%96%E5%A5%97%E4%BB%B6"><span class="nav-number">2.4.</span> <span class="nav-text">X-Pack：商业化套件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">2.5.</span> <span class="nav-text">应用场景</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86"><span class="nav-number">2.5.1.</span> <span class="nav-text">日志管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Elasticsearch-%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E9%9B%86%E6%88%90"><span class="nav-number">2.5.2.</span> <span class="nav-text">Elasticsearch 与数据库的集成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E6%A0%87%E5%88%86%E6%9E%90-%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90"><span class="nav-number">2.5.3.</span> <span class="nav-text">指标分析&#x2F;日志分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E5%88%86%E6%9E%90%EF%BC%9A%E9%9B%86%E6%88%90-ArcSight"><span class="nav-number">2.6.</span> <span class="nav-text">安全分析：集成 ArcSight</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E7%AE%80%E5%8D%95%E9%85%8D%E7%BD%AE"><span class="nav-number">3.</span> <span class="nav-text">安装与简单配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#JVM-%E9%85%8D%E7%BD%AE"><span class="nav-number">3.1.</span> <span class="nav-text">JVM 配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E6%9F%A5%E7%9C%8B%E6%8F%92%E4%BB%B6"><span class="nav-number">3.2.</span> <span class="nav-text">安装与查看插件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E6%9C%BA%E4%B8%8A%E8%BF%90%E8%A1%8C%E5%A4%9A%E4%B8%AA%E5%AE%9E%E4%BE%8B"><span class="nav-number">3.3.</span> <span class="nav-text">开发机上运行多个实例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kibana-%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E7%95%8C%E9%9D%A2%E5%BF%AB%E9%80%9F%E9%A2%84%E8%A7%88"><span class="nav-number">3.4.</span> <span class="nav-text">Kibana 的安装与界面快速预览</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Kibana-Plugin"><span class="nav-number">3.4.1.</span> <span class="nav-text">Kibana Plugin</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cerebro"><span class="nav-number">3.5.</span> <span class="nav-text">Cerebro</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Logstash"><span class="nav-number">3.6.</span> <span class="nav-text">Logstash</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-number">4.</span> <span class="nav-text">基本概念</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E6%A1%A3-Document"><span class="nav-number">4.1.</span> <span class="nav-text">文档 Document</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JSON-%E6%96%87%E6%A1%A3"><span class="nav-number">4.1.1.</span> <span class="nav-text">JSON 文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E6%A1%A3%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE"><span class="nav-number">4.1.2.</span> <span class="nav-text">文档的元数据</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95-Index"><span class="nav-number">4.2.</span> <span class="nav-text">索引 Index</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E4%B8%8D%E5%90%8C%E8%AF%AD%E6%84%8F"><span class="nav-number">4.2.1.</span> <span class="nav-text">索引的不同语意</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B-Type"><span class="nav-number">4.3.</span> <span class="nav-text">类型 Type</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E4%B8%8E%E7%B1%BB%E6%AF%94"><span class="nav-number">4.4.</span> <span class="nav-text">抽象与类比</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#REST-API"><span class="nav-number">4.5.</span> <span class="nav-text">REST API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E5%9F%BA%E6%9C%AC%E7%9A%84-API"><span class="nav-number">4.5.1.</span> <span class="nav-text">一些基本的 API</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4"><span class="nav-number">4.6.</span> <span class="nav-text">集群</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E7%89%B9%E6%80%A7"><span class="nav-number">4.6.1.</span> <span class="nav-text">分布式特性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8A%82%E7%82%B9"><span class="nav-number">4.7.</span> <span class="nav-text">节点</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Master-Node-Master-eligible-Node"><span class="nav-number">4.7.1.</span> <span class="nav-text">Master Node &amp; Master eligible Node</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Data-Node"><span class="nav-number">4.7.2.</span> <span class="nav-text">Data Node</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Coordinating-Node"><span class="nav-number">4.7.3.</span> <span class="nav-text">Coordinating Node</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hot-Warm-Node"><span class="nav-number">4.7.4.</span> <span class="nav-text">Hot &amp; Warm Node</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Machine-Learning-Node"><span class="nav-number">4.7.5.</span> <span class="nav-text">Machine Learning Node</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tribe-Node"><span class="nav-number">4.7.6.</span> <span class="nav-text">Tribe Node</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E8%8A%82%E7%82%B9%E7%B1%BB%E5%9E%8B"><span class="nav-number">4.8.</span> <span class="nav-text">配置节点类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E7%89%87"><span class="nav-number">4.9.</span> <span class="nav-text">分片</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E7%89%87%E7%9A%84%E8%AE%BE%E5%AE%9A"><span class="nav-number">4.9.1.</span> <span class="nav-text">分片的设定</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E5%81%A5%E5%BA%B7%E7%8A%B6%E5%86%B5"><span class="nav-number">4.9.2.</span> <span class="nav-text">查看集群健康状况</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%96%87%E6%A1%A3%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-number">5.</span> <span class="nav-text">文档的基本操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E6%A1%A3%E7%9A%84-CRUD"><span class="nav-number">5.1.</span> <span class="nav-text">文档的 CRUD</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Index-%E5%88%9B%E5%BB%BA"><span class="nav-number">5.1.1.</span> <span class="nav-text">Index 创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Create-%E5%88%9B%E5%BB%BA"><span class="nav-number">5.1.2.</span> <span class="nav-text">Create 创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Read-%E8%8E%B7%E5%8F%96"><span class="nav-number">5.1.3.</span> <span class="nav-text">Read 获取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Update-%E6%9B%B4%E6%96%B0"><span class="nav-number">5.1.4.</span> <span class="nav-text">Update 更新</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C"><span class="nav-number">5.2.</span> <span class="nav-text">批量操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%B9%E9%87%8F%E5%A4%9A%E6%93%8D%E4%BD%9C-Bulk"><span class="nav-number">5.2.1.</span> <span class="nav-text">批量多操作 Bulk</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%B9%E9%87%8F%E8%AF%BB%E5%8F%96-mget"><span class="nav-number">5.2.2.</span> <span class="nav-text">批量读取 mget</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%B9%E9%87%8F%E6%9F%A5%E8%AF%A2-msearch"><span class="nav-number">5.2.3.</span> <span class="nav-text">批量查询 msearch</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF%E8%BF%94%E5%9B%9E"><span class="nav-number">5.3.</span> <span class="nav-text">常见错误返回</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95"><span class="nav-number">6.</span> <span class="nav-text">倒排索引</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E7%BB%84%E6%88%90"><span class="nav-number">6.1.</span> <span class="nav-text">核心组成</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%80%9A%E8%BF%87-Analyzer-%E8%BF%9B%E8%A1%8C%E5%88%86%E8%AF%8D"><span class="nav-number">7.</span> <span class="nav-text">通过 Analyzer 进行分词</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Analysis-%E4%B8%8E-Analyzer"><span class="nav-number">7.1.</span> <span class="nav-text">Analysis 与 Analyzer</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Analyzer-%E7%9A%84%E7%BB%84%E6%88%90"><span class="nav-number">7.2.</span> <span class="nav-text">Analyzer  的组成</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Elasticsearch-%E7%9A%84%E5%88%86%E8%AF%8D%E5%99%A8"><span class="nav-number">7.3.</span> <span class="nav-text">Elasticsearch 的分词器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Standard-Analyzer"><span class="nav-number">7.3.1.</span> <span class="nav-text">Standard Analyzer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Simple-Analyzer"><span class="nav-number">7.3.2.</span> <span class="nav-text">Simple Analyzer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Whitespace-Analyzer"><span class="nav-number">7.3.3.</span> <span class="nav-text">Whitespace Analyzer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Stop-Analyzer"><span class="nav-number">7.3.4.</span> <span class="nav-text">Stop Analyzer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Keyword-Analyzer"><span class="nav-number">7.3.5.</span> <span class="nav-text">Keyword Analyzer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pattern-Analyzer"><span class="nav-number">7.3.6.</span> <span class="nav-text">Pattern Analyzer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Language-Analyzer"><span class="nav-number">7.3.7.</span> <span class="nav-text">Language Analyzer</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%AD%E5%88%86%E5%88%86%E8%AF%8D%E7%9A%84%E9%9A%BE%E7%82%B9"><span class="nav-number">7.4.</span> <span class="nav-text">中分分词的难点</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ICU-Analyzer"><span class="nav-number">7.4.1.</span> <span class="nav-text">ICU Analyzer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E5%A4%9A%E7%9A%84%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D%E5%99%A8"><span class="nav-number">7.4.2.</span> <span class="nav-text">更多的中文分词器</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Search-API"><span class="nav-number">8.</span> <span class="nav-text">Search API</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#URI-%E6%9F%A5%E8%AF%A2"><span class="nav-number">8.1.</span> <span class="nav-text">URI 查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Request-Body"><span class="nav-number">8.2.</span> <span class="nav-text">Request Body</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%90%9C%E7%B4%A2-Response"><span class="nav-number">8.3.</span> <span class="nav-text">搜索 Response</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%90%9C%E7%B4%A2%E7%9A%84%E7%9B%B8%E5%85%B3%E6%80%A7-Relevance"><span class="nav-number">8.4.</span> <span class="nav-text">搜索的相关性 Relevance</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Web-%E6%90%9C%E7%B4%A2"><span class="nav-number">8.4.1.</span> <span class="nav-text">Web 搜索</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%B5%E5%95%86%E6%90%9C%E7%B4%A2"><span class="nav-number">8.4.2.</span> <span class="nav-text">电商搜索</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A1%E9%87%8F%E7%9B%B8%E5%85%B3%E6%80%A7"><span class="nav-number">8.4.3.</span> <span class="nav-text">衡量相关性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Precision-Recall"><span class="nav-number">8.4.4.</span> <span class="nav-text">Precision &amp; Recall</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Search"><span class="nav-number">9.</span> <span class="nav-text">Search</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#URI-Search"><span class="nav-number">9.1.</span> <span class="nav-text">URI Search</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E8%AF%AD%E6%B3%95"><span class="nav-number">9.1.1.</span> <span class="nav-text">一些语法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Request-Body-Search"><span class="nav-number">9.2.</span> <span class="nav-text">Request Body Search</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">9.2.1.</span> <span class="nav-text">查询表达式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Mapping"><span class="nav-number">10.</span> <span class="nav-text">Mapping</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E6%AE%B5%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">10.1.</span> <span class="nav-text">字段数据类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dynamic-Mapping"><span class="nav-number">10.2.</span> <span class="nav-text">Dynamic Mapping</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%98%BE%E5%BC%8F-Mapping-%E8%AE%BE%E7%BD%AE%E4%B8%8E%E5%B8%B8%E8%A7%81%E5%8F%82%E6%95%B0%E4%BB%8B%E7%BB%8D"><span class="nav-number">10.3.</span> <span class="nav-text">显式 Mapping 设置与常见参数介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6%E5%BD%93%E5%89%8D%E5%AD%97%E6%AE%B5%E6%98%AF%E5%90%A6%E8%A2%AB%E7%B4%A2%E5%BC%95"><span class="nav-number">10.3.1.</span> <span class="nav-text">控制当前字段是否被索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null-value"><span class="nav-number">10.3.2.</span> <span class="nav-text">null_value</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#copy-to"><span class="nav-number">10.3.3.</span> <span class="nav-text">copy_to</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E7%BB%84%E7%B1%BB%E5%9E%8B"><span class="nav-number">10.3.4.</span> <span class="nav-text">数组类型</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A4%9A%E5%AD%97%E6%AE%B5%E7%89%B9%E6%80%A7%E5%8F%8A%E9%85%8D%E7%BD%AE%E8%87%AA%E5%AE%9A%E4%B9%89-Analyzer"><span class="nav-number">11.</span> <span class="nav-text">多字段特性及配置自定义 Analyzer</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Exact-Values-vs-Full-Text"><span class="nav-number">11.1.</span> <span class="nav-text">Exact Values vs Full Text</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E8%AF%8D"><span class="nav-number">11.2.</span> <span class="nav-text">自定义分词</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Character-Filter"><span class="nav-number">11.2.1.</span> <span class="nav-text">Character Filter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tokenizer"><span class="nav-number">11.2.2.</span> <span class="nav-text">Tokenizer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Token-Filter"><span class="nav-number">11.2.3.</span> <span class="nav-text">Token Filter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E4%B8%80%E4%B8%AA-Custom-Aanlyzer"><span class="nav-number">11.2.4.</span> <span class="nav-text">设置一个 Custom Aanlyzer</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Index-Template-%E5%92%8C-Dynamic-Template"><span class="nav-number">12.</span> <span class="nav-text">Index Template 和 Dynamic Template</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Index-Template"><span class="nav-number">12.1.</span> <span class="nav-text">Index Template</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Index-Template-%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F"><span class="nav-number">12.1.1.</span> <span class="nav-text">Index Template 的工作方式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dynamic-Template"><span class="nav-number">12.2.</span> <span class="nav-text">Dynamic Template</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%81%9A%E5%90%88%E5%88%86%E6%9E%90"><span class="nav-number">13.</span> <span class="nav-text">聚合分析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Kibana-%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8A%A5%E8%A1%A8-%E8%81%9A%E5%90%88%E5%88%86%E6%9E%90"><span class="nav-number">13.1.</span> <span class="nav-text">Kibana 可视化报表 - 聚合分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9B%86%E5%90%88%E7%9A%84%E5%88%86%E7%B1%BB"><span class="nav-number">13.2.</span> <span class="nav-text">集合的分类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Bucket-Metric"><span class="nav-number">13.2.1.</span> <span class="nav-text">Bucket &amp; Metric</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B5%8C%E5%A5%97"><span class="nav-number">13.2.2.</span> <span class="nav-text">嵌套</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Mitaka xu"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Mitaka xu</p>
  <div class="site-description" itemprop="description">Golang开发博客</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">144</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hpYW95ZXNoaXl1" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;xiaoyeshiyu"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.xiaoyeshiyu.com/post/ff89bae5.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mitaka xu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小夜时雨">
      <meta itemprop="description" content="Golang开发博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Elasticsearch 介绍 | 小夜时雨">
      <meta itemprop="description" content="Elasticsearch 是一个开源的分布式搜索与分析引擎，提供了近实时搜索和聚合两大功能。">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Elasticsearch 介绍
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-03-26 00:00:00" itemprop="dateCreated datePublished" datetime="2024-03-26T00:00:00+08:00">2024-03-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-03-29 11:16:32" itemprop="dateModified" datetime="2024-03-29T11:16:32+08:00">2024-03-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Elasticsearch/" itemprop="url" rel="index"><span itemprop="name">Elasticsearch</span></a>
        </span>
    </span>

  
    <span id="/post/ff89bae5.html" class="post-meta-item leancloud_visitors" data-flag-title="Elasticsearch 介绍" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

            <div class="post-description">Elasticsearch 是一个开源的分布式搜索与分析引擎，提供了近实时搜索和聚合两大功能。</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><ul>
<li>开源分布式搜索分析引擎<ul>
<li>近实时（Near Real Time）</li>
<li>分布式存储&#x2F;搜索&#x2F;分析引擎</li>
</ul>
</li>
</ul>
<p>Solr 和 Splunk 提供的功能跟 Elasticsearch 很相似。但是 Elasticsearch 使用更加广泛，在搜索引擎中排名第一。</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9kYi1lbmdpbmVzLmNvbS9lbi9yYW5raW5n">https://db-engines.com/en/ranking<i class="fa fa-external-link-alt"></i></span></p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F15-07-22-image-20240326150722041.png" alt="image-20240326150722041"></p>
<h2 id="起源"><a href="#起源" class="headerlink" title="起源"></a>起源</h2><p>Elasticsearch 是起源于 Lucene。</p>
<ul>
<li>基于 Java 语言开发的搜索引擎类库</li>
<li>Lucene 具有高性能、易扩展的优点</li>
<li>Lucene 的局限性：<ul>
<li>只能基于 Java 语言开发</li>
<li>类库的接口学习曲线陡峭</li>
<li>原生并不支持水平扩展</li>
</ul>
</li>
</ul>
<p>2004 年 Shay Banon 基于 Lucene 开发了 Compass；</p>
<p>2010 年 Shay Banon 重写了 Compass，取名 Elasticsearch</p>
<ul>
<li>支持分布式，可水平扩展</li>
<li>降低全文检索的学习曲线，可以被任何编程语言调用</li>
</ul>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9jbi9zdXBwb3J0L2VvbA==">Elastic 产品生命周期结束日期<i class="fa fa-external-link-alt"></i></span></p>
<h2 id="分布式架构"><a href="#分布式架构" class="headerlink" title="分布式架构"></a>分布式架构</h2><p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F15-21-20-image-20240326152120161.png" alt="image-20240326152120161"></p>
<ul>
<li>集群规模可以从单个扩展至数百个节点</li>
<li>高可用 &amp; 水平扩展<ul>
<li>服务和数据两个维度</li>
</ul>
</li>
<li>支持不同的节点类型<ul>
<li>支持 Hot &amp; Warm 架构（一般用于日志类型数据）</li>
</ul>
</li>
</ul>
<h2 id="支持多种方式集成接入"><a href="#支持多种方式集成接入" class="headerlink" title="支持多种方式集成接入"></a>支持多种方式集成接入</h2><ul>
<li><p>多种编程语言的类库：<span class="exturl" data-url="aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9ndWlkZS9lbi9lbGFzdGljc2VhcmNoL2NsaWVudC9pbmRleC5odG1s">https://www.elastic.co/guide/en/elasticsearch/client/index.html<i class="fa fa-external-link-alt"></i></span></p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F15-24-28-image-20240326152428393.png" alt="image-20240326152428393"></p>
</li>
<li><p>RESTful API vs Transport API</p>
<ul>
<li>9200 vs 9300 （建议使用 RESTful API）</li>
</ul>
</li>
<li><p>JDBC &amp; ODBC</p>
</li>
</ul>
<h2 id="主要功能"><a href="#主要功能" class="headerlink" title="主要功能"></a>主要功能</h2><ul>
<li>海量数据的分布式存储以及集群管理<ul>
<li>服务与数据的高可用，水平扩展</li>
</ul>
</li>
<li>近实时搜索，性能卓越<ul>
<li>结构化 &#x2F; 全文 &#x2F; 地理位置 &#x2F; 自动完成</li>
</ul>
</li>
<li>海量数据的近实时分析<ul>
<li>聚合功能</li>
</ul>
</li>
</ul>
<p>相比关系型数据库，Elasticsearch 提供了如模糊查询，搜索条件的算分第等关系型数据库所不擅长的功能，但是在事务性等方面，也不如关系型数据库来的强大。因此，在实际 生产环境中，需要考虑具体业务要求，综合使用。</p>
<h2 id="不同版本的特性"><a href="#不同版本的特性" class="headerlink" title="不同版本的特性"></a>不同版本的特性</h2><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9jbi9zdXBwb3J0L2VvbA==">Elastic 产品生命周期结束日期<i class="fa fa-external-link-alt"></i></span></p>
<p>5.x</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F15-31-54-image-20240326153154737.png" alt="image-20240326153154737"></p>
<p>6.x</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F15-32-09-image-20240326153209382.png" alt="image-20240326153209382"></p>
<p>7.x</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F15-32-23-image-20240326153223317.png" alt="image-20240326153223317"></p>
<h1 id="ELK-家族成员及应用场景"><a href="#ELK-家族成员及应用场景" class="headerlink" title="ELK 家族成员及应用场景"></a>ELK 家族成员及应用场景</h1><p>Elastic Stack 包括 Elasticsearch, Kibana, Logstash, Beats 等一系列产品. </p>
<p>Elasticsearch 是核心引擎,提供了海量数据存储,搜索和聚合的能力.</p>
<p>Beats 是轻量的数据采集器,</p>
<p>Logstash用来做数据转换,</p>
<p>Kibana 则提供了丰富的可视化展现与分析的功能.</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F15-54-53-image-20240326155453238.png" alt="image-20240326155453238"></p>
<h2 id="Logstash：数据处理管道"><a href="#Logstash：数据处理管道" class="headerlink" title="Logstash：数据处理管道"></a>Logstash：数据处理管道</h2><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9jbi9sb2dzdGFzaA==">https://www.elastic.co/cn/logstash<i class="fa fa-external-link-alt"></i></span></p>
<ul>
<li>开源的服务器端数据处理管道，支持从不同来源采集数据，转换数据，并将数据发送到不同的存储库中</li>
<li>Logstash 诞生于 2009年，最初用来做日志的采集与处理，2013年被 Elasticsearch 收购</li>
</ul>
<p>特性：</p>
<ul>
<li>实时解析和转换数据<ul>
<li>从 IP 地址破译出地理坐标</li>
<li>将 PII 数据匿名化，完全排除敏感字段</li>
</ul>
</li>
<li>可扩展<ul>
<li>200 多个插件（日志&#x2F;数据库&#x2F;Arcsigh&#x2F;Netflow）</li>
</ul>
</li>
<li>可靠性安全性<ul>
<li>Logstash 会通过持久化队列来保证至少将运行中的事情传达一次</li>
<li>数据传输加密</li>
</ul>
</li>
<li>监控</li>
</ul>
<h2 id="Kibana：可视化分析利器"><a href="#Kibana：可视化分析利器" class="headerlink" title="Kibana：可视化分析利器"></a>Kibana：可视化分析利器</h2><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9jbi9raWJhbmE=">https://www.elastic.co/cn/kibana<i class="fa fa-external-link-alt"></i></span></p>
<ul>
<li>Kibana 名字的含义 &#x3D; Kiwifruit + Banana</li>
<li>数据可视化工具，帮助用户解开对数据的任何疑问</li>
<li>最早是基于 Logstash 的工具，2013 年加入 Elasticsearch</li>
</ul>
<p>特性：</p>
<p>提供可视化图表：</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F16-15-26-screenshot-kibana-1-scale-motor-violations-dashboard.jpg" alt="img"></p>
<p>通过机器学习，做异常检测</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F16-06-31-screenshot-kibana-9-explore-your-way-dashboard.jpg" alt="img"></p>
<h2 id="BEATS：轻量的数据采集器"><a href="#BEATS：轻量的数据采集器" class="headerlink" title="BEATS：轻量的数据采集器"></a>BEATS：轻量的数据采集器</h2><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9jbi9wcm9kdWN0cy9iZWF0cw==">https://www.elastic.co/cn/products/beats<i class="fa fa-external-link-alt"></i></span></p>
<p>使用 go 语言开发</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F16-02-42-image-20240326160242480.png" alt="image-20240326160242480"></p>
<h2 id="X-Pack：商业化套件"><a href="#X-Pack：商业化套件" class="headerlink" title="X-Pack：商业化套件"></a>X-Pack：商业化套件</h2><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9wcmljaW5n">https://www.elastic.co/pricing<i class="fa fa-external-link-alt"></i></span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9jbi9zdWJzY3JpcHRpb25z">https://www.elastic.co/cn/subscriptions<i class="fa fa-external-link-alt"></i></span></p>
<ul>
<li>6.3 之前的版本，X-Pack 以插件方式安装</li>
<li>X-Pack 开源以后，Elasticsearch &amp; Kibana 支持 OSS 版和 Basic 两种版本（开源版本和免费版本）<ul>
<li>部分 X-Pack 功能支持免费使用，6.8 和 7.1 开始，Security 功能免费</li>
<li>OSS，Basic，黄金级，白金级</li>
</ul>
</li>
</ul>
<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><p>Elastic Stack 主要被广泛使用于：搜索，日志管理，安全分析，指标分析，业务分析， 应用性能监控等多个领域</p>
<p>分为两大类：搜索和数据分析</p>
<ul>
<li>网站搜索（门户网站、购物网站）&#x2F;垂直搜索&#x2F;代码搜索（github）</li>
<li>日志管理与分析&#x2F;安全指标监控&#x2F;应用性能监控&#x2F;WEB抓取舆情分</li>
</ul>
<h3 id="日志管理"><a href="#日志管理" class="headerlink" title="日志管理"></a>日志管理</h3><ol>
<li>日志搜集</li>
<li>格式化分析</li>
<li>全文检索</li>
<li>风险告警</li>
</ol>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F16-15-51-screenshot-kibana-11-guide-share-speed-dashboard.jpg" alt="img"></p>
<h3 id="Elasticsearch-与数据库的集成"><a href="#Elasticsearch-与数据库的集成" class="headerlink" title="Elasticsearch 与数据库的集成"></a>Elasticsearch 与数据库的集成</h3><p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F16-16-31-image-20240326161631846.png" alt="image-20240326161631846"></p>
<ul>
<li>一种情况是单独使用 Elasticsearch 存储：简单，高效</li>
<li>以下情况可考虑与数据库集成：将数据写入数据库，然后使用同步机制，将数据同步到 Elasticsearch<ul>
<li>与现有系统的集成</li>
<li>需考虑事务性</li>
<li>数据更新频繁</li>
</ul>
</li>
</ul>
<h3 id="指标分析-日志分析"><a href="#指标分析-日志分析" class="headerlink" title="指标分析&#x2F;日志分析"></a>指标分析&#x2F;日志分析</h3><p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F16-18-13-image-20240326161813074.png" alt="image-20240326161813074"></p>
<p>当数据量大的时候，需要引入缓冲层，例如 Redis、Kafka、RabbitMQ 这种具备削峰的队列，Logstash 将日志进行转化和聚合，存储到 Elasticsearch，基于持久化的数据，可以通过 Grafana、Kibana 做数据分析和展示。</p>
<h2 id="安全分析：集成-ArcSight"><a href="#安全分析：集成-ArcSight" class="headerlink" title="安全分析：集成 ArcSight"></a>安全分析：集成 ArcSight</h2><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9ndWlkZS9lbi9sb2dzdGFzaC9jdXJyZW50L2FyY3NpZ2h0LW1vZHVsZS5odG1sI2FyY3NpZ2h0LW1vZHVsZQ==">https://www.elastic.co/guide/en/logstash/current/arcsight-module.html#arcsight-module<i class="fa fa-external-link-alt"></i></span></p>
<p>Logstash ArcSight 模块能够轻松地将 ArcSight 数据与 Elastic Stack 集成。通过一个命令，该模块直接连接到 ArcSight Smart Connector 或事件代理，解析并索引安全事件到 Elasticsearch，并安装一套 Kibana 仪表板。</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F16-21-08-arcsight-diagram-adp.svg" alt="ArcSight Event Broker architecture"></p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F16-21-14-arcsight-network-overview.png" alt="Network overview dashboard"></p>
<h1 id="安装与简单配置"><a href="#安装与简单配置" class="headerlink" title="安装与简单配置"></a>安装与简单配置</h1><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9jbi9kb3dubG9hZHMvZWxhc3RpY3NlYXJjaA==">https://www.elastic.co/cn/downloads/elasticsearch<i class="fa fa-external-link-alt"></i></span></p>
<p>更加推荐使用 docker </p>
<p>文件目录结构</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F16-24-01-image-20240326162401050.png" alt="image-20240326162401050"></p>
<h2 id="JVM-配置"><a href="#JVM-配置" class="headerlink" title="JVM 配置"></a>JVM 配置</h2><ul>
<li>修改 JVM - <code>config/jvm.options</code><ul>
<li>7.1 下载的默认设置是 1GB</li>
</ul>
</li>
<li>配置的建议<ul>
<li>Xmx 和 Xms 设置成一样 （最小最大内存设置成一样）</li>
<li>Xmx 不要超过内机器内存的 50%</li>
<li>内存总量不要超过 30GB：<span class="exturl" data-url="aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9ibG9nL2EtaGVhcC1vZi10cm91Ymxl">https://www.elastic.co/blog/a-heap-of-trouble<i class="fa fa-external-link-alt"></i></span></li>
</ul>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ps axuf|grep elasticsearch</span></span><br><span class="line">elastic+   39297  0.9  2.5 2541816 100596 ?      Ssl  16:35   0:03 /usr/share/elasticsearch/jdk/bin/java -Xms4m -Xmx64m -XX:+UseSerialGC -Dcli.name=server -Dcli.script=/usr/share/elasticsearch/bin/elasticsearch -Dcli.libs=lib/tools/server-cli -Des.path.home=/usr/share/elasticsearch -Des.path.conf=/etc/elasticsearch -Des.distribution.type=deb -<span class="built_in">cp</span> /usr/share/elasticsearch/lib/*:/usr/share/elasticsearch/lib/cli-launcher/* org.elasticsearch.launcher.CliToolLauncher -p /var/run/elasticsearch/elasticsearch.pid --quiet</span><br></pre></td></tr></table></figure>

<p>配置目录是 <code>/etc/elasticsearch</code>，修改里面的文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim jvm.options</span></span><br></pre></td></tr></table></figure>

<p>ps: </p>
<ul>
<li>默认安装会打开 <code>xpack.security</code>，需要打开 <code>https</code> 页面，并且输入账号密码。可以关闭此功能。</li>
<li>如果打不开，可能是由于绑定地址为 <code>localhost</code>，而不是对外网口，修改配置文件 <code>/etc/elasticsearch/elasticsearch.yml</code> 中的 <code>network.host:</code> 为 <code>0.0.0.0</code></li>
</ul>
<p>8.x 版本默认开启安装访问，需要进入 <code>https</code>，页面打开输入的账号密码需要手动设置：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/elasticsearch-setup-passwords interactive</span><br></pre></td></tr></table></figure>

<p>需要输入多个用户的密码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Please confirm that you would like to <span class="built_in">continue</span> [y/N]y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Enter password <span class="keyword">for</span> [elastic]:</span><br><span class="line">Reenter password <span class="keyword">for</span> [elastic]:</span><br><span class="line">Enter password <span class="keyword">for</span> [apm_system]:</span><br><span class="line">Reenter password <span class="keyword">for</span> [apm_system]:</span><br><span class="line">Enter password <span class="keyword">for</span> [kibana_system]:</span><br><span class="line">Reenter password <span class="keyword">for</span> [kibana_system]:</span><br><span class="line">Enter password <span class="keyword">for</span> [logstash_system]:</span><br><span class="line">Reenter password <span class="keyword">for</span> [logstash_system]:</span><br><span class="line">Enter password <span class="keyword">for</span> [beats_system]:</span><br><span class="line">Reenter password <span class="keyword">for</span> [beats_system]:</span><br><span class="line">Enter password <span class="keyword">for</span> [remote_monitoring_user]:</span><br><span class="line">Reenter password <span class="keyword">for</span> [remote_monitoring_user]:</span><br><span class="line">Changed password <span class="keyword">for</span> user [apm_system]</span><br><span class="line">Changed password <span class="keyword">for</span> user [kibana_system]</span><br><span class="line">Changed password <span class="keyword">for</span> user [kibana]</span><br><span class="line">Changed password <span class="keyword">for</span> user [logstash_system]</span><br><span class="line">Changed password <span class="keyword">for</span> user [beats_system]</span><br><span class="line">Changed password <span class="keyword">for</span> user [remote_monitoring_user]</span><br><span class="line">Changed password <span class="keyword">for</span> user [elastic]</span><br></pre></td></tr></table></figure>

<p>登录之后，显示节点信息</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;master&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;cluster_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;elasticsearch&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;cluster_uuid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AKD4VWA2Q_yEsRthAG4ITw&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;number&quot;</span><span class="punctuation">:</span> <span class="string">&quot;8.12.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build_flavor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;default&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;deb&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build_hash&quot;</span><span class="punctuation">:</span> <span class="string">&quot;48a287ab9497e852de30327444b0809e55d46466&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build_date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-02-19T10:04:32.774273190Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build_snapshot&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lucene_version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;9.9.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;minimum_wire_compatibility_version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7.17.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;minimum_index_compatibility_version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7.0.0&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tagline&quot;</span><span class="punctuation">:</span> <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="安装与查看插件"><a href="#安装与查看插件" class="headerlink" title="安装与查看插件"></a>安装与查看插件</h2><p><code>/_cat/plugins/?v</code> 可以查看插件安装状态</p>
<p>进入到 <code>es</code> 的安装目录 <code>/usr/share/elasticsearch</code>，可通过 <code>ps aux</code> 查看</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bin/elasticsearch-plugin list</span></span><br><span class="line"><span class="comment"># bin/elasticsearch-plugin install analysis-icu</span></span><br><span class="line">-&gt; Installing analysis-icu</span><br><span class="line">-&gt; Downloading analysis-icu from elastic</span><br><span class="line">[=================================================] 100%</span><br><span class="line">-&gt; Installed analysis-icu</span><br><span class="line">-&gt; Please restart Elasticsearch to activate any plugins installed</span><br><span class="line"><span class="comment"># bin/elasticsearch-plugin list</span></span><br><span class="line">analysis-icu</span><br></pre></td></tr></table></figure>

<p>重启 Elasticsearch 后，浏览器中可以看到已安装</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F26%2F17-07-43-image-20240326170743464.png" alt="image-20240326170743464"></p>
<p>Elasticsearch 提供插件的机制对系统进行扩展</p>
<ul>
<li>Discovery Plugin</li>
<li>Analysis Plugin</li>
<li>Security Plugin</li>
<li>Management Plugin</li>
<li>Ingest Plugin</li>
<li>Mapper Plugin</li>
<li>Backup Plugin</li>
</ul>
<h2 id="开发机上运行多个实例"><a href="#开发机上运行多个实例" class="headerlink" title="开发机上运行多个实例"></a>开发机上运行多个实例</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./bin/<span class="attribute">elasticsearch</span> -d -E cluster.name=my_cluster -E node.name=node_1 -E path.data=node_1_data </span><br><span class="line">./bin/elasticsearch -d -E cluster.name=my_cluster -E node.name=node_2 -E path.data=node_2_data </span><br><span class="line">./bin/elasticsearch -d -E cluster.name=my_cluster -E node.name=node_3 -E path.data=node_3_data </span><br></pre></td></tr></table></figure>

<p>查看节点 <code>/_cat/nodes?v</code></p>
<p>关闭进程通过 <code>kill &lt;pid&gt;</code></p>
<h2 id="Kibana-的安装与界面快速预览"><a href="#Kibana-的安装与界面快速预览" class="headerlink" title="Kibana 的安装与界面快速预览"></a>Kibana 的安装与界面快速预览</h2><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9ndWlkZS9lbi9raWJhbmEvOC4xMi9pbnN0YWxsLmh0bWw=">https://www.elastic.co/guide/en/kibana/8.12/install.html<i class="fa fa-external-link-alt"></i></span></p>
<p>通过 <code>5601</code> 端口进入。</p>
<ul>
<li>如果打不开，可能是由于绑定地址为 <code>localhost</code>，而不是对外网口，修改配置文件 <code>/etc/kibana/kibana.yml</code> 中的 <code>server.host:</code> 为 <code>0.0.0.0</code></li>
</ul>
<p>页面打开之后，通过上面配置的账号密码登录。</p>
<p>默认会安装 APM，按照页面指令安装即可。</p>
<p>登录进去之后，在 <code>Home</code> - <code>Try sample data</code> - <code>Other sample data sets</code> 中，上传测试数据到 Elasticsearch 中。</p>
<p>在 <code>Management</code> - <code>Dev Tools</code> 页面，可以通过 Elasticsearch 命令操作，通过点击 <code>help</code> 可以查看快捷键。</p>
<h3 id="Kibana-Plugin"><a href="#Kibana-Plugin" class="headerlink" title="Kibana Plugin"></a>Kibana Plugin</h3><p>增强应用，以及一些图表功能</p>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9ndWlkZS9lbi9raWJhbmEvY3VycmVudC9raWJhbmEtcGx1Z2lucy5odG1sI2tub3duLWtpYmFuYS1wbHVnaW5z">https://www.elastic.co/guide/en/kibana/current/kibana-plugins.html#known-kibana-plugins<i class="fa fa-external-link-alt"></i></span></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ./bin/kibana-plugin</span></span><br><span class="line">    install  [options] &lt;plugin/url&gt; install a plugin</span><br></pre></td></tr></table></figure>

<h2 id="Cerebro"><a href="#Cerebro" class="headerlink" title="Cerebro"></a>Cerebro</h2><p>一个 Elasticsearch 网页管理工具：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xtZW5lemVzL2NlcmVicm8=">https://github.com/lmenezes/cerebro<i class="fa fa-external-link-alt"></i></span></p>
<p>由于需要安装 Java 的环境，比较麻烦，这里推荐使用 docker</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 9000:9000 --env-file env-ldap  lmenezes/cerebro</span><br></pre></td></tr></table></figure>

<p>打开 9000 端口即可。</p>
<h2 id="Logstash"><a href="#Logstash" class="headerlink" title="Logstash"></a>Logstash</h2><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9jbi9kb3dubG9hZHMvbG9nc3Rhc2g=">https://www.elastic.co/cn/downloads/logstash<i class="fa fa-external-link-alt"></i></span></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/logstash -f logstash.conf</span><br></pre></td></tr></table></figure>

<p>下载测试集</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9ncm91cGxlbnMub3JnL2RhdGFzZXRzL21vdmllbGVucy8=">https://grouplens.org/datasets/movielens/<i class="fa fa-external-link-alt"></i></span></p>
<p>也就是下载：<span class="exturl" data-url="aHR0cHM6Ly9maWxlcy5ncm91cGxlbnMub3JnL2RhdGFzZXRzL21vdmllbGVucy9tbC0yNW0uemlw">https://files.grouplens.org/datasets/movielens/ml-25m.zip<i class="fa fa-external-link-alt"></i></span></p>
<p>编辑导入文件的配置文件 <code>logstash.conf</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">input <span class="punctuation">&#123;</span></span><br><span class="line">  file <span class="punctuation">&#123;</span></span><br><span class="line">    path =&gt; <span class="string">&quot;/mnt/sdb/movies.csv&quot;</span>  <span class="comment">// 要导入的文件存储位置</span></span><br><span class="line">    start_position =&gt; <span class="string">&quot;beginning&quot;</span></span><br><span class="line">    sincedb_path =&gt; <span class="string">&quot;/dev/null&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">filter <span class="punctuation">&#123;</span></span><br><span class="line">  csv <span class="punctuation">&#123;</span></span><br><span class="line">    separator =&gt; <span class="string">&quot;,&quot;</span></span><br><span class="line">    columns =&gt; <span class="punctuation">[</span><span class="string">&quot;id&quot;</span><span class="punctuation">,</span><span class="string">&quot;content&quot;</span><span class="punctuation">,</span><span class="string">&quot;genre&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">  mutate <span class="punctuation">&#123;</span></span><br><span class="line">    split =&gt; <span class="punctuation">&#123;</span> <span class="string">&quot;genre&quot;</span> =&gt; <span class="string">&quot;|&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">    remove_field =&gt; <span class="punctuation">[</span><span class="string">&quot;path&quot;</span><span class="punctuation">,</span> <span class="string">&quot;host&quot;</span><span class="punctuation">,</span><span class="string">&quot;@timestamp&quot;</span><span class="punctuation">,</span><span class="string">&quot;message&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">  mutate <span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line">    split =&gt; <span class="punctuation">[</span><span class="string">&quot;content&quot;</span><span class="punctuation">,</span> <span class="string">&quot;(&quot;</span><span class="punctuation">]</span></span><br><span class="line">    add_field =&gt; <span class="punctuation">&#123;</span> <span class="string">&quot;title&quot;</span> =&gt; <span class="string">&quot;%&#123;[content][0]&#125;&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">    add_field =&gt; <span class="punctuation">&#123;</span> <span class="string">&quot;year&quot;</span> =&gt; <span class="string">&quot;%&#123;[content][1]&#125;&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">  mutate <span class="punctuation">&#123;</span></span><br><span class="line">    convert =&gt; <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="string">&quot;year&quot;</span> =&gt; <span class="string">&quot;integer&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">    strip =&gt; <span class="punctuation">[</span><span class="string">&quot;title&quot;</span><span class="punctuation">]</span></span><br><span class="line">    remove_field =&gt; <span class="punctuation">[</span><span class="string">&quot;path&quot;</span><span class="punctuation">,</span> <span class="string">&quot;host&quot;</span><span class="punctuation">,</span><span class="string">&quot;@timestamp&quot;</span><span class="punctuation">,</span><span class="string">&quot;message&quot;</span><span class="punctuation">,</span><span class="string">&quot;content&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">output <span class="punctuation">&#123;</span></span><br><span class="line">   elasticsearch <span class="punctuation">&#123;</span></span><br><span class="line">     hosts =&gt; <span class="string">&quot;https://localhost:9200&quot;</span> <span class="comment">// 使用 https 时填写 https 相关内容</span></span><br><span class="line">     index =&gt; <span class="string">&quot;movies&quot;</span></span><br><span class="line">     document_id =&gt; <span class="string">&quot;%&#123;id&#125;&quot;</span></span><br><span class="line">     user =&gt; <span class="string">&quot;elastic&quot;</span>  <span class="comment">// 用户名</span></span><br><span class="line">     password =&gt; <span class="string">&quot;xxx&quot;</span>  <span class="comment">// 密码</span></span><br><span class="line">     ssl =&gt; <span class="string">&quot;true&quot;</span>  <span class="comment">// 指定使用 ssl</span></span><br><span class="line">     cacert =&gt; <span class="string">&quot;/mnt/sdb/elasticsearch-8.12.2/config/certs/http_ca.crt&quot;</span> <span class="comment">// 证书存放位置</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line">  stdout <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>执行命令导入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/logstash -f logstash.conf</span><br></pre></td></tr></table></figure>

<p>导入后，可以看到有 <code>movies</code> 的 <code>index</code></p>
<p><code>/_cat/indices?v</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yellow open   movies                                                         ay_XjQBsTpWoLszNQNPDgQ   1   1      62424            0     14.5mb         14.5mb       14.5mb</span><br></pre></td></tr></table></figure>

<h1 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h1><p>Elasticsearch  中有很多概念，例如 Document、Index 和 Type</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F10-59-40-image-20240327105940721.png" alt="image-20240327105940721"></p>
<p>可以理解为：</p>
<ul>
<li>Index 索引<ul>
<li>Type 类型</li>
<li>Document 文档</li>
</ul>
</li>
<li>Node 节点<ul>
<li>Shard 分片</li>
</ul>
</li>
</ul>
<h2 id="文档-Document"><a href="#文档-Document" class="headerlink" title="文档 Document"></a>文档 Document</h2><ul>
<li>Elasticsearch 是面向文档的，文档是所有可搜索数据的最小单位<ul>
<li>日志文件中的日志项</li>
<li>一条数据</li>
</ul>
</li>
<li>文档会被序列化成 JSON 格式，保存在 Elasticsearch 中<ul>
<li>JSON 对象由字段组成</li>
<li>每个字段都有对应的字段类型（字符串&#x2F;数值&#x2F;布尔&#x2F;日期&#x2F;二进制&#x2F;范围类型）</li>
</ul>
</li>
<li>每个文档都有一个 Unique ID<ul>
<li>可以指定 ID</li>
<li>通过 Elasticsearch 自动生成</li>
</ul>
</li>
</ul>
<h3 id="JSON-文档"><a href="#JSON-文档" class="headerlink" title="JSON 文档"></a>JSON 文档</h3><ul>
<li>一个文档中包含一系列的字段，类似数据库表中一条记录</li>
<li>JSON 文档，格式灵活，不需要预先定义格式<ul>
<li>字段的类型可以指定或者通过 Elasticsearch 自动推算</li>
<li>支持数组&#x2F;支持嵌套</li>
</ul>
</li>
</ul>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F11-02-59-image-20240327110259396.png" alt="image-20240327110259396"></p>
<h3 id="文档的元数据"><a href="#文档的元数据" class="headerlink" title="文档的元数据"></a>文档的元数据</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">       <span class="attr">&quot;_index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;movies&quot;</span><span class="punctuation">,</span></span><br><span class="line">       <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1042&quot;</span><span class="punctuation">,</span></span><br><span class="line">       <span class="attr">&quot;_score&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">       <span class="attr">&quot;_source&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;That Thing You Do!&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;event&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">             <span class="attr">&quot;original&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1042,That Thing You Do! (1996),Comedy|Drama\r&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;@version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;log&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">             <span class="attr">&quot;file&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/mnt/sdb/movies.csv&quot;</span></span><br><span class="line">             <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;year&quot;</span><span class="punctuation">:</span> <span class="number">1996</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1042&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;genre&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">             <span class="string">&quot;Comedy&quot;</span><span class="punctuation">,</span></span><br><span class="line">             <span class="string">&quot;Drama&quot;</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">       <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>元数据：用于标注文档的相关信息</p>
<ul>
<li><code>_index</code>：文档所属的索引名</li>
<li><code>_type</code>：文档所属的类型名</li>
<li><code>_id</code>：文档唯一 id</li>
<li><code>_source</code>：文档的原始 JSON 数据</li>
<li><code>_all</code>：整合所有字段内容到该字段（目的是检索），已被废除</li>
<li><code>_version</code>：文档的版本信息（解决文档冲突）</li>
<li><code>_score</code>：相关性打分（查询结果算分）</li>
</ul>
<h2 id="索引-Index"><a href="#索引-Index" class="headerlink" title="索引 Index"></a>索引 Index</h2><p>Index：索引，是文档的容器，是一类文档的结合</p>
<ul>
<li>Index 体现了逻辑空间的概念：每个所有都有自己的 Mapping 定义，用于定义包含的文档的字段名和字段类型</li>
<li><code>Shard</code> 体现了物理空间的概念：索引中的数据分散在 <code>Shard</code> 上</li>
</ul>
<p>索引的 Mapping 与  Setting</p>
<ul>
<li><code>Mapping</code> 定义文档字段的类型</li>
<li><code>Settings</code> 定义不同的数据分布</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">GET /movies/_settings</span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;movies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;routing&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">               <span class="attr">&quot;allocation&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                     <span class="attr">&quot;_tier_preference&quot;</span><span class="punctuation">:</span> <span class="string">&quot;data_content&quot;</span></span><br><span class="line">                  <span class="punctuation">&#125;</span></span><br><span class="line">               <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;number_of_shards&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;provided_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;movies&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;creation_date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1711464483559&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;number_of_replicas&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;uuid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ay_XjQBsTpWoLszNQNPDgQ&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">               <span class="attr">&quot;created&quot;</span><span class="punctuation">:</span> <span class="string">&quot;8500010&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">         <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">GET /movies/_mapping</span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;movies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;@version&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">               <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">               <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                     <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">                     <span class="attr">&quot;ignore_above&quot;</span><span class="punctuation">:</span> <span class="number">256</span></span><br><span class="line">                  <span class="punctuation">&#125;</span></span><br><span class="line">               <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;event&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">               <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;original&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                     <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">                     <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                           <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">                           <span class="attr">&quot;ignore_above&quot;</span><span class="punctuation">:</span> <span class="number">256</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                     <span class="punctuation">&#125;</span></span><br><span class="line">                  <span class="punctuation">&#125;</span></span><br><span class="line">               <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;genre&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">               <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">               <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                     <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">                     <span class="attr">&quot;ignore_above&quot;</span><span class="punctuation">:</span> <span class="number">256</span></span><br><span class="line">                  <span class="punctuation">&#125;</span></span><br><span class="line">               <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">               <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">               <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                     <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">                     <span class="attr">&quot;ignore_above&quot;</span><span class="punctuation">:</span> <span class="number">256</span></span><br><span class="line">                  <span class="punctuation">&#125;</span></span><br><span class="line">               <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;log&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">               <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;file&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                     <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                           <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">                           <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                              <span class="attr">&quot;keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                                 <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                 <span class="attr">&quot;ignore_above&quot;</span><span class="punctuation">:</span> <span class="number">256</span></span><br><span class="line">                              <span class="punctuation">&#125;</span></span><br><span class="line">                           <span class="punctuation">&#125;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                     <span class="punctuation">&#125;</span></span><br><span class="line">                  <span class="punctuation">&#125;</span></span><br><span class="line">               <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">               <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">               <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                     <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">                     <span class="attr">&quot;ignore_above&quot;</span><span class="punctuation">:</span> <span class="number">256</span></span><br><span class="line">                  <span class="punctuation">&#125;</span></span><br><span class="line">               <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;year&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">               <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">         <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="索引的不同语意"><a href="#索引的不同语意" class="headerlink" title="索引的不同语意"></a>索引的不同语意</h3><p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F11-57-06-image-20240327115706168.png" alt="image-20240327115706168"></p>
<p>例如：索引（动词）文档到 Elasticsearch 的索引（名词）中</p>
<ul>
<li>名词：一个 Elasticsearch 集群中，可以创建很多个不同的缩影</li>
<li>动词：保存一个文档到 Elasticsearch 的过程也叫作缩影 （Indexing）<ul>
<li>ES 中，指的是创建一个倒排索引的过程</li>
</ul>
</li>
<li>名词：例如一个 B 数索引，一个倒排索引</li>
</ul>
<h2 id="类型-Type"><a href="#类型-Type" class="headerlink" title="类型 Type"></a>类型 Type</h2><p>在 7.0 之前，一个 Index 可以设置多个 Types，每个 Type 下有相同类型的文档；</p>
<p>从 6.0 开始，Type 已经被 Deprecated。7.0 开始，一个索引只能创建一个 Type - <code>_doc</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;_index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my-index-000001&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;_doc&quot;</span><span class="punctuation">,</span>  # 存在这个字段</span><br><span class="line">   <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;_score&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;_source&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br></pre></td></tr></table></figure>

<h2 id="抽象与类比"><a href="#抽象与类比" class="headerlink" title="抽象与类比"></a>抽象与类比</h2><table>
<thead>
<tr>
<th>RDBMS</th>
<th>Elasticsearch</th>
</tr>
</thead>
<tbody><tr>
<td>Table</td>
<td>Index（Type）</td>
</tr>
<tr>
<td>Row</td>
<td>Document</td>
</tr>
<tr>
<td>Column</td>
<td>Field</td>
</tr>
<tr>
<td>Schema（表定义）</td>
<td>Mapping</td>
</tr>
<tr>
<td>SQL</td>
<td>DSL</td>
</tr>
</tbody></table>
<p>传统关系型数据库和 Elasticsearch 的区别和侧重点：</p>
<ul>
<li>Elasticsearch：Schemaless &#x2F;相关性&#x2F;高性能全文检索</li>
<li>RDBMS：事务性 &#x2F; <code>Join</code></li>
</ul>
<h2 id="REST-API"><a href="#REST-API" class="headerlink" title="REST API"></a>REST API</h2><p>很容易被各种语言调用</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F13-59-47-image-20240327135946927.png" alt="image-20240327135946927"></p>
<h3 id="一些基本的-API"><a href="#一些基本的-API" class="headerlink" title="一些基本的 API"></a>一些基本的 API</h3><ul>
<li><code>indices</code><ul>
<li>创建 Index：<code>PUT Movies</code></li>
<li>查看所有 Index：<code>_cat/indices</code></li>
</ul>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取 Index 信息</span></span><br><span class="line">GET movies</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 Mappings</span></span><br><span class="line">GET movies/_mappings</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 Settings</span></span><br><span class="line">GET movies/_settings</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有索引</span></span><br><span class="line">GET /_cat/indices?v</span><br><span class="line"></span><br><span class="line">health status index                                         uuid                   pri rep docs.count docs.deleted store.size pri.store.size dataset.size</span><br><span class="line">yellow open   movies                                        ay_XjQBsTpWoLszNQNPDgQ   1   1      62424            0     14.5mb         14.5mb       14.5mb</span><br><span class="line">green  open   metrics-endpoint.metadata_current_default     _4T8Iv2tT2Cjq6IJFhf9hw   1   0          0            0       249b           249b         249b</span><br><span class="line">yellow open   kibana_sample_data_ecommerce                  pKe8GdNYT5ONgUsTW5swtw   1   1       4675            0      4.3mb          4.3mb        4.3mb</span><br><span class="line">yellow open   kibana_sample_data_flights                    yYEUw9qfSbmDXsun-2LSVg   1   1      13014            0        6mb            6mb          6mb</span><br><span class="line">yellow open   .ds-kibana_sample_data_logs-2024.03.26-000001 4CVnBLUSTtil_O-z6d_tgw   1   1      14074            0      9.4mb          9.4mb        9.4mb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET movies/_count</span><br><span class="line"></span><br><span class="line"><span class="comment"># 占用的内存</span></span><br><span class="line">GET /_cat/indices?v&amp;h=i,tm&amp;s=tm:desc</span><br></pre></td></tr></table></figure>

<h2 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h2><p>作为分布式系统，需要具备高可用性和可扩展性</p>
<ul>
<li>高可用性：<ul>
<li>服务可用性：允许有节点停止服务</li>
<li>数据可用性：部分节点丢失，不会丢失数据</li>
</ul>
</li>
<li>可扩展性<ul>
<li>请求量提升 &#x2F; 数据的不断增长（将数据分布到所有节点上）</li>
</ul>
</li>
</ul>
<h3 id="分布式特性"><a href="#分布式特性" class="headerlink" title="分布式特性"></a>分布式特性</h3><ul>
<li>优势<ul>
<li>存储的水平扩容</li>
<li>提高系统的可用性，部分节点停止服务，整个集群的服务不受影响</li>
</ul>
</li>
<li>架构<ul>
<li>不同的集群通过不同的名字来区分，默认名字 <code>elasticsearch</code></li>
<li>通过配置文件修改，或者在命令行中 <code>-E cluster.name=xxx</code> 进行设定</li>
<li>一个集群可以有一个或者多个节点</li>
</ul>
</li>
</ul>
<h2 id="节点"><a href="#节点" class="headerlink" title="节点"></a>节点</h2><p>节点是一个 Elasticsearch  的实例：</p>
<ul>
<li>本质上就是一个 Java 进程</li>
<li>一台机器上可以运行多个 Elasticsearch 进程，但是生产环境一般建议一台机器上只运行一个 Elasticsearch 实例</li>
</ul>
<p>每一个节点都有名字，通过配置文件配置，或者启动时候 <code>-E nodel.name=node1</code> 指定</p>
<p>每一个节点在启动之后，会分配一个 UID，保存在 <code>data</code> 目录下</p>
<h3 id="Master-Node-Master-eligible-Node"><a href="#Master-Node-Master-eligible-Node" class="headerlink" title="Master Node &amp; Master eligible Node"></a>Master Node &amp; Master eligible Node</h3><ul>
<li>每个节点启动后，默认就是一个 Master eligible 节点<ul>
<li>可以设置配置文件 <code>node.master: false</code> 禁止</li>
</ul>
</li>
<li>Master-eligible 节点可以参加选主流程，成为 Master 节点</li>
<li>当第一个节点启动时，它会将自己选举成 Master 节点</li>
<li>每个节点上都保存了集群的状态，只有 Master 节点才能修改集群的状态信息<ul>
<li>集群状态（Cluster State），维护了一个集群中必要的信息<ul>
<li>所有的节点信息</li>
<li>所有的索引和其相关的 Mapping 与 Setting 信息</li>
<li>分片的路由信息</li>
</ul>
</li>
<li>任意节点都能修改信息会导致数据的不一致性</li>
</ul>
</li>
</ul>
<h3 id="Data-Node"><a href="#Data-Node" class="headerlink" title="Data Node"></a>Data Node</h3><p>可以保存数据的节点，叫作 Data Node。负责保存分片数据，在数据扩展上起到了至关重要的作用。（当集群无法保存现有数据时，可以给集群添加一个数据节点来解决这个问题）</p>
<h3 id="Coordinating-Node"><a href="#Coordinating-Node" class="headerlink" title="Coordinating Node"></a>Coordinating Node</h3><ul>
<li>负责接受 Client 的请求，将请求分发到合适的节点，最终把结果汇集到一起</li>
<li>每个节点默认都起到了 Coordinating Node 的职责</li>
</ul>
<h3 id="Hot-Warm-Node"><a href="#Hot-Warm-Node" class="headerlink" title="Hot &amp; Warm Node"></a>Hot &amp; Warm Node</h3><p>Hot 节点是配置比较高的节点，有比较好的内存和CPU，Warm 节点用于存储旧数据，配置较低。</p>
<p>不同硬件配置的 Data Node，用来实现 Hot &amp; Warm 架构，降级集群部署的成本。</p>
<h3 id="Machine-Learning-Node"><a href="#Machine-Learning-Node" class="headerlink" title="Machine Learning Node"></a>Machine Learning Node</h3><p>负责跑机器学习的 Job，用来做异常检测</p>
<h3 id="Tribe-Node"><a href="#Tribe-Node" class="headerlink" title="Tribe Node"></a>Tribe Node</h3><p>未来版本会被（Cluster  Search 功能）淘汰，</p>
<p>（5.3 开始使用 Cross Cluster Search）Tribe Node 连接到不同的 Elasticsearch 集群，并且支持将这些集群当成一个单独的集群处理。</p>
<h2 id="配置节点类型"><a href="#配置节点类型" class="headerlink" title="配置节点类型"></a>配置节点类型</h2><p>开发环境中一个节点可以承担多种角色</p>
<ul>
<li>性能好</li>
<li>根据不同的机器分配不同的性能</li>
</ul>
<p>生产环境中，应该设置单一的角色的节点（<code>dedicated node</code>）</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F15-17-13-image-20240327151713184.png" alt="image-20240327151713184"></p>
<h2 id="分片"><a href="#分片" class="headerlink" title="分片"></a>分片</h2><p>分片分为 Primary Shar（主分片）和 Replica Shard（副本）</p>
<ul>
<li>主分片，用以解决数据水平扩展的问题，通过主分片，可以将数据分布到集群内的所有节点之上<ul>
<li>一个分片是一个运行的 Lucene 的实例</li>
<li>主分片数在索引（Index）创建时指定，后续不允许修改，除非 Reindex</li>
</ul>
</li>
<li>副本，用以解决数据高可用的问题，分片是主分片的拷贝<ul>
<li>副本分片数，可以动态调整</li>
<li>增加副本数，还可以在一定程度上提高服务的可用性（读取的吞吐）</li>
</ul>
</li>
</ul>
<p>一个三节点的集群中，<code>blogs</code> 索引的分片分布情况</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PUT /blog</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;number_of_shards&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span> </span><br><span class="line">        <span class="attr">&quot;number_of_replicas&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>创建 Index 时，会创建三个分片，以及每一个主分片对应一个副本，一共六个分片，相同分片不会分布到同一个节点上。</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F15-29-16-image-20240327152916246.png" alt="image-20240327152916246"></p>
<p>如果此时增加一个节点，那么六个分片会分布到四个节点上，一定程度增加系统可用性。</p>
<h3 id="分片的设定"><a href="#分片的设定" class="headerlink" title="分片的设定"></a>分片的设定</h3><p>对于生产环境中分片的设定，需要提前做好容量规划。</p>
<ul>
<li>分片数设置过小<ul>
<li>导致后续无法增加节点实现水平扩展</li>
<li>单个分片的数据量太大，导致数据重新分配耗时</li>
</ul>
</li>
<li>分片数设置过大，7.0 开始，默认主分片设置成1（从 5 改成 1），解决了 <code>over-sharding</code> 的问题<ul>
<li>影响搜索结果的相关性打分，影响统计结果的准确性</li>
<li>单个节点上过多的分片，会导致资源浪费，同时也会影响性能</li>
</ul>
</li>
</ul>
<h3 id="查看集群健康状况"><a href="#查看集群健康状况" class="headerlink" title="查看集群健康状况"></a>查看集群健康状况</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GET /_cluster/health</span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;cluster_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my_cluster&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;green&quot;</span><span class="punctuation">,</span> # 状态</span><br><span class="line">   <span class="attr">&quot;timed_out&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;number_of_nodes&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span> # 节点个数</span><br><span class="line">   <span class="attr">&quot;number_of_data_nodes&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span> # 数据节点个数</span><br><span class="line">   <span class="attr">&quot;active_primary_shards&quot;</span><span class="punctuation">:</span> <span class="number">44</span><span class="punctuation">,</span> # 活跃主分片数</span><br><span class="line">   <span class="attr">&quot;active_shards&quot;</span><span class="punctuation">:</span> <span class="number">89</span><span class="punctuation">,</span>  	# 活跃总分片数</span><br><span class="line">   <span class="attr">&quot;relocating_shards&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;initializing_shards&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;unassigned_shards&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;delayed_unassigned_shards&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;number_of_pending_tasks&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;number_of_in_flight_fetch&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;task_max_waiting_in_queue_millis&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;active_shards_percent_as_number&quot;</span><span class="punctuation">:</span> <span class="number">100</span> # 活跃副本数占比</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Green：主分片与副本都正常分配</li>
<li>Yellow：主分片全部正常分配，有副本分片未能正常分配</li>
<li>Red：有主分片未能分配<ul>
<li>例如，当服务器的磁盘容量超过 85% 时，创建了一个新的索引</li>
</ul>
</li>
</ul>
<p>还可以通过一些工具查看集群节点的状态，例如前面的 <code>Cerebro</code>，或者浏览器插件：<span class="exturl" data-url="aHR0cHM6Ly9jaHJvbWV3ZWJzdG9yZS5nb29nbGUuY29tL2RldGFpbC9lbGFzdGljdnVlL2hrZWRiYXBqcGJsYm9kcGdiYWpibHBubHBlbmFlYmFh">https://chromewebstore.google.com/detail/elasticvue/hkedbapjpblbodpgbajblpnlpenaebaa<i class="fa fa-external-link-alt"></i></span></p>
<p>节点状态：</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F15-41-11-image-20240327154111592.png" alt="image-20240327154111592"></p>
<img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F15-41-24-image-20240327154124045.png" alt="image-20240327154124045" style="zoom:25%;" />

<p>分片状态：</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F15-42-10-image-20240327154210309.png" alt="image-20240327154210309"></p>
<p>当关闭节点 <code>node_1</code></p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F15-50-07-image-20240327155007753.png" alt="image-20240327155007753"></p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F15-50-45-image-20240327155045820.png" alt="image-20240327155045820"></p>
<p>再关闭一个节点（Master 节点），会导致选举无法满足半数，导致 Master 无法产生，集群无法正常工作。</p>
<h1 id="文档的基本操作"><a href="#文档的基本操作" class="headerlink" title="文档的基本操作"></a>文档的基本操作</h1><p>CRUD 与批量操作</p>
<h2 id="文档的-CRUD"><a href="#文档的-CRUD" class="headerlink" title="文档的 CRUD"></a>文档的 CRUD</h2><h3 id="Index-创建"><a href="#Index-创建" class="headerlink" title="Index 创建"></a>Index 创建</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PUT my_index/_doc/<span class="number">1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span><span class="string">&quot;mitaka&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">18</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>Type 名，约定都用 <code>_doc</code>。</p>
<p>PUT 如果 ID 存在，会全局覆盖更新（可以理解为删除现有的文档，再创建新的文档，版本会增加）</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT my_index/_doc/<span class="number">1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">19</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">   <span class="attr">&quot;_source&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">19</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>自动创建 id</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST my_index/_doc</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;mitaka&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">19</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>Index 和 Create 不一样的地方：</p>
<ul>
<li>如果文档不存在，就索引新的文档</li>
<li>否则现有文档会被删除，新的文档被索引，版本号 +1</li>
</ul>
<h3 id="Create-创建"><a href="#Create-创建" class="headerlink" title="Create 创建"></a>Create 创建</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PUT my_index/_create/<span class="number">3</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;mitaka&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">19</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>如果 ID 已经存在，会失败</p>
<h3 id="Read-获取"><a href="#Read-获取" class="headerlink" title="Read 获取"></a>Read 获取</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET my_index/_doc/<span class="number">1</span></span><br></pre></td></tr></table></figure>

<ul>
<li>找到文档，返回 HTTP 200<ul>
<li>文档元信息<ul>
<li>包含版本信息，同一个 ID 的文档，即使被删除，<code>_version</code> 也会不断增加</li>
<li><code>_source</code> 中默认包含了文档的所有原始信息</li>
</ul>
</li>
</ul>
</li>
<li>找不到文档，返回 HTTP 404</li>
</ul>
<h3 id="Update-更新"><a href="#Update-更新" class="headerlink" title="Update 更新"></a>Update 更新</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST my_index/_update/<span class="number">1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> # 必须指明 doc</span><br><span class="line">        <span class="attr">&quot;comment&quot;</span><span class="punctuation">:</span> <span class="string">&quot;you know&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>文档必须已经存在，更新只会对相应字段做增量修改</p>
<ul>
<li>Update 方法不会删除原来文档的字段，而是实现真正的数据更新（其实真实逻辑也是删除整个文档，然后局部替换，再创建）</li>
<li>POST 方法 Payload 需要包含在 <code>doc</code> 中</li>
</ul>
<p>ps：es 中没有更新，只有删除再创建。</p>
<h2 id="批量操作"><a href="#批量操作" class="headerlink" title="批量操作"></a>批量操作</h2><p>在请求 ES 时经过网络操作，比较消耗性能，此时可以通过 Bulk 将多个操作一次性发送到服务端。</p>
<p>每次批量操作，数据量不宜过大，以免引发性能问题</p>
<h3 id="批量多操作-Bulk"><a href="#批量多操作-Bulk" class="headerlink" title="批量多操作 Bulk"></a>批量多操作 Bulk</h3><ul>
<li>支持在一次 API 调用中，对不同的索引进行操作</li>
<li>支持四种类型操作<ul>
<li>Index</li>
<li>Create</li>
<li>Update</li>
<li>Delete</li>
</ul>
</li>
<li>可以在 URI 中指定 Index，也可以在请求的 Playload 中指定</li>
<li>操作中单条操作失败，并不会影响其他操作</li>
<li>返回结果包括了每一条操作执行的结果</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST _bulk</span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;_index&quot;</span><span class="punctuation">:</span><span class="string">&quot;my_index&quot;</span><span class="punctuation">,</span><span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span><span class="string">&quot;100&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;key&quot;</span><span class="punctuation">:</span><span class="string">&quot;value&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;delete&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;_index&quot;</span><span class="punctuation">:</span><span class="string">&quot;my_index&quot;</span><span class="punctuation">,</span><span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F16-22-19-image-20240327162219438.png" alt="image-20240327162219438" style="zoom:25%;" />

<h3 id="批量读取-mget"><a href="#批量读取-mget" class="headerlink" title="批量读取 mget"></a>批量读取 mget</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET _mget</span><br><span class="line">&#123;</span><br><span class="line">   &quot;docs&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">         &quot;_index&quot;: &quot;my_index&quot;,</span><br><span class="line">         &quot;_id&quot;: 2</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         &quot;_index&quot;: &quot;my_index&quot;,</span><br><span class="line">         &quot;_id&quot;: 300</span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F16-24-15-image-20240327162415373.png" alt="image-20240327162415373" style="zoom:25%;" />

<h3 id="批量查询-msearch"><a href="#批量查询-msearch" class="headerlink" title="批量查询 msearch"></a>批量查询 msearch</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST /my_index/_msearch</span><br><span class="line"><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span> # 指定索引，默认不指定则使用 uri 中的索引</span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">&#125;</span> # 检索语句</span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span><span class="string">&quot;kibana_sample_data_ecommerce&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>返回结果就是执行多个检索条件的返回结果</p>
<img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F16-29-13-image-20240327162913735.png" alt="image-20240327162913735" style="zoom:25%;" />

<h2 id="常见错误返回"><a href="#常见错误返回" class="headerlink" title="常见错误返回"></a>常见错误返回</h2><p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F16-29-38-image-20240327162938498.png" alt="image-20240327162938498"></p>
<h1 id="倒排索引"><a href="#倒排索引" class="headerlink" title="倒排索引"></a>倒排索引</h1><p>倒排索引可以理解为通过内容查找到文件。</p>
<p>例如用图书和搜索引擎的类比：</p>
<ul>
<li>图书：<ul>
<li>正排索引 - 目录页</li>
<li>倒排索引 - 索引页</li>
</ul>
</li>
<li>搜索引擎<ul>
<li>正排索引 - 文档 ID 到文档内容和单词的关联</li>
<li>倒排索引 - 单词到文档 ID 的关系</li>
</ul>
</li>
</ul>
<p>正排索引和倒排索引</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F16-55-43-image-20240327165543068.png" alt="image-20240327165543068"></p>
<h2 id="核心组成"><a href="#核心组成" class="headerlink" title="核心组成"></a>核心组成</h2><p>倒排索引包含两个部分：</p>
<ul>
<li>单词词典（Term Dictionary）：记录所有文档的单词，记录单词到倒排列表的关联关系<ul>
<li>单词词典一般比较大，可以通过 B+ 数或哈希拉链法实现，以满足高性能的插入与查询</li>
</ul>
</li>
<li>倒排列表（Posting List）：记录了单词对应的文档结合，由倒排索引项组成<ul>
<li>倒排索引项（Posting）<ul>
<li>文档 ID</li>
<li>词频 TF：该单词在文档中出现的次数，用于相关性评分</li>
<li>位置（Position）：单词在文档中分词的位置。用于语句检索（Phrase query）</li>
<li>偏移（Offset）：记录单词的开始结束位置，实现高亮显示</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>例如 Elasticsearch 这个单词对应的 倒排列表：</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F17-02-26-image-20240327170226626.png" alt="image-20240327170226626"></p>
<ul>
<li>Elasticsearch 的 JSON 文档中的每个字段，都有自己的倒排索引</li>
<li>可以指定对某些字段不做索引<ul>
<li>优点：节省存储空间</li>
<li>缺点：字段无法被搜索</li>
</ul>
</li>
</ul>
<h1 id="通过-Analyzer-进行分词"><a href="#通过-Analyzer-进行分词" class="headerlink" title="通过 Analyzer 进行分词"></a>通过 Analyzer 进行分词</h1><h2 id="Analysis-与-Analyzer"><a href="#Analysis-与-Analyzer" class="headerlink" title="Analysis 与 Analyzer"></a>Analysis 与 Analyzer</h2><ul>
<li>Analysis：文本分析，也叫分词，就是将文本转换成一系列单词（<code>term/token</code>）的过程。</li>
<li>Analysis：是通过 Analyzer（分词器） 来实现的<ul>
<li>可使用 Elasticsearch 内置的分词器，或者按需定制化分词器</li>
</ul>
</li>
<li>出了在数据写入时转换词条，匹配 Query 语句时也需要用相同的分词器对查询语句进行分析</li>
</ul>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F17-09-57-image-20240327170957075.png" alt="image-20240327170957075"></p>
<p>例如，将 <code>Elasticsearch Server</code> 这段词，分为 <code>elasticsearch</code>、<code>server</code> 两个小写单词。</p>
<h2 id="Analyzer-的组成"><a href="#Analyzer-的组成" class="headerlink" title="Analyzer  的组成"></a>Analyzer  的组成</h2><p>分词器是专门处理分词的组件，Analyzer 由三部分组成</p>
<ul>
<li>Character Filters（针对原始文本处理，例如去除 <code>html</code> 标签）&#x2F; Tokenizer（按照规则切分为单词，例如通过空格切分）&#x2F; Token Filter（将切分的单词进行加工，例如小写，删除 <code>stopwords</code>，增加同义词）</li>
</ul>
<p>分词过程如下：</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F17-12-43-image-20240327171243768.png" alt="image-20240327171243768"></p>
<h2 id="Elasticsearch-的分词器"><a href="#Elasticsearch-的分词器" class="headerlink" title="Elasticsearch 的分词器"></a>Elasticsearch 的分词器</h2><p>Elasticsearch 除了提供内置的分词器，还提供自定义分词器</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F17-14-05-image-20240327171405088.png" alt="image-20240327171405088"></p>
<p>指定分词器进行测试</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">POST /_analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span><span class="string">&quot;standard&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span><span class="string">&quot;Elasticsearch provides near real-time search&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;tokens&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;elasticsearch&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">13</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;provides&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">14</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;near&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">23</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">27</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;real&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">28</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">32</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;time&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">33</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">37</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">4</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;search&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">38</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">44</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">5</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>指定索引的字段进行测试</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">POST movies/_analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;title&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;That Thing You Do!&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;tokens&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;that&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;thing&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;you&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">14</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;do&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">15</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">17</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>自定义分词器进行测试</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">POST /_analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;tokenizer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;standard&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;lowercase&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;That Thing&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;tokens&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;that&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;thing&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Standard-Analyzer"><a href="#Standard-Analyzer" class="headerlink" title="Standard Analyzer"></a>Standard Analyzer</h3><ul>
<li>默认分词器</li>
<li>按词切分</li>
<li>小写处理</li>
</ul>
<img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F17-22-49-image-20240327172249548.png" alt="image-20240327172249548" style="zoom:50%;" />

<h3 id="Simple-Analyzer"><a href="#Simple-Analyzer" class="headerlink" title="Simple Analyzer"></a>Simple Analyzer</h3><ul>
<li>按照非字母切分，非字母的都被去除</li>
<li>小写处理</li>
</ul>
<img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F17-24-19-image-20240327172419369.png" alt="image-20240327172419369" style="zoom:50%;" />

<h3 id="Whitespace-Analyzer"><a href="#Whitespace-Analyzer" class="headerlink" title="Whitespace Analyzer"></a>Whitespace Analyzer</h3><ul>
<li>按照空格切分</li>
</ul>
<img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F17-25-06-image-20240327172506148.png" alt="image-20240327172506148" style="zoom:50%;" />

<h3 id="Stop-Analyzer"><a href="#Stop-Analyzer" class="headerlink" title="Stop Analyzer"></a>Stop Analyzer</h3><ul>
<li>相比 Simple Analyzer 多了 stop filter</li>
<li>会把 <code>the</code>，<code>a</code>、<code>is</code> 等修饰性词语去除</li>
</ul>
<img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F17-27-05-image-20240327172705122.png" alt="image-20240327172705122" style="zoom:50%;" />

<h3 id="Keyword-Analyzer"><a href="#Keyword-Analyzer" class="headerlink" title="Keyword Analyzer"></a>Keyword Analyzer</h3><ul>
<li>不分词，直接将输入当一个 <code>term</code> 输出</li>
</ul>
<img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F17-27-42-image-20240327172742354.png" alt="image-20240327172742354" style="zoom:50%;" />

<h3 id="Pattern-Analyzer"><a href="#Pattern-Analyzer" class="headerlink" title="Pattern Analyzer"></a>Pattern Analyzer</h3><ul>
<li>通过正则表达式进行分词</li>
<li>默认是 <code>\W+</code>，非字符的符号进行分隔</li>
</ul>
<img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F17-28-35-image-20240327172835596.png" alt="image-20240327172835596" style="zoom:50%;" />

<h3 id="Language-Analyzer"><a href="#Language-Analyzer" class="headerlink" title="Language Analyzer"></a>Language Analyzer</h3><p>通过指定语言来进行分词</p>
<img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F27%2F17-29-19-image-20240327172919406.png" alt="image-20240327172919406" style="zoom:50%;" />

<p>例如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST /_analyze</span><br><span class="line">&#123;</span><br><span class="line">    &quot;analyzer&quot;:&quot;english&quot;,</span><br><span class="line">    &quot;text&quot;:&quot;Elasticsearch provides near real-time search&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="中分分词的难点"><a href="#中分分词的难点" class="headerlink" title="中分分词的难点"></a>中分分词的难点</h2><ul>
<li>中文句子，切分成一个一个词（不是一个个字）</li>
<li>英文中，单词有自然的空格作为分隔</li>
<li>一句中文，在不同的上下文，有不同的理解<ul>
<li>例如：<code>这个苹果，不大好吃</code> 相比 <code>这个苹果，不大，好吃</code></li>
</ul>
</li>
<li>还有一些无法分词<ul>
<li>例如：<code>他说的确实在理</code></li>
</ul>
</li>
</ul>
<h3 id="ICU-Analyzer"><a href="#ICU-Analyzer" class="headerlink" title="ICU Analyzer"></a>ICU Analyzer</h3><p>通过 <code>plugin</code> 安装</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/elasticsearch-plugin install analysis-icu</span><br></pre></td></tr></table></figure>

<p>提供了 Unicode 的支持，更好的支持亚洲语言。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">POST /_analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;icu_analyzer&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span><span class="string">&quot;他说的确实在理&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;tokens&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;他&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;IDEOGRAPHIC&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;说的&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;IDEOGRAPHIC&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;确实&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;IDEOGRAPHIC&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;在&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;IDEOGRAPHIC&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;理&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;IDEOGRAPHIC&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">4</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="更多的中文分词器"><a href="#更多的中文分词器" class="headerlink" title="更多的中文分词器"></a>更多的中文分词器</h3><ul>
<li>IK：支持自定义词库，支持热更新分词字典<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2luZmluaWxhYnMvYW5hbHlzaXMtaWs=">https://github.com/infinilabs/analysis-ik<i class="fa fa-external-link-alt"></i></span></li>
</ul>
</li>
<li>THULAC：<ul>
<li>清华大学自然语言处理和社会人文计算实验室的一套中文分词器</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL21pY3JvYnVuL2VsYXN0aWNzZWFyY2gtdGh1bGFjLXBsdWdpbg==">https://github.com/microbun/elasticsearch-thulac-plugin<i class="fa fa-external-link-alt"></i></span></li>
</ul>
</li>
</ul>
<h1 id="Search-API"><a href="#Search-API" class="headerlink" title="Search API"></a>Search API</h1><p>查询 API 分为两种：</p>
<ul>
<li>URI Search：也就是在 URL 中使用查询参数</li>
<li>Request Body Search：使用 Elasticsearch 提供的，基于 JSON 格式的更加完备的 Query Domain Specific Language （DSL）</li>
</ul>
<p>指定查询的索引</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/homework%2FPicGo%2F2024%2F03%2F27%2F21-43-27-image-20240327214326965.png" alt="image-20240327214326965"></p>
<p>提供所有 Index 检索，也提供多个 Index 搜索，以及提供 前缀Index 搜索</p>
<h2 id="URI-查询"><a href="#URI-查询" class="headerlink" title="URI 查询"></a>URI 查询</h2><ul>
<li>使用 <code>q</code>，指定查询字符串</li>
<li><code>query string syntax</code>，KV 键值对</li>
</ul>
<p>例如：</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/homework%2FPicGo%2F2024%2F03%2F27%2F21-44-21-image-20240327214421462.png" alt="image-20240327214421462"></p>
<h2 id="Request-Body"><a href="#Request-Body" class="headerlink" title="Request Body"></a>Request Body</h2><p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/homework%2FPicGo%2F2024%2F03%2F27%2F21-44-41-image-20240327214441668.png" alt="image-20240327214441668"></p>
<p>Ps：es 查询时支持使用 POST 和 GET，GET 支持携带 Body</p>
<h2 id="搜索-Response"><a href="#搜索-Response" class="headerlink" title="搜索 Response"></a>搜索 Response</h2><p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/homework%2FPicGo%2F2024%2F03%2F27%2F21-45-08-image-20240327214508475.png" alt="image-20240327214508475"></p>
<h2 id="搜索的相关性-Relevance"><a href="#搜索的相关性-Relevance" class="headerlink" title="搜索的相关性 Relevance"></a>搜索的相关性 Relevance</h2><p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/homework%2FPicGo%2F2024%2F03%2F27%2F21-45-39-image-20240327214539752.png" alt="image-20240327214539752"></p>
<ul>
<li>搜索时用户和搜索引擎的对话</li>
<li>用户关心的是搜索结果的相关性<ul>
<li>是否可以找到所有相关的内容</li>
<li>有多少不相关的内容被返回了</li>
<li>文档的打分是否合理</li>
<li>结合业务需求，平衡结果排名</li>
</ul>
</li>
</ul>
<h3 id="Web-搜索"><a href="#Web-搜索" class="headerlink" title="Web 搜索"></a>Web 搜索</h3><p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/homework%2FPicGo%2F2024%2F03%2F27%2F21-47-29-image-20240327214729668.png" alt="image-20240327214729668"></p>
<ul>
<li>Page Rank 算法<ul>
<li>不仅仅是内容</li>
<li>竞价排名的排序</li>
<li>更重要的是内容的可信度</li>
</ul>
</li>
</ul>
<h3 id="电商搜索"><a href="#电商搜索" class="headerlink" title="电商搜索"></a>电商搜索</h3><p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/homework%2FPicGo%2F2024%2F03%2F27%2F21-49-37-image-20240327214937637.png" alt="image-20240327214937637"></p>
<ul>
<li>搜索引起扮演销售的角色<ul>
<li>提高用户购物体验</li>
<li>提升网站销售业绩</li>
<li>去库存</li>
</ul>
</li>
</ul>
<h3 id="衡量相关性"><a href="#衡量相关性" class="headerlink" title="衡量相关性"></a>衡量相关性</h3><p>Information Retrieval</p>
<ul>
<li>Precision（查准率）：尽可能返回较少的无关文档</li>
<li>Recall（查全率）：尽量返回较多的相关文档</li>
<li>Ranking：是否能够按照相关度进行排序</li>
</ul>
<h3 id="Precision-Recall"><a href="#Precision-Recall" class="headerlink" title="Precision &amp; Recall"></a>Precision &amp; Recall</h3><p>查准率和查全率的计算方式：</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F09-41-00-image-20240328094100585.png" alt="image-20240328094100585"></p>
<ul>
<li>Precision - True Positive &#x2F;  全部返回的结果（True and False Positives）</li>
<li>Recall - True Positive &#x2F; 所有应该返回的结果（True positives + False Negtives）</li>
</ul>
<p>使用 Elasticsearch 时，需要通过查询和相关的参数改善搜索的 Precision 和 Recall</p>
<h1 id="Search"><a href="#Search" class="headerlink" title="Search"></a>Search</h1><h2 id="URI-Search"><a href="#URI-Search" class="headerlink" title="URI Search"></a>URI Search</h2><p>通过 URI 参数实现搜索的目的</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET movies/_search?q=<span class="number">2012</span>&amp;df=title&amp;sort=year<span class="punctuation">:</span>desc&amp;from=<span class="number">0</span>&amp;size=<span class="number">10</span>&amp;timeout=<span class="number">1</span>s </span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;profile&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>q</code>：指定查询语句，使用 Query String Syntax</li>
<li><code>df</code>：默认字段（也叫做查询字段），不指定时，代表查询所有字段</li>
<li><code>sort</code>：指定字段排序</li>
<li><code>from</code>，<code>size</code>：用于分页</li>
<li><code>profile</code>：可以查看查询是如何被执行的</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;profile&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;shards&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;[GNNOtxf4QUaSYC2_OjFpgA][movies][0]&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;node_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GNNOtxf4QUaSYC2_OjFpgA&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;shard_id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;movies&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;cluster&quot;</span><span class="punctuation">:</span> <span class="string">&quot;(local)&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;searches&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ConstantScoreQuery&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ConstantScore(title:2012)&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;time_in_nanos&quot;</span><span class="punctuation">:</span> <span class="number">184072</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;breakdown&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;set_min_competitive_score_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;match_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;shallow_advance_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;set_min_competitive_score&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;next_doc&quot;</span><span class="punctuation">:</span> <span class="number">73567</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;next_doc_count&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;score_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;compute_max_score_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;compute_max_score&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;advance&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;advance_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;count_weight_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;score&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;build_scorer_count&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;create_weight&quot;</span><span class="punctuation">:</span> <span class="number">16886</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;shallow_advance&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;count_weight&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;create_weight_count&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;build_scorer&quot;</span><span class="punctuation">:</span> <span class="number">93619</span></span><br><span class="line">              <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;TermQuery&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;title:2012&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;time_in_nanos&quot;</span><span class="punctuation">:</span> <span class="number">108563</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;breakdown&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;set_min_competitive_score_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;match_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;shallow_advance_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;set_min_competitive_score&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;next_doc&quot;</span><span class="punctuation">:</span> <span class="number">26110</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;next_doc_count&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;score_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;compute_max_score_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;compute_max_score&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;advance&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;advance_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;count_weight_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;score&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;build_scorer_count&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;create_weight&quot;</span><span class="punctuation">:</span> <span class="number">1193</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;shallow_advance&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;count_weight&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;create_weight_count&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;build_scorer&quot;</span><span class="punctuation">:</span> <span class="number">81260</span></span><br><span class="line">                  <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">              <span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;rewrite_time&quot;</span><span class="punctuation">:</span> <span class="number">6738</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;collector&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;QueryPhaseCollector&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;search_query_phase&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;time_in_nanos&quot;</span><span class="punctuation">:</span> <span class="number">237931</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;SimpleFieldCollector&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;search_top_hits&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;time_in_nanos&quot;</span><span class="punctuation">:</span> <span class="number">220069</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">              <span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;aggregations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;fetch&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fetch&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;time_in_nanos&quot;</span><span class="punctuation">:</span> <span class="number">614594</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;breakdown&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;load_stored_fields&quot;</span><span class="punctuation">:</span> <span class="number">322611</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;load_source&quot;</span><span class="punctuation">:</span> <span class="number">68133</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;load_stored_fields_count&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;next_reader_count&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;load_source_count&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;next_reader&quot;</span><span class="punctuation">:</span> <span class="number">17516</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;debug&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;stored_fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;_id&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;_routing&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;_source&quot;</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;FetchSourcePhase&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;time_in_nanos&quot;</span><span class="punctuation">:</span> <span class="number">7437</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;breakdown&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;process_count&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;process&quot;</span><span class="punctuation">:</span> <span class="number">6945</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;next_reader&quot;</span><span class="punctuation">:</span> <span class="number">492</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;next_reader_count&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;debug&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;fast_path&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;StoredFieldsPhase&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;time_in_nanos&quot;</span><span class="punctuation">:</span> <span class="number">9096</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;breakdown&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;process_count&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;process&quot;</span><span class="punctuation">:</span> <span class="number">8443</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;next_reader&quot;</span><span class="punctuation">:</span> <span class="number">653</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;next_reader_count&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="一些语法"><a href="#一些语法" class="headerlink" title="一些语法"></a>一些语法</h3><p><strong>指定字段 和 泛查询</strong></p>
<p>指定字段是指定某个字段作为检索条件；泛查询指的是所有字段作为检索条件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 指定字段</span><br><span class="line">_search?q=2012&amp;df=title</span><br><span class="line">_search?q=title:2012</span><br><span class="line"></span><br><span class="line"># 泛查询</span><br><span class="line">_search?q=2012</span><br></pre></td></tr></table></figure>

<p>通过 profile 可以看到查询细节，包含了所有字段</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ConstantScore((log.file.path.keyword:2012 | event.original.keyword:2012 | id.keyword:2012 | log.file.path:2012 | id:2012 | year:[2012 TO 2012] | genre:2012 | @version:2012 | @version.keyword:2012 | event.original:2012 | genre.keyword:2012 | title.keyword:2012 | title:2012))&quot;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p><strong>Term 和 Phrase</strong></p>
<p>例如：</p>
<ul>
<li>Term：<code>Beautiful Mind</code> 等效于 <code>Beautiful OR Mind</code></li>
<li>Phrase：<code>&quot;Beautiful Mind&quot;</code> 等效于 <code>Beautiful AND Mind</code>。<code>Phrase</code> 查询，还要求前后顺序保持一致</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET movies/_search?q=title<span class="punctuation">:</span>(Beautiful Mind) # 使用括号代表分组是一个组</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;profile&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;BooleanQuery&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;title:beautiful title:mind&quot;</span><span class="punctuation">,</span>         </span><br><span class="line"></span><br><span class="line">GET movies/_search?q=title<span class="punctuation">:</span><span class="string">&quot;Beautiful Mind&quot;</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;profile&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PhraseQuery&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;title:\&quot;beautiful mind\&quot;&quot;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 使用括号代表分组是一个组，如果不分组，会变成</span><br><span class="line">q=title:Beautiful Mind</span><br><span class="line">q=title:Beautiful OR q=Mind</span><br></pre></td></tr></table></figure>

<p><strong>分组与引号</strong></p>
<ul>
<li>分组：<code>title:(Beautiful Mind)</code>，代表是一个组，作为查询条件</li>
<li>引号：<code>title:&quot;Beautiful Mind&quot;</code>，代表是一个 Phrase 查询</li>
</ul>
<p><strong>布尔操作</strong></p>
<p>AND &#x2F; OR &#x2F; NOT 或者 <code>&amp;&amp;</code> &#x2F; <code>||</code> &#x2F; <code>!</code></p>
<ul>
<li>必须大写</li>
</ul>
<p> <code>title:(Beautiful AND Mind)</code> 代表必须两个都有</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET movies/_search?q=title<span class="punctuation">:</span>(Beautiful AND Mind)</span><br><span class="line"></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;BooleanQuery&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;+title:beautiful +title:mind&quot;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p><strong>分组操作</strong></p>
<ul>
<li><code>+</code> 表示 <code>must</code></li>
<li><code>-</code> 表示 <code>must_not</code></li>
</ul>
<p><code>title:(+Beautiful -Mind)</code> 代表 必须有 <code>Beautiful</code> 以及必须没有 <code>Mind</code></p>
<p><strong>范围查询</strong></p>
<p>使用区间表示：<code>[]</code> 闭区间，<code>&#123;&#125;</code> 开区间</p>
<ul>
<li>闭区间代表包括</li>
<li>开区间代表不包括</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET movies/_search?q=year:&#123;1980 TO 1981]</span><br><span class="line">GET movies/_search?q=year:&#123;* TO 1981]</span><br></pre></td></tr></table></figure>

<p><strong>算数符号</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET movies/_search?q=year:&gt;2000</span><br><span class="line">GET movies/_search?q=year:(&gt;2000 &amp;&amp; &lt;=2001)</span><br><span class="line">GET movies/_search?q=year:(+&gt;2000 +&lt;=2001)</span><br></pre></td></tr></table></figure>

<p><strong>通配符查询</strong></p>
<p>通配符查询效率低，占用内存大，不建议使用，特别是放在最前面。</p>
<ul>
<li><code>?</code> 代表 1 个字符，<code>*</code> 代表 0 或多个字符</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET movies/_search?q=title:M?nd</span><br><span class="line">GET movies/_search?q=title:Mi*</span><br></pre></td></tr></table></figure>

<p><strong>正则表达式</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET movies/_search?q=title:[bt]oy</span><br></pre></td></tr></table></figure>

<p><strong>模糊匹配与近似查询</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET movies/_search?q=title:beautif~1</span><br><span class="line">GET movies/_search?q=title:&quot;lord rings&quot;~2</span><br></pre></td></tr></table></figure>

<h2 id="Request-Body-Search"><a href="#Request-Body-Search" class="headerlink" title="Request Body Search"></a>Request Body Search</h2><p>将查询语句通过 HTTP Request Body 发送给 Elasticsearch。使用 Query DSL</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">GET movies/_search?q=<span class="number">2012</span>&amp;df=title&amp;sort=year<span class="punctuation">:</span>desc&amp;from=<span class="number">0</span>&amp;size=<span class="number">10</span>&amp;timeout=<span class="number">1</span>s </span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;profile&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"># 等价</span><br><span class="line">GET movies/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query_string&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2012&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;year&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;order&quot;</span><span class="punctuation">:</span> <span class="string">&quot;desc&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;timeout&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1s&quot;</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;profile&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>分页</strong></p>
<ul>
<li>From 默认从 0 开始，返回 10 个结果</li>
<li>获取靠后的翻页成本较高</li>
</ul>
<p><strong>排序</strong></p>
<ul>
<li>最好在 <strong>数字型</strong> 和 <strong>日期型</strong> 字段上排序</li>
<li>因为对于多值类型或分析过的字段排序，系统会选一个值，无法得知该值</li>
</ul>
<p><strong>过滤</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET movies/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_source&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;year&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;profile&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>如果 <code>_source</code> 没有存储，那就只返回匹配的文档的元数据</li>
<li>支持通配符 <code>[&quot;*name*&quot;, &quot;desc*&quot;]</code></li>
</ul>
<p><strong>脚本字段</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET movies/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;script_fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;new_field&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;script&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;lang&quot;</span><span class="punctuation">:</span> <span class="string">&quot;painless&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;doc[&#x27;title.keyword&#x27;].value+&#x27; hello&#x27;&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;profile&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>脚本一般用于检索结果需要做额外操作，例如 排除、替换、计算 一些内容</p>
<h3 id="查询表达式"><a href="#查询表达式" class="headerlink" title="查询表达式"></a>查询表达式</h3><p><strong>match</strong> 全文检索</p>
<p>有且只有一个字段，并且会分词，默认是 OR 关系</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">GET movies/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Beautiful Mind&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;profile&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">GET movies/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Beautiful Mind&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;operator&quot;</span><span class="punctuation">:</span> <span class="string">&quot;and&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;profile&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>Match Phrase</strong></p>
<p>可以多字段检索，也会分词，单词之间是 AND 关系，并且位置顺序也影响搜索结果</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET movies/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_phrase&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Beautiful Mind&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;slop&quot;</span><span class="punctuation">:</span> <span class="number">1</span>  # 代表中间可以有一个字符串，可以匹配到更多的结果</span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;profile&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>query_string</strong></p>
<p>类似 URI Query，可以指定多个字段，可以使用复杂的查询表达式，不分词</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">GET movies/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query_string&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;default_field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;title&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Two AND Bits&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;profile&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">GET movies/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query_string&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;title&quot;</span><span class="punctuation">,</span><span class="string">&quot;event.original&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;( One OR Two) AND Bits&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;profile&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>Simple Query String Query</strong></p>
<ul>
<li>类似 Query String，但是会忽略错误的语法，同时只支持部分查询语法</li>
<li>不支持 AND OR NOT，会当作字符串处理</li>
<li>Term 之间默认的关系是 OR，可以指定 Operator</li>
<li>支持部分逻辑<ul>
<li><code>+</code> 替代 AND</li>
<li><code>|</code> 替代 OR</li>
<li><code>-</code> 提到 NOT</li>
</ul>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET movies/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;simple_query_string&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;title&quot;</span><span class="punctuation">,</span><span class="string">&quot;event.original&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Two Bits&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;default_operator&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AND&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;profile&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="Mapping"><a href="#Mapping" class="headerlink" title="Mapping"></a>Mapping</h1><p>Mapping 类似数据库中的 <code>schema</code> 的定义，作用如下：</p>
<ul>
<li>定义索引中的字段的名称</li>
<li>定义字段的数据类型，例如字符串，数字，布尔</li>
<li>字段，倒排索引的相关配置（Analyzed or Not Analyzed，Analyzer：定义是否被索引，被分词，以及指定分词器）</li>
</ul>
<p>Mapping 会把 JSON 文档映射成 Lucene 所需要的扁平格式</p>
<p>一个 Mapping 属于一个索引的 Type</p>
<ul>
<li>每个文档都属于一个 Type</li>
<li>一个 Type 有一个 Mapping 定义</li>
<li>7.0 开始，不需要在 Mapping 定义中指定 type 信息</li>
</ul>
<h2 id="字段数据类型"><a href="#字段数据类型" class="headerlink" title="字段数据类型"></a>字段数据类型</h2><ul>
<li>简单类型 <ul>
<li>Text &#x2F; Keyword <ul>
<li>text 用于全文搜索，会分词</li>
<li>keyword 用于精确匹配，不会分词</li>
</ul>
</li>
<li>Date </li>
<li>Integer &#x2F; Floating </li>
<li>Boolean </li>
<li>IPv4 &amp; IPv6</li>
</ul>
</li>
<li>复杂类型一对象和嵌套对象 <ul>
<li>对象类型 &#x2F; 嵌套类型</li>
</ul>
</li>
<li>特殊类型 <ul>
<li>geo_point &amp; geo_shape &#x2F; percolator</li>
</ul>
</li>
</ul>
<h2 id="Dynamic-Mapping"><a href="#Dynamic-Mapping" class="headerlink" title="Dynamic Mapping"></a>Dynamic Mapping</h2><ul>
<li>在写入文档时候，如果索引不存在， 会自动创建索引 </li>
<li>Dynamic Mapping 的机制，使得我们无需手动定义Mappings。 Elasticsearch 会自动根据文档信息，推算出字段的类型 </li>
<li>但是有时候会推算的不对，例如地理位置信息 </li>
<li>当类型如果设置不对时，会导致一些功能无法正常运行，例如 Range 查询</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">GET movies/_mapping</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;movies&quot;: &#123;</span><br><span class="line">    &quot;mappings&quot;: &#123;</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;@version&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">          &quot;fields&quot;: &#123;</span><br><span class="line">            &quot;keyword&quot;: &#123;</span><br><span class="line">              &quot;type&quot;: &quot;keyword&quot;,</span><br><span class="line">              &quot;ignore_above&quot;: 256</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;event&quot;: &#123;</span><br><span class="line">          &quot;properties&quot;: &#123;</span><br><span class="line">            &quot;original&quot;: &#123;</span><br><span class="line">              &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">              &quot;fields&quot;: &#123;</span><br><span class="line">                &quot;keyword&quot;: &#123;</span><br><span class="line">                  &quot;type&quot;: &quot;keyword&quot;,</span><br><span class="line">                  &quot;ignore_above&quot;: 256</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;genre&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">          &quot;fields&quot;: &#123;</span><br><span class="line">            &quot;keyword&quot;: &#123;</span><br><span class="line">              &quot;type&quot;: &quot;keyword&quot;,</span><br><span class="line">              &quot;ignore_above&quot;: 256</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;id&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">          &quot;fields&quot;: &#123;</span><br><span class="line">            &quot;keyword&quot;: &#123;</span><br><span class="line">              &quot;type&quot;: &quot;keyword&quot;,</span><br><span class="line">              &quot;ignore_above&quot;: 256</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;log&quot;: &#123;</span><br><span class="line">          &quot;properties&quot;: &#123;</span><br><span class="line">            &quot;file&quot;: &#123;</span><br><span class="line">              &quot;properties&quot;: &#123;</span><br><span class="line">                &quot;path&quot;: &#123;</span><br><span class="line">                  &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">                  &quot;fields&quot;: &#123;</span><br><span class="line">                    &quot;keyword&quot;: &#123;</span><br><span class="line">                      &quot;type&quot;: &quot;keyword&quot;,</span><br><span class="line">                      &quot;ignore_above&quot;: 256</span><br><span class="line">                    &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;title&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">          &quot;fields&quot;: &#123;</span><br><span class="line">            &quot;keyword&quot;: &#123;</span><br><span class="line">              &quot;type&quot;: &quot;keyword&quot;,</span><br><span class="line">              &quot;ignore_above&quot;: 256</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;year&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;long&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>类型的自动识别</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F11-59-51-image-20240328115951063.png" alt="image-20240328115951063"></p>
<p>更改 Mapping 字段类型的情况</p>
<p>两种情况：</p>
<ul>
<li>新增加字段 <ul>
<li>Dynamic 设为 <code>true</code> 时，一旦有新增字段的文档写入，Mapping 也同时被更新 </li>
<li>Dynamic 设为 <code>false</code>，Mapping 不会被更新，新增字段的数据无法被索引， 但是信息会出现在 <code>_source</code> 中 </li>
<li>Dynamic 设置成 Strict，文档写入失败</li>
</ul>
</li>
<li>对已有字段，一旦已经有数据写入，就不再支持修改字段定义 <ul>
<li>Lucene 实现的倒排索引，一旦生成后，就不允许修改</li>
</ul>
</li>
<li>如果希望改变字段类型，必须 Reindex APl，重建索引</li>
</ul>
<p>原因：</p>
<ul>
<li>如果修改了字段的数据类型，会导致已被索引的数据无法被搜索</li>
<li>但是如果是增加新的字段，就不会有这样的影响</li>
</ul>
<p>设置 Dynamic Mappings</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F13-59-30-image-20240328135930518.png" alt="image-20240328135930518"></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT test1</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;dynamic&quot;</span><span class="punctuation">:</span><span class="string">&quot;false&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>当 dynamic 被设置成 false 时候，存在新增字段的数据写入，该数据可以被索引， 但是新增字段被<strong>丢弃</strong> </li>
<li>当设置成 Strict 模式时候，数据写入直接出错</li>
</ul>
<h2 id="显式-Mapping-设置与常见参数介绍"><a href="#显式-Mapping-设置与常见参数介绍" class="headerlink" title="显式 Mapping 设置与常见参数介绍"></a>显式 Mapping 设置与常见参数介绍</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT test1</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// &quot;define your mappings here&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>自定义 mapping 的一些建议：</p>
<ul>
<li>可以参考 API 手册，纯手写 </li>
<li>为了减少输入的工作量，减少出错概率，可以依照以下步骤<ul>
<li>创建一个临时的 index，写入一些样本数据 </li>
<li>通过访问 Mapping APl 获得该临时文件的动态 Mapping 定义</li>
<li>修改后，使用该配置创建你的索引 </li>
<li>删除临时索引</li>
</ul>
</li>
</ul>
<h3 id="控制当前字段是否被索引"><a href="#控制当前字段是否被索引" class="headerlink" title="控制当前字段是否被索引"></a>控制当前字段是否被索引</h3><p>Index：控制当前字段是否被索引。默认为true。如果设置成 false，该字段不可被搜索</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F14-10-09-image-20240328141009279.png" alt="image-20240328141009279"></p>
<p>设置成 false 不会创建倒排索引，也会节省开销。</p>
<p>Index 选项</p>
<p>四种不同级别的 Index Options 配置,可以控制倒排索引记录的内容：</p>
<ul>
<li>docs - 记录 doc id </li>
<li>freqs - 记录 doc id 和 term frequencies </li>
<li>positions -记录 doc id &#x2F; term frequencies &#x2F; term position </li>
<li>offsets - doc id &#x2F; term frequencies &#x2F; term posistion &#x2F; character offects</li>
</ul>
<p>Text 类型默认记录 postions,其他默认为 docs </p>
<p>记录内容越多,占用存储空间越大</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F14-12-53-image-20240328141253484.png" alt="image-20240328141253484"></p>
<h3 id="null-value"><a href="#null-value" class="headerlink" title="null_value"></a>null_value</h3><p>空值处理</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F14-30-30-image-20240328143030160.png" alt="image-20240328143030160"></p>
<ul>
<li>需要对 Null 值实现搜索</li>
<li>只有 Keyword 类型支持设定 Null_value</li>
</ul>
<h3 id="copy-to"><a href="#copy-to" class="headerlink" title="copy_to"></a>copy_to</h3><p>将一个字段的倒排索引拷贝到另外一个字段（这个字段不存在），供检索使用，但是不影响原始文档。</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F14-31-39-image-20240328143139845.png" alt="image-20240328143139845"></p>
<ul>
<li><code>_all</code> 在 es 7中被 <code>copy_to</code> 所替代 </li>
<li>满足一些特定的搜索需求 </li>
<li><code>copy_to</code> 将字段的数值拷贝到目标字段，实现类似<code>_all</code>的作用</li>
<li><code>copy_to</code> 的目标字段不出现在 <code>_source</code> 中</li>
</ul>
<h3 id="数组类型"><a href="#数组类型" class="headerlink" title="数组类型"></a>数组类型</h3><p>Elasticsearch 中不提供专门的数组类型。但是任何字段，都可以包含多个相同类类型的数值</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F14-33-55-image-20240328143355367.png" alt="image-20240328143355367"></p>
<h1 id="多字段特性及配置自定义-Analyzer"><a href="#多字段特性及配置自定义-Analyzer" class="headerlink" title="多字段特性及配置自定义 Analyzer"></a>多字段特性及配置自定义 Analyzer</h1><p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F14-40-46-image-20240328144046638.png" alt="image-20240328144046638"></p>
<ul>
<li>多字段特性 <ul>
<li>厂商名字实现精确匹配 <ul>
<li>增加一个 kewword 字段</li>
</ul>
</li>
<li>使用不同的 analyzer <ul>
<li>不同语言 </li>
<li>pinyin 字段的搜索 </li>
<li>还支持为搜索和索引指定不同的 analyzer</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Exact-Values-vs-Full-Text"><a href="#Exact-Values-vs-Full-Text" class="headerlink" title="Exact Values vs Full Text"></a>Exact Values vs Full Text</h2><p>精确值和全文本的比较</p>
<ul>
<li>Exact Value: 包括数字 &#x2F; 日期 &#x2F; 具体一个字符串（例如 “Apple Store”） ，不需要分词处理<ul>
<li>Elasticseach 中的 Kewword</li>
</ul>
</li>
<li>全文本,非结构化的文本数据，需要分词处理 <ul>
<li>Elasticsearch 中的 text</li>
</ul>
</li>
</ul>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F14-43-54-image-20240328144354699.png" alt="image-20240328144354699"></p>
<p>Exact Values 不需要被分词</p>
<p>Elasticsearch 为每一个字段创建一个倒排索引，Exact Value 在索引时，不需要做特殊的分词处理。</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F14-46-07-image-20240328144607235.png" alt="image-20240328144607235"></p>
<h2 id="自定义分词"><a href="#自定义分词" class="headerlink" title="自定义分词"></a>自定义分词</h2><p>当 Elasticsearch 自带的分词器无法满足时，可以自定义分词器，通过自组合不同的组件实现 </p>
<ul>
<li>Character Filter </li>
<li>Tokenizer </li>
<li>Token Filter</li>
</ul>
<h3 id="Character-Filter"><a href="#Character-Filter" class="headerlink" title="Character Filter"></a>Character Filter</h3><ul>
<li>在 Tokenizer 之前对文本进行处理，例如增加删除及替换字符。可以配置多个 Character Filters。会影响 Tokenizer 的 position 和 offset 信息 </li>
<li>一些自带的 Character Filters <ul>
<li>HTML strip：出除 html 标签</li>
<li>Mapping：字符串替换 </li>
<li>Pattem replace：正则匹配替换</li>
</ul>
</li>
</ul>
<h3 id="Tokenizer"><a href="#Tokenizer" class="headerlink" title="Tokenizer"></a>Tokenizer</h3><ul>
<li>将原始的文本按照一定的规则，切分为词 （term or token） </li>
<li>Elasticsearch 内置的 Tokenizers <ul>
<li>whitespace &#x2F; standard &#x2F; uax_urlemail &#x2F; patter &#x2F; keyword &#x2F; path hierarchy</li>
</ul>
</li>
<li>可以用 Java 开发插件,实现自己的 Tokenizer</li>
</ul>
<h3 id="Token-Filter"><a href="#Token-Filter" class="headerlink" title="Token Filter"></a>Token Filter</h3><ul>
<li>将 Tokenizer 输出的单词（term），进行增加，修改，删除 </li>
<li>自带的 Token Filters <ul>
<li>lowercase &#x2F; stop &#x2F; synonym（添加近义词）</li>
</ul>
</li>
</ul>
<h3 id="设置一个-Custom-Aanlyzer"><a href="#设置一个-Custom-Aanlyzer" class="headerlink" title="设置一个 Custom Aanlyzer"></a>设置一个 Custom Aanlyzer</h3><p>自定义一个 Analyzer，通过自定义一些分词器，组合成 Analyzer</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F14-51-54-image-20240328145154789.png" alt="image-20240328145154789"></p>
<h1 id="Index-Template-和-Dynamic-Template"><a href="#Index-Template-和-Dynamic-Template" class="headerlink" title="Index Template 和 Dynamic Template"></a>Index Template 和 Dynamic Template</h1><p>如果集群上的索引越来越多，例如为日志每天创建一个索引。使用多个索引可以更好的管理数据，提高性能。</p>
<h2 id="Index-Template"><a href="#Index-Template" class="headerlink" title="Index Template"></a>Index Template</h2><p>帮助你设定 Mappings 和 Settings，并按照一定的规则， 自动匹配到新创建的索引之上 。</p>
<ul>
<li>模版仅在一个索引被新创建时，才会产生作用。</li>
<li>修改模版不会影响已创建的索引 </li>
<li>你可以设定多个索引模版，这些设置会被 <code>merge</code> 在一起 </li>
<li>你可以指定 <code>order</code> 的数值，控制 <code>merging</code> 的过程</li>
</ul>
<p>例如两个 Index Templates</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F15-00-33-image-20240328150033272.png" alt="image-20240328150033272"></p>
<p>如果索引名称是 <code>test</code> 开头，则会以第二个索引覆盖第一个索引的配置。</p>
<h3 id="Index-Template-的工作方式"><a href="#Index-Template-的工作方式" class="headerlink" title="Index Template 的工作方式"></a>Index Template 的工作方式</h3><p>当一个索引被新创建时 </p>
<ul>
<li>应用 Elasticsearch 默认的 settings 和 mappings </li>
<li>应用 <code>order</code> 数值低的 Index Template 中的设定 </li>
<li>应用 <code>order</code> 高的 Index Template 中的设定，之前的设定会被覆盖 </li>
<li>应用创建索引时，用户所指定的 Settings 和 Mappings，并覆盖之前模版中的设定</li>
</ul>
<h2 id="Dynamic-Template"><a href="#Dynamic-Template" class="headerlink" title="Dynamic Template"></a>Dynamic Template</h2><p>根据 Elasticsearch 识别的数据类型，结合字段名称，来动态设定字段类型，例如：</p>
<ul>
<li>所有的字符串类型都设定成 Keyword，或者关闭 keyword 字段</li>
<li><code>is</code> 开头的字段都设置成 <code>boolean</code> </li>
<li><code>long_</code> 开头的都设置成 <code>long</code> 类型</li>
</ul>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F15-06-24-image-20240328150624105.png" alt="image-20240328150624105"></p>
<ul>
<li>Dynamic Tempate 是定义在在某个索引的 Mapping 中 </li>
<li>Template有一个名称 </li>
<li>匹配规则是一个数组 </li>
<li>为匹配到字段设置 Mapping</li>
</ul>
<p><strong>匹配规则参数</strong></p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F15-08-42-image-20240328150842500.png" alt="image-20240328150842500"></p>
<ul>
<li><code>match_mapping_type</code>: 匹配自动识别的字段类型, 如 <code>string</code>, <code>boolean</code> 等 </li>
<li><code>match</code>, <code>unmatch</code>: 匹配字段名 </li>
<li><code>path_match</code>, <code>path_unmatch</code></li>
<li>需要注意数组中的顺序</li>
</ul>
<h1 id="聚合分析"><a href="#聚合分析" class="headerlink" title="聚合分析"></a>聚合分析</h1><p>聚合：将搜索结果通过大小聚合到不同的组中，用于进一步检索</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F15-11-25-image-20240328151124981.png" alt="image-20240328151124981"></p>
<ul>
<li>Elasticsearch 除搜索以外，提供的针对 ES 数据进行统计分析的功能<ul>
<li>实时性高 </li>
<li>Hadoop （T+1）</li>
</ul>
</li>
<li>通过聚合，我们会得到一个数据的概览，是分析和总结全套的数据，而不是寻找单个文档 <ul>
<li>购物网站上检索出来鞋子不同尺寸的结果数量</li>
<li>尖沙咀和香港岛的客房数量 </li>
<li>不同的价格区间，可预定的经济型酒店和五星级酒店的数量</li>
</ul>
</li>
<li>高性能，只需要一条语句，就可以从 Elasticsearch 得到分析结果 <ul>
<li>无需在客户端自己去实现分析逻辑</li>
</ul>
</li>
</ul>
<h2 id="Kibana-可视化报表-聚合分析"><a href="#Kibana-可视化报表-聚合分析" class="headerlink" title="Kibana 可视化报表 - 聚合分析"></a>Kibana 可视化报表 - 聚合分析</h2><p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F15-15-37-image-20240328151537025.png" alt="image-20240328151537025"></p>
<ul>
<li>客户的地理位置分布</li>
<li>订单增长情况</li>
</ul>
<h2 id="集合的分类"><a href="#集合的分类" class="headerlink" title="集合的分类"></a>集合的分类</h2><ul>
<li>Bucket Aggregation：一些列满足特定条件的文档的集合 </li>
<li>Metric Aggregation：一些数学运算，可以对文档字段进行统计分析 </li>
<li>Pipeline Aggregation：对其他的聚合结果进行二次聚合 </li>
<li>Matrix Aggregration：支持对多个字段的操作并提供一个结果矩阵</li>
</ul>
<h3 id="Bucket-Metric"><a href="#Bucket-Metric" class="headerlink" title="Bucket &amp; Metric"></a>Bucket &amp; Metric</h3><p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F15-17-48-image-20240328151748156.png" alt="image-20240328151748156"></p>
<ul>
<li>Metric：一系列的统计方法，例如 SQL 中的 COUNT</li>
<li>Bucket：一组满足条件的文档，例如 SQL 中的 GROUP</li>
</ul>
<p>Bucket：</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F15-19-13-image-20240328151912945.png" alt="image-20240328151912945"></p>
<ul>
<li>一些例子<ul>
<li>杭州属于浙江 &#x2F;一个演员属于男或女性 </li>
<li>嵌套关系：杭州属于浙江属于中国属于亚洲</li>
</ul>
</li>
<li>Elasticsearch 提供了很多类型的 Bucket， 帮助你用多种方式划分文档 <ul>
<li>Term &amp; Range（时间 &#x2F; 年龄区间 &#x2F; 地理位置）</li>
</ul>
</li>
</ul>
<p>Metric：</p>
<ul>
<li>Metric 会基于数据集计算结果，除了支持在字段上进行计算，同样也支持在脚本（painless script）产生的结果之上进行计算 </li>
<li>大多数 Metric 是数学计算，仅输出一个值 <ul>
<li>min &#x2F; max &#x2F; sum &#x2F; avg &#x2F; cardinality</li>
</ul>
</li>
<li>部分 metric 支持输出多个数值 <ul>
<li>stats &#x2F; percentiles &#x2F; percentile_ranks</li>
</ul>
</li>
</ul>
<p>例如使用 Bucket 查看航班目的地的统计信息</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F15-22-07-image-20240328152207300.png" alt="image-20240328152207300"></p>
<p>加入 Metric，查看航班目的地的统计信息，增加均价，最高最低价格</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F15-23-10-image-20240328152309952.png" alt="image-20240328152309952"></p>
<h3 id="嵌套"><a href="#嵌套" class="headerlink" title="嵌套"></a>嵌套</h3><p>查看航班目的地的统计信息，平均票价，以及天气状况</p>
<p><img data-src="https://image-hosting-xiaoyeshiyu-shanghai.oss-cn-shanghai.aliyuncs.com/img/PicGo%2F2024%2F03%2F28%2F15-24-32-image-20240328152431956.png" alt="image-20240328152431956"></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Reference/" rel="tag"># 学习笔记</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/31bd10f.html" rel="prev" title="Nginx 系统层面性能优化">
                  <i class="fa fa-angle-left"></i> Nginx 系统层面性能优化
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/f969d9e9.html" rel="next" title="Elasticsearch 搜索、聚合和数据建模">
                  Elasticsearch 搜索、聚合和数据建模 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Mitaka xu</span>
  </div>
  <div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZw==">NexT.Gemini</span>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hpYW95ZXNoaXl1" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.umd.js" integrity="sha256-ytMJGN3toR+a84u7g7NuHm91VIR06Q41kMWDr2pq7Zo=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.1.0/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>


  


  <script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"TVx6Wkfs8VJGOwYPurtjWY2e-9Nh9j0Va","app_key":"c7VvaRnyF8r3DUIPq1x2KJ7Q","server_url":"https://tvx6wkfs.lc-cn-e1-shared.com","security":true}</script>
  <script src="/js/third-party/statistics/lean-analytics.js"></script>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://www.xiaoyeshiyu.com/post/ff89bae5.html"}</script>
  <script src="/js/third-party/quicklink.js"></script>
<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"xiaoyeshiyu","count":false,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
